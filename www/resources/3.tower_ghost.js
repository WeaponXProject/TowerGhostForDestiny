function Profile(character){var self=this;this.id=character.characterBase.characterId,this.order=ko.observable(character.index),this.icon=ko.observable(""),this.gender=ko.observable(""),this.classType=ko.observable(""),this.level=ko.observable(""),this.stats=ko.observable(""),this.race=ko.observable(""),this.percentToNextLevel=ko.observable(""),this.background=ko.observable(""),this.items=ko.observableArray().extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}}),this.loadouts=ko.computed(function(){return _.filter(app.loadouts(),function(loadout){return loadout.characterId()==self.id})}),this.activeBestSets=ko.observable(),this.items.subscribe(_.throttle(app.redraw,500)),this.reloadingBucket=!1,this.statsShowing=ko.observable(!1),this.statsToolClass=ko.computed(function(){var classNames=[];return"Vault"!=self.id&&(self.statsShowing()?classNames.push("active"):classNames.push("inactive"),classNames.push("btn btn-sm")),classNames.join(" ")}),this.statsPane=ko.observable("info"),this.weapons=ko.pureComputed(this._weapons,this),this.armor=ko.pureComputed(this._armor,this),this.general=ko.pureComputed(this._general,this),this.invisible=ko.pureComputed(this._invisible,this),this.lostItems=ko.pureComputed(this._lostItems,this),this.equippedGear=ko.pureComputed(this._equippedGear,this),this.equippedStats=ko.pureComputed(this._equippedStats,this),this.sumCSP=ko.pureComputed(this._sumCSP,this),this.equippedSP=ko.pureComputed(this._equippedSP,this),this.equippedTier=ko.pureComputed(this._equippedTier,this),this.potentialTier=ko.pureComputed(this._potentialTier,this),this.potentialCSP=ko.pureComputed(this._potentialCSP,this),this.powerLevel=ko.pureComputed(this._powerLevel,this),this.classLetter=ko.pureComputed(this._classLetter,this),this.uniqueName=ko.pureComputed(this._uniqueName,this),this.iconBG=ko.pureComputed(this._iconBG,this),this.container=ko.observable(),this.reloadBucket=_.bind(this._reloadBucket,this),this.init(character),this.weapons.subscribe(app.addWeaponTypes),this.items.subscribe(app.addTierTypes),this.statsPane.subscribe(function(currentPane){"more"==currentPane&&_.isEmpty(self.activeBestSets())&&self.optimizeGear("Equipped")()})}tgd.armorItemCreate=function(character){var self=this;self.character=character;var characterClass=self.character.classType();self.bucketType=ko.observable(),self.selectedNewItem=ko.observable(),self.selectedExistingItem=ko.observable(),self.selectedCharacter=ko.observable(),self.lightLevel=ko.observable(tgd.DestinyLightCap),self.armorTypes=["Existing Item","New Item"],self.armorType=ko.observable(),self.selectedStats=_.map(tgd.DestinyArmorStats,function(stat){var tmp={name:stat.statName,value:ko.observable(0)};return tmp}),self.availableCharacterItems=ko.computed(function(){var items=[],bucketType=self.bucketType();return"Existing Item"!=self.armorType()||_.isEmpty(self.selectedCharacter())||(items=_.map(_.filter(self.selectedCharacter().items(),function(item){return item.bucketType==bucketType&&item.primaryStat()>3&&(tgd.DestinyClass[item.classType]==characterClass||"Ghost"==bucketType)}),function(item){return item.uniqueDescription=item.description+" - LL"+item.primaryStat()+" - "+item.statText,item})),items}),self.availableItems=ko.computed(function(){var bucketType=self.bucketType(),items=_.sortBy(_.map(_.filter(_itemDefs,function(item){return tgd.DestinyBucketTypes[item.bucketTypeHash]==bucketType&&""!==item.itemName&&(tgd.DestinyClass[item.classType]==characterClass||"Ghost"==bucketType)}),function(item){return item.itemName=decodeURIComponent(item.itemName),item}),"itemName");return items}),self.activeItem=ko.computed(function(){if(self.selectedNewItem()){var itm=_.clone(self.selectedNewItem());return itm.id=!0,itm.itemInstanceId=itm.itemHash.toString(),itm.perks=_.reduce(self.selectedStats,function(memo,stat){return stat.value()>0&&memo.push({isStat:!0,active:0===memo.length,name:stat.name}),memo},[]),itm.primaryStat={value:self.lightLevel()},itm.stats=_.object(_.map(self.selectedStats,function(stat){return[stat.name,parseInt(stat.value())]})),new Item(itm,self.character)}})},tgd.calculateLoadoutName=function(combo){var loaderType=_.intersection(tgd.weaponTypes,_.flatten(_.map(_.pluck(_.findWhere(combo.set,{bucketType:"Gauntlet"}).perks,"name"),function(name){return name.split(" ")})));loaderType=loaderType.length>0?loaderType[0]:"";var classType=_.findWhere(combo.set,{bucketType:"Helmet"}).character.classType();return"T"+Math.floor(combo.score)+" "+combo.statTierValues+" "+classType+" "+loaderType},tgd.calculatePerkStats=function(combo){return combo.perks=_.filter(_.flatten(_.map(combo.set,function(item){return _.map(item.perks,function(perk){return perk.bucketType=item.bucketType,perk})})),function(perk){return perk.active===!0&&"Class Items"!=perk.bucketType&&_.intersection(tgd.weaponTypes,perk.name.split(" ")).length>0||perk.active===!0&&"Helmet"==perk.bucketType&&-1==perk.isExclusive&&perk.isInherent===!1}),combo.similarityScore=_.values(_.countBy(_.map(_.filter(combo.perks,function(perk){return"Class Items"!=perk.bucketType&&"Helmet"!=perk.bucketType}),function(perk){return _.intersection(tgd.weaponTypes,perk.name.split(" "))[0]}))),combo.similarityScore=3/combo.similarityScore.length+tgd.sum(combo.similarityScore),combo},tgd.calculateBestSets=function(items,rollType){for(var combos=_.map(items,function(selection){var choices=selection[rollType]?[selection]:selection,x=_.flatten(_.map(choices,function(item){return _.map(item[rollType],function(roll){var itemClone=_.clone(item);return itemClone.activeRoll=roll,itemClone})}));return x}),products=tgd.cartesianProductOf(combos),filteredCombos=[],n=0,len2=products.length;len2>n;n++){for(var sets=products[n],exoticItems=0,i=0,len=sets.length;len>i;i++){var item=sets[i];6===item.tierType&&item.hasLifeExotic===!1&&exoticItems++}2>exoticItems&&filteredCombos.push(sets)}var scoredCombos=_.map(filteredCombos,function(items){var tmp=tgd.joinStats(items);delete tmp.bonusOn;var sortedKeys=_.pluck(tgd.DestinyArmorStats,"statName"),statTiers=_.map(sortedKeys,function(name){return name.substring(0,3)+" T"+Math.floor(tmp[name]/tgd.DestinySkillTier)}).join("<br>"),statTierSum=tgd.sum(_.map(sortedKeys,function(name){return Math.floor(tmp[name]/tgd.DestinySkillTier)})),score=parseFloat((tgd.sum(_.map(tmp,function(value,key){var result=Math.floor(value/tgd.DestinySkillTier);return result>5?5:result}))+tgd.sum(_.values(tmp))/1e3).toFixed(3)),statTierValues=_.map(sortedKeys,function(name){return Math.floor(tmp[name]/tgd.DestinySkillTier)}).join("/"),combo={set:items,id:(new Date).getTime()+_.random(1,1e4),stats:tmp,statValues:_.map(sortedKeys,function(name){return tmp[name]}).join("<br>"),statTierValues:statTierValues,statTiers:statTiers,score:score,isValid:statTierSum==Math.floor(score)};return combo}),highestScore=Math.floor(_.max(_.pluck(scoredCombos,"score"))),bestSets=_.uniq(_.filter(scoredCombos,function(combo){return combo.isValid&&combo.score>=highestScore&&-1==combo.statTierValues.indexOf("6")}),!1,function(combo){return combo.statTiers});return bestSets},tgd.armorSelectionFields={Current:{rollType:"rolls",valueType:"All"},Future:{rollType:"futureRolls",valueType:"MaxLightCSP"}},tgd.armorSelection=function(type,groups,character){var self=this;self.character=character,self.groups=groups,self.type=type,self.vendorArmorQueried=ko.observable(!1),self.foundFirstSet=ko.observableArray(),self.armorGroups=ko.observableArray(),self.mostPoints=ko.observableArray(),self.activeView=ko.observable("Custom"==type?"Current":"Future"),self.selectedItems=ko.pureComputed(function(){return _.map(self.armorGroups(),function(group){return group.selectedItem()||group.items()})}),self.bestSets=ko.pureComputed(function(){var bestSets=_.map(tgd.calculateBestSets(self.selectedItems(),tgd.armorSelectionFields[self.activeView()].rollType),function(combo){return tgd.calculatePerkStats(combo)});return bestSets}),self.firstSet=ko.pureComputed(function(){var firstSet=_.clone(_.first(self.mostPoints()));return firstSet&&firstSet.set&&(firstSet.avgRoll=Math.floor(tgd.average(_.map(firstSet.set,function(item){return item.getValue("MaxLightPercent")}))),firstSet.statTiers=firstSet.statTiers.replace(/<br>/g," "),firstSet.statValues=firstSet.statValues.replace(/<br>/g," ")),firstSet}),self.maxSets=ko.pureComputed(function(){return _.filter(self.bestSets(),function(combo){return"MaxLight"==type&&Math.floor(combo.score)>=tgd.maxTierPossible||"Custom"==type})}),self.armorGroups(_.sortBy(_.map(groups,function(items,bucketType){var selectedId=self.foundFirstSet().length>0?_.findWhere(self.foundFirstSet(),{bucketType:bucketType})._id:"";return new tgd.armorGroup(bucketType,items,self.armorGroups,self.maxSets,selectedId,type)}),function(armorGroup){return tgd.DestinyArmorPieces.indexOf(armorGroup.bucketType)})),self.unleveledBucketTypes=ko.pureComputed(function(){return _.pluck(_.filter(self.selectedItems(),function(item){return item&&item.getValue&&item.getValue("Light")!=tgd.DestinyLightCap}),"bucketType").join(", ")}),self.saveSelectedCombo=function(combo){if(confirm("Are you sure you want to save this loadout? Doing so will close this pop up dialog")){app.createLoadout(self.character);var loadoutName=tgd.calculateLoadoutName(combo);app.activeLoadout().name(loadoutName),_.each(combo.set,function(item){app.activeLoadout().addUniqueItem({id:item._id,bucketType:item.bucketType,doEquip:!0,bonusOn:item.activeRoll.bonusOn})}),self.dialog.close()}},self.equipSelectedCombo=function(combo){confirm("Are you sure you want to equip this loadout? Doing so will close this pop up dialog")&&(self.character.equipAction("Max Light Max Tier",combo.score,combo.set),self.dialog.close())},self.setDialog=function(dialog){self.dialog=dialog},self.addCustomItem=function(){var viewModel=new tgd.armorItemCreate(self.character),defaultAction=function(dialogItself){var group,armorItem;if("New Item"==viewModel.armorType()){var hasValidStats=_.reduce(viewModel.selectedStats,function(memo,stat){return $.isNumeric(stat.value())||memo!==!0||(memo=!1),memo},!0),hasValidLight=$.isNumeric(viewModel.lightLevel());hasValidStats?hasValidLight?(group=_.findWhere(self.armorGroups(),{bucketType:viewModel.activeItem().bucketType}),armorItem=new tgd.armorItem(viewModel.activeItem(),group.selectedItem,group.groups,group.bestSets,group.type),group.items.push(armorItem),dialogItself.close()):BootstrapDialog.alert("Invalid light leveled entered, please ensure only numbers are used"):BootstrapDialog.alert("Invalid stats entered, please ensure only numbers are used")}else"Existing Item"==viewModel.armorType()&&(group=_.findWhere(self.armorGroups(),{bucketType:viewModel.bucketType()}),_.isEmpty(viewModel.selectedExistingItem())?_.each(viewModel.availableCharacterItems(),function(item){armorItem=new tgd.armorItem(item,group.selectedItem,group.groups,group.bestSets,group.type),group.items.push(armorItem)}):(armorItem=new tgd.armorItem(viewModel.selectedExistingItem(),group.selectedItem,group.groups,group.bestSets,group.type),group.items.push(armorItem)),dialogItself.close())};new tgd.koDialog({templateName:"armorItemCreateTemplate",viewModel:viewModel,onFinish:defaultAction,buttons:[{label:"Add",cssClass:"btn-primary",action:defaultAction},{label:app.activeText().close_msg,action:function(dialogItself){dialogItself.close()}}]}).title("Add Custom Item").show(!0)},self.addVendorArmor=function(){self.vendorArmorQueried(!0),tgd.showLoading(function(){var valueType=tgd.armorSelectionFields[self.activeView()].valueType;self.character.queryVendorArmor(function(items){_.each(self.armorGroups(),function(group){var bucketItems=_.filter(items,function(item){return item.bucketType==group.bucketType&&item.tierType>=5});_.each(bucketItems,function(item){group.items.push(new tgd.armorItem(item,group.selectedItem,group.groups,group.bestSets,group.type))}),group.items(_.sortBy(group.items(),function(item){return-1*item.getValue(valueType)}))})})})},self.setOtherArmor=function(model,event){tgd.showLoading(function(){var selectionType=event.target.value;_.each(self.armorGroups(),function(group){if(tgd.DestinyOtherArmor.indexOf(group.bucketType)>-1){var selectedItem=null;"Points"==selectionType&&(selectedItem=_.reduce(group.items(),function(memo,item){var isMaxCSP=memo&&item.getValue("All")>memo.getValue("All")||!memo;return isMaxCSP&&(memo=item),memo})),group.selectedItem(selectedItem)}})})},self.setSelection=function(model,event){var selectionType=event.target.value;_.each(self.armorGroups(),function(group){var selectedItem=_.reduce(group.items(),function(memo,item){var isEquipped="Equipped"==selectionType&&item.isEquipped()&&item.character.id==self.character.id,isMaxCSP="Points"==selectionType&&(memo&&item.getValue("All")>memo.getValue("All")||!memo);return(isEquipped||isMaxCSP)&&(memo=item),memo});group.selectedItem(selectedItem)})},self.setView=function(model,event){tgd.showLoading(function(){self.activeView(event.target.value)})},self.setupView=function(activeView){var armorGroups=_.values(groups),rollType=tgd.armorSelectionFields[activeView].rollType,valueType=tgd.armorSelectionFields[activeView].valueType,mostPoints=_.map(armorGroups,function(items){var top2Items=_.first(_.sortBy(items,function(item){return-1*item.getValue(valueType)}),2);return top2Items});self.mostPoints(tgd.calculateBestSets(mostPoints,rollType));var combos=_.sortBy(_.filter(self.mostPoints(),function(combo){return"MaxLight"==type&&Math.floor(combo.score)>=tgd.maxTierPossible||"Custom"==type}),"score");if(combos.length>0)self.foundFirstSet(combos[0].set);else{var helmets=armorGroups.shift();_.each(helmets,function(helmet,index){if(0===self.foundFirstSet().length){var set=_.map(_.clone(armorGroups),function(items){return _.first(_.sortBy(items,function(item){return-1*item.getValue(valueType)}),4)});set.unshift([helmet]);var combos=_.filter(tgd.calculateBestSets(set,rollType),function(combo){return Math.floor(combo.score)>=tgd.maxTierPossible});combos.length>0&&self.foundFirstSet(combos[0].set)}})}self.foundFirstSet().length>0&&_.each(self.armorGroups(),function(group){var uniqueItem=_.findWhere(self.foundFirstSet(),{bucketType:group.bucketType}),selectedItem=_.findWhere(group.items(),{_id:uniqueItem._id});group.selectedItem(selectedItem)})},self.activeView.subscribe(function(newValue){self.setupView(newValue)}),self.setupView(self.activeView())},tgd.armorGroup=function(bucketType,items,groups,bestSets,instanceId,type){var self=this;self.bucketType=bucketType,self.groups=groups,self.bestSets=bestSets,self.type=type,self.selectedItem=ko.observable(),self.items=ko.observableArray(_.sortBy(_.map(items,function(item,index){return new tgd.armorItem(item,self.selectedItem,groups,bestSets,type)}),function(item){return-1*item.getValue("All")})),""===instanceId?self.selectedItem(_.first(self.items())):self.selectedItem(_.findWhere(self.items(),{_id:instanceId}))},tgd.armorItem=function(item,selectedItem,groups,bestSets,type){var self=this;_.extend(self,item);var isSelected=ko.pureComputed(function(){return self==selectedItem()}),isDisabled=ko.pureComputed(function(){if("MaxLight"==type){var items=_.map(groups(),function(group){return group.bucketType==self.bucketType?self:group.selectedItem()?group.selectedItem():group.items()}),validSets=tgd.calculateBestSets(items,"futureRolls");return 0===_.filter(validSets,function(combo){return Math.floor(combo.score)>=tgd.maxTierPossible}).length}return!1}),isInBestSets=ko.pureComputed(function(){return _.filter(bestSets(),function(combo){return _.pluck(combo.set,"_id").indexOf(self._id)>-1}).length>0});self.css=ko.pureComputed(function(){var css="";return css=isSelected()?"selected":!isSelected()&&isInBestSets()?"candidate":isDisabled()?"disabled":"not-selected"}),this.select=function(){isDisabled()?BootstrapDialog.alert("This item cannot be selected to maintain the max tier: "+tgd.maxTierPossible):selectedItem(selectedItem()==self&&confirm("Warning: Unselecting an item will analyze all the same armor pieces, this will increase processing time and might make the app unresponsive, are you sure you want to unselect an item?")?null:self)}},tgd.remoteServer="https://towerghostfordestiny.com",tgd.remoteImagePath=tgd.remoteServer+"/www/",tgd.openTabAs=window.isMobile?"_system":"_blank",tgd.bootstrapGridColumns=24,tgd.autoTransferStacks=!1,tgd.DestinySkillCap=300,tgd.DestinyStatCap=350,tgd.DestinyLightCap=400,tgd.DestinySkillTier=60,tgd.DestinyY1Cap=170,tgd.activeElement=null,tgd.DestinyUnwantedNodes=["Infuse","Upgrade Damage","Upgrade Defense","Arc Damage","Void Damage","Solar Damage","Kinetic Damage","Ascend","Reforge Ready","Twist Fate","Scabbard","Increase Intellect","Increase Strength","Increase Discipline","Deactivate Chroma","Ornament","New SIVA Directive"],tgd.DestinyGeneralItems={"Glimmer Credit":[3632619276,269776572,2904517731,1932910919],"Glimmer Buffs":[3446457162,1043138475,1772853454,3783295803],Synths:[211861343,928169143,2180254632],Parts:[1898539128],Motes:[937555249],Keys:[3881084296,3815757277,2206724918,614056762,4244618453,142694124],Coins:[417308266,1738186005,605475555],Runes:[1565194903,2620224196,1556533319,1314217221,2906158273],"Planetary Resources":[2254123540,2882093969,3164836592,3242866270,1797491610],Telemetries:[4159731660,729893597,3371478409,927802664,4141501356,323927027,3036931873,2610276738,705234570,1485751393,2929837733,846470091],"Reputation Boosters":[2220921114,1500229041,1603376703]},tgd.lostItemsHelper=[420519466,1322081400,2551875383,398517733,583698483,937555249],tgd.invisibleItemsHelper=[2910404660,2537120989],tgd.itemsNotIndexed=[],tgd.DestinyGeneralSearches=_.sortBy(["Keys","Synths","Parts","Motes","Coins","Runes","Planetary Resources","Glimmer Buffs","Glimmer Credit","Telemetries","Engrams","Chroma Colors","Reputation Boosters"]),tgd.DestinyArmorPieces=["Helmet","Gauntlet","Chest","Boots","Class Items","Artifact","Ghost"],tgd.DestinyArmorStats=[144602215,1735777505,4244567218],tgd.cooldownsSuperA=["5:00","4:46","4:31","4:15","3:58","3:40"],tgd.cooldownsSuperB=["5:30","5:14","4:57","4:39","4:20","4:00"],tgd.cooldownsGrenade=["1:00","0:55","0:49","0:42","0:34","0:25"],tgd.cooldownsMelee=["1:10","1:04","0:57","0:49","0:40","0:29"],tgd.subclassesSuperA=[2007186e3,4143670656,2455559914,3658182170],tgd.subclassesStrengthA=[4143670656,1716862031],tgd.DestinyWeaponPieces=["Primary","Special","Heavy"],tgd.DestinyGeneralExceptions=["Ghost","Artifact"],tgd.DestinyOtherArmor=["Ghost","Class Items","Artifact"],tgd.DestinyNonUniqueBuckets=["Consumables","Materials"],tgd.DestinyFiveRowBuckets=["Materials","Consumables","Invisible","Messages","Lost"],tgd.DestinyLayout=[{name:"Weapons",array:"weapons",counts:[108,30],bucketTypes:tgd.DestinyWeaponPieces,extras:[],view:1,headerText:"inventory_weapons"},{name:"Armor",array:"armor",counts:[108,50],bucketTypes:tgd.DestinyArmorPieces,extras:tgd.DestinyGeneralExceptions,view:2,headerText:"inventory_armor"},{name:"Sub Classes",array:"",counts:[0,0],bucketTypes:["Subclasses"],extras:[],view:3,headerText:"inventory_subclasses"},{name:"General",array:"general",counts:[72,80],bucketTypes:["Consumables","Materials","Ornaments","Shader","Emblem","Ship","Sparrow","Horn","Emote"],extras:tgd.DestinyGeneralExceptions,view:3,headerText:"inventory_general"},{name:"Post Master",array:"postmaster",counts:[60,60],bucketTypes:["Messages","Invisible","Lost Items","Bounties","Quests","Mission"],extras:[],view:3,headerText:"inventory_postmaster"}],tgd.DestinyViews={0:"All",1:"Weapons",2:"Armor",3:"General"},tgd.DestinyGender={0:"Male",1:"Female"},tgd.DestinyClass={0:"Titan",1:"Hunter",2:"Warlock"},tgd.DestinyClassNames={},Object.keys(tgd.DestinyClass).forEach(function(key,index){tgd.DestinyClassNames[tgd.DestinyClass[index]]=key}),tgd.DestinyDamageTypes={0:"None",1:"Kinetic",2:"Arc",3:"Solar",4:"Void",5:"Raid"},tgd.DestinyBucketSizes={Materials:20,Consumables:20,Ornaments:12,Bounties:16,Quests:32,Messages:20,Invisible:20,"Lost Items":20},tgd.DestinyBucketTypes={1498876634:"Primary",2465295065:"Special",953998645:"Heavy",3448274439:"Helmet",3551918588:"Gauntlet",14239492:"Chest",20886954:"Boots",2973005342:"Shader",4274335291:"Emblem",2025709351:"Sparrow",284967655:"Ship",3865314626:"Materials",1469714392:"Consumables",1585787867:"Class Items",3284755031:"Subclasses",375726501:"Mission",2197472680:"Bounties",12345:"Post Master",2422292810:"Post Master",1367666825:"Invisible",4023194814:"Ghost",434908299:"Artifact",3054419239:"Emote",1801258597:"Quests",3796357825:"Horn",3313201758:"Ornaments"},tgd.DestinyBucketColumns={Chest:3,Boots:3,Ship:3,Heavy:3,Consumables:4,Primary:3,Class:3,"Class Items":3,Sparrow:3,Special:3,Shader:3,Subclasses:3,Helmet:3,Gauntlet:3,Materials:4,Emblem:3,Bounties:4,Post:4,"Post Master":4,Messages:4,Lost:4,"Lost Items":4,Mission:4,Invisible:4,Ghost:3,Artifact:3,Quests:4,Emote:3,Horn:3,Ornaments:4},tgd.DestinyMaxCSP={Artifact:132,Boots:135,Chest:147,"Class Items":60,Gauntlet:99,Ghost:60,Helmet:111},tgd.infusionStats=[34.5588,34.7389,34.919,35.0991,35.2792,35.4593,35.6394,35.8195,35.9996,36.1797,36.3598,36.5399,36.72,36.9001,37.0802,37.2603,37.4404,37.6205,37.8006,37.9807,38.1608,38.3409,38.521,38.7011,38.8812,39.0613,39.2414,39.4215,39.6016,39.7817,39.9618,40.1419,40.322,40.5021,40.6822,40.8623,41.0424,41.2225,41.4026,41.5827,41.7628,41.9429,42.123,42.3031,42.4832,42.6633,42.8434,43.0235,43.2036,43.3837,43.5638,43.7439,43.924,44.1041,44.2842,44.4643,44.6444,44.8245,45.0046,45.1847,45.3648,45.5449,45.725,45.9051,46.0852,46.2653,46.4454,46.6255,46.8056,46.9857,47.1658,47.3459,47.526,47.7061,47.8862,48.0663,48.2464,48.4265,48.6066,48.7867,48.9668,49.1469,49.327,49.5071,49.6872,49.8673,50.0474,50.2275,50.4076,50.5877,50.7678,50.9479,51.128,51.3081,51.4882,51.6683,51.8484,52.0285,52.2086,52.3887,52.555,52.8096,53.0642,53.3188,53.5734,53.828,54.0826,54.3372,54.5918,54.8464,55.101,55.3556,55.6102,55.8648,56.1194,56.374,56.6286,56.8832,57.1378,57.3924,57.647,57.9016,58.1562,58.4108,58.6654,58.92,59.1746,59.4292,59.6838,59.9384,60.193,60.4476,60.7022,60.9568,61.2114,61.466],tgd.DestinyBucketWeights=[{Primary:13.04,Special:13.04,Heavy:13.04,Helmet:10.87,Gauntlet:10.87,Chest:10.87,Boots:10.87,"Class Items":8.7,Ghost:8.7},{Primary:12,Special:12,Heavy:12,Helmet:10,Gauntlet:10,Chest:10,Boots:10,"Class Items":8,Ghost:8,Artifact:8}],tgd.languages=[{code:"en",description:"English",bungie_code:"en"},{code:"es",description:"Spanish",bungie_code:"es"},{code:"it",description:"Italian",bungie_code:"it"},{code:"de",description:"German",bungie_code:"de"},{code:"ja",description:"Japanese",bungie_code:"ja"},{code:"pt",description:"Portuguese",bungie_code:"pt-br"},{code:"fr",description:"French",bungie_code:"fr"},{code:"tr",description:"Turkish",bungie_code:"en"}],tgd.defaults={searchKeyword:"",doRefresh:isMobile?!1:"true",refreshSeconds:300,tierFilter:0,weaponFilter:0,armorFilter:0,generalFilter:0,dmgFilter:[],activeView:0,activeSort:0,progressFilter:0,showDuplicate:!1,setFilter:[],activeClasses:[],activeStats:[],shareView:!1,shareUrl:"",showMissing:!1,showArmorPerks:!1,showArmorSC:!1,customFilter:!1,tooltipsEnabled:isMobile?!1:"true",advancedTooltips:"true",autoXferStacks:!1,padBucketHeight:isMobile&&!isStaticBrowser?!1:"true",dragAndDrop:!1,xsColumn:tgd.bootstrapGridColumns,smColumn:tgd.bootstrapGridColumns/2,mdColumn:tgd.bootstrapGridColumns/3,lgColumn:tgd.bootstrapGridColumns/4,vaultColumns:tgd.bootstrapGridColumns/4,vaultWidth:tgd.bootstrapGridColumns/4,locale:"en",appLocale:"",vaultPos:0,itemDefs:"",preferredSystem:"PSN",ccWidth:"",layoutMode:"even",autoUpdates:isFirefox||isIOS||isAndroid||isChrome?"true":!1,toastTimeout:2600,armorViewBy:"Light",sectionsTemplate:"image-grid-template",farmMode:!1,farmViewEnabled:!1,farmItems:["Engrams","Glimmer","Rare","Uncommon"],globalItems:["Ghost"],farmTarget:"Vault"},tgd.farmItemFilters={Engrams:function(item){return item.description.indexOf("Engram")>-1&&"Lost Items"!=item.bucketType&&item.isEquipment===!1},Glimmer:function(item){return tgd.DestinyGeneralItems["Glimmer Credit"].indexOf(item.id)>-1},Rare:function(item){return 4==item.tierType&&item.locked()===!1&&(item.armorIndex>-1||item.weaponIndex>-1)&&item.transferStatus<2},Uncommon:function(item){return 3==item.tierType&&item.locked()===!1&&(item.armorIndex>-1||item.weaponIndex>-1)&&item.transferStatus<2}},$.toaster({settings:{toaster:{css:{top:"55px"}},timeout:tgd.defaults.toastTimeout}}),tgd.hammerEvents={singleTap:new Hammer.Tap({event:"singletap"}),doubleTap:new Hammer.Tap({event:"doubletap",taps:2}),tripleTap:new Hammer.Tap({event:"tripletap",taps:3}),holdPress:new Hammer.Press({event:"hold",pointers:1,time:2e3,threshold:1})},tgd.hammerEvents.tripleTap.recognizeWith([tgd.hammerEvents.doubleTap,tgd.hammerEvents.singleTap]),tgd.hammerEvents.doubleTap.recognizeWith(tgd.hammerEvents.singleTap),tgd.hammerEvents.doubleTap.requireFailure(tgd.hammerEvents.tripleTap),tgd.hammerEvents.singleTap.requireFailure([tgd.hammerEvents.tripleTap,tgd.hammerEvents.doubleTap]),tgd.imageErrorHandler=function(src,element,cb){return function(){if(element&&element.src&&""!==element.src){var source=element.src;-1==source.indexOf(tgd.remoteImagePath)&&(element.src=tgd.remoteImagePath+src.replace(tgd.dataDir,"data/"),cb&&cb(element.src))}}},tgd.getEventDelegate=function(target,selector){for(var delegate;target&&target!=this.el;){if(delegate=$(target).filter(selector)[0])return delegate;target=target.parentNode}},window.ko.bindingHandlers.tooltip={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){$(element).tooltip({container:"body",html:!0})}},window.ko.bindingHandlers.itemImageHandler={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){var icon=ko.unwrap(valueAccessor());element.src=icon,element.onerror=tgd.imageErrorHandler(icon,element)},update:function(element,valueAccessor,allBindings,viewModel,bindingContext){var icon=ko.unwrap(valueAccessor());element.src=icon,element.onerror=tgd.imageErrorHandler(icon,element)}},tgd.itemBgImageHandler=function(element,valueAccessor){var $element=$(element),icon=ko.unwrap(valueAccessor()),image=new Image,image2=new Image;image.onerror=tgd.imageErrorHandler(icon,image2,function(newSource){var bgIcon=app.makeBackgroundUrl(newSource,!0);$element.css("background-image",bgIcon)}),image.onload=function(){var bgIcon=app.makeBackgroundUrl(icon,!0);$element.css("background-image",bgIcon)},image.src=icon,image2.src=icon},window.ko.bindingHandlers.itemBgImageHandler={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){tgd.itemBgImageHandler(element,valueAccessor)},update:function(element,valueAccessor,allBindings,viewModel,bindingContext){tgd.itemBgImageHandler(element,valueAccessor)}},window.ko.bindingHandlers.refreshableSection={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){isMobile||$(element).bind("mouseenter",function(){$(this).addClass("titleHover"),$(this).find(".titleRefresh").show()}).bind("mouseleave",function(){$(this).removeClass("titleHover"),$(this).find(".titleRefresh").hide()})}},window.ko.bindingHandlers.refreshableEmblem={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){isMobile||$(element).bind("mouseenter",function(){$(this).addClass("emblemHover")}).bind("mouseleave",function(){$(this).removeClass("emblemHover")})}},window.ko.bindingHandlers.scrollToView={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){Hammer(element,{time:2e3}).on("tap",function(ev){var target=tgd.getEventDelegate(ev.target,".mobile-characters"),index=$(target).index(),distance=$(".profile:eq("+index+")");distance.length>0&&(distance=distance.position().top-50,app.scrollTo(distance))}).on("press",function(ev){var target=tgd.getEventDelegate(ev.target,".mobile-characters-image"),item=ko.contextFor(target).$data;$.toaster({priority:"info",title:"Info",message:app.activeText().this_icon+item.uniqueName(),settings:{timeout:tgd.defaults.toastTimeout}})})}},window.ko.bindingHandlers.fastclick={init:function(element,valueAccessor){return FastClick.attach(element),ko.bindingHandlers.click.init.apply(this,arguments)}},window.ko.bindingHandlers.moveItem={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){var hammer=new Hammer.Manager(element,{});hammer.add([tgd.hammerEvents.tripleTap,tgd.hammerEvents.doubleTap,tgd.hammerEvents.singleTap,tgd.hammerEvents.holdPress]),hammer.on("singletap",function(ev){var target=tgd.getEventDelegate(ev.target,".itemLink");if(target){var item=ko.contextFor(target).$data;tgd.moveItemPositionHandler(target,item)}}).on("doubletap",function(ev){var target=tgd.getEventDelegate(ev.target,".itemLink");if(target){var context=ko.contextFor(target);if(context&&"$data"in context){var item=context.$data;if(item.transferStatus<2||"Subclasses"==item.bucketType)if(app.dynamicMode()===!1&&(app.dynamicMode(!0),app.createLoadout()),item._id>0)app.activeLoadout().addUniqueItem({id:item._id,bucketType:item.bucketType,doEquip:!1});else{var payload={hash:item.id,bucketType:item.bucketType,characterId:item.characterId()};app.activeLoadout().addGenericItem(payload)}else $.toaster({priority:"danger",title:"Warning",message:app.activeText().unable_create_loadout_for_type,settings:{timeout:tgd.defaults.toastTimeout}})}}}).on("hold tripletap",function(ev){var target=tgd.getEventDelegate(ev.target,".itemLink");if(target){var context=ko.contextFor(target);if(context&&"$data"in context){var item=context.$data;item&&item.doEquip&&app.loadoutMode()===!0?(item.doEquip(!item.doEquip()),item.markAsEquip(item,{target:target})):isMobile?($ZamTooltips.lastElement=target,$ZamTooltips.show("destinydb","items",item.id,target)):tgd.moveItemPositionHandler(target,item)}}})}},tgd.DestinyCornRatio=-11.98/.1617,tgd.calculateInfusedStats=function(initial_defense,initial_stat,bucketType){var target_defense=tgd.DestinyStatCap;if(initial_defense>=target_defense||200>initial_defense)return[initial_stat,initial_stat];var newStats=Math.min(tgd.DestinyMaxCSP[bucketType]-tgd.bonusStatPoints(tgd.DestinyArmorPieces.indexOf(bucketType),target_defense),parseInt(initial_stat*((target_defense+tgd.DestinyCornRatio)/(initial_defense+tgd.DestinyCornRatio))));return[newStats,newStats]},tgd.bonusStatPoints=function(armorIndex,light){return 0===armorIndex?291>light?15:307>light?16:319>light?17:332>light?18:19:1===armorIndex?287>light?13:305>light?14:319>light?15:333>light?16:17:2===armorIndex?287>light?20:299>light?21:310>light?22:319>light?23:328>light?24:25:3===armorIndex?284>light?18:298>light?19:309>light?20:319>light?21:329>light?22:23:4===armorIndex?295>light?8:319>light?9:10:5===armorIndex?287>light?34:295>light?35:302>light?36:308>light?37:314>light?38:319>light?39:325>light?40:330>light?41:338>light?42:43:6===armorIndex?295>light?8:319>light?9:10:void 0},tgd.bungie=function(cookieString,complete){function _getAllCookies(callback){if(chrome&&chrome.cookies&&chrome.cookies.getAll)chrome.cookies.getAll({domain:"."+domain},function(){callback.apply(null,arguments)});else{if(!isNWJS)return callback([]),BootstrapDialog.alert("You must enable cookie permissions in Chrome before loading TGD");require("nw.gui").Window.get().cookies.getAll({},function(a,b){callback.apply(null,arguments)})}}function readCookie(cname){for(var name=cname+"=",ca=(cookieString||"").toString().split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0===c.indexOf(name))return c.substring(name.length,c.length)}return""}var active,self=this,domain="bungie.net",url="https://www."+domain+"/",apikey="5cae9cdee67a42848025223b4e61f929";this.bungled="",this.systemIds={},this.requests={},this.requestCookie=function(callback){var event=new CustomEvent("request-cookie-from-ps",{});window.dispatchEvent(event),self.requestCookieCB=callback},this.getCookie=function(name,callback){isChrome?_getAllCookies(function(cookies){for(var c=null,i=0,l=cookies.length;l>i;++i)if(cookies[i].name===name){c=cookies[i];break}callback(c?c.value:null)}):isFirefox?self.requestCookie(callback):callback(readCookie("bungled"));
},this.retryRequest=function(opts){opts.retries?opts.retries>3?opts.complete({error:"network error:"+this.status},response):(opts.retries++,setTimeout(function(){self.request(opts)},1e3*opts.retries)):(opts.retries=0,setTimeout(function(){self.request(opts)},2e3))},this.request=function(opts){-1==opts.route.indexOf("http")&&(opts.route=url+"Platform"+opts.route);var data;opts.payload&&(data=JSON.stringify(opts.payload)),$.ajax({url:opts.route,type:opts.method,headers:{"X-API-Key":apikey,"x-csrf":self.bungled},beforeSend:function(xhr){isMobile&&"string"==typeof cookieString&&_.each(cookieString.split(";"),function(cookie){try{var trimCookie=$.trim(cookie);xhr.setRequestHeader("Cookie",trimCookie)}catch(e){}})},data:data,complete:function(xhr,status){var response;if(xhr.status>=200&&xhr.status<=409){try{response=JSON.parse(xhr.responseText)}catch(e){}if(response&&response.ErrorCode&&(36==response.ErrorCode||1652==response.ErrorCode||1651==response.ErrorCode))self.retryRequest(opts);else{var obj=response;"object"==typeof obj&&"Response"in obj&&(obj=response.Response),opts.complete(obj,response)}}else self.retryRequest(opts)}})},this.getVendorData=function(characterId,vendorId,callback){self.request({route:"/Destiny/"+active.type+"/MyAccount//Character/"+characterId+"/Vendor/"+vendorId+"/Metadata/",method:"GET",complete:callback})},this.vault=function(callback){self.request({route:"/Destiny/"+active.type+"/MyAccount/Vault/",method:"GET",complete:callback})},this.logout=function(callback){self.request({route:url+"en/User/SignOut",method:"GET",complete:callback})},this.login=function(callback){self.request({route:url,method:"GET",complete:callback})},this.getUrl=function(){return url},this.setsystem=function(type){active=self.systemIds.xbl,"PSN"===type&&(active=self.systemIds.psn)},this.getMemberId=function(){return membershipId},this.gamertag=function(){return active?active.id:null},this.system=function(){return systemIds},this.user=function(callback){self.request({route:"/User/GetBungieNetUser/",method:"GET",complete:function(res,response){return response&&response.ErrorCode&&response.ErrorCode>1?void callback({error:response.Message,code:response.ErrorCode}):"undefined"==typeof res?void callback({error:"no response"}):(self.systemIds.xbl={id:res.gamerTag,type:1},self.systemIds.psn={id:res.psnId,type:2},active=self.systemIds.xbl,res.psnId&&(active=self.systemIds.psn),void callback(res))}})},this.account=function(callback){self.request({route:"/Destiny/"+active.type+"/Account/"+active.membership+"/",method:"GET",complete:callback})},this.setlockstate=function(characterId,itemId,state,callback){self.request({route:"/Destiny/SetLockState/",method:"POST",payload:{membershipType:active.type,characterId:characterId,itemId:itemId,state:state},complete:callback})},this.transfer=function(characterId,itemId,itemHash,amount,toVault,callback){self.request({route:"/Destiny/TransferItem/",method:"POST",payload:{characterId:characterId,membershipType:active.type,itemId:itemId,itemReferenceHash:itemHash,stackSize:amount,transferToVault:toVault},complete:callback})},this.equip=function(characterId,itemId,callback){self.request({route:"/Destiny/EquipItem/",method:"POST",payload:{membershipType:active.type,characterId:characterId,itemId:itemId},complete:callback})},this.getAccountSummary=function(callback){self.request({route:"/Destiny/"+active.type+"/Account/"+active.membership+"/Summary/",method:"GET",complete:callback})},this.getItemDetail=function(characterId,instanceId,callback){self.request({route:"/Destiny/"+active.type+"/Account/"+active.membership+"/Character/"+characterId+"/Inventory/"+instanceId+"/",method:"GET",complete:callback})},this.inventory=function(characterId,callback){self.request({route:"/Destiny/"+active.type+"/Account/"+active.membership+"/Character/"+characterId+"/Inventory/",method:"GET",complete:callback})},this.character=function(characterId,callback){self.request({route:"/Destiny/"+active.type+"/Account/"+active.membership+"/Character/"+characterId+"/",method:"GET",complete:callback})},this.search=function(activeSystem,callback){this.setsystem(activeSystem),active&&active.type&&("undefined"==typeof active.membership?self.request({route:"/Destiny/"+active.type+"/Stats/GetMembershipIdByDisplayName/"+active.id+"/",method:"GET",complete:function(membership){return membership>0?(active.membership=membership,void self.account(callback)):void callback({error:!0})}}):self.account(callback))},this.account=function(callback){self.request({route:"/Destiny/"+active.type+"/Account/"+active.membership+"/",method:"GET",complete:callback})},this.flattenItemArray=function(buckets){var items=[];return _.isArray(buckets)?buckets.forEach(function(bucket){bucket.items.forEach(function(item){items.push(item)})}):Object.keys(buckets).forEach(function(bucketName){buckets[bucketName].forEach(function(bucket){bucket.items.forEach(function(item){item.bucketName=bucketName,items.push(item)})})}),items},this.init=function(){isFirefox&&window.addEventListener("response-cookie-from-cs",function(event){self.requestCookieCB(event.detail)}),isChrome&&chrome&&chrome.webRequest&&chrome.webRequest.onBeforeSendHeaders.addListener(function(details){for(var i=0;i<details.requestHeaders.length;++i)if("Origin"===details.requestHeaders[i].name){details.requestHeaders.splice(i,1);break}return{requestHeaders:details.requestHeaders}},{urls:["https://*.bungie.net/*"]},["blocking","requestHeaders"]),isStaticBrowser?complete(""):self.login(function(){self.getCookie("bungled",function(token){self.bungled=token,complete(token)})})},this.init()},tgd.koDialog=function(options){var dialog=new tgd.dialog(options),id=(new Date).getTime(),mdl=dialog.modal,hasTemplate=options.templateName&&""!==options.templateName;if(hasTemplate){var template=tgd[options.templateName]({id:id});mdl.setMessage(template)}return mdl.onHide(function(){options.onFinish&&$(document).unbind("keyup.dialog"),hasTemplate&&ko.cleanNode(document.getElementById("container_"+id))}),mdl.onShow(function(instance){var activeModal=instance.getModal();activeModal.on("shown.bs.modal",function(){options.viewModel&&options.viewModel.setDialog&&options.viewModel.setDialog(mdl),options.onFinish&&$(document).unbind("keyup.dialog").bind("keyup.dialog",function(e){var code=e.which;13==code&&(options.onFinish(mdl),$(document).unbind("keyup.dialog"))}),hasTemplate&&ko.applyBindings(options.viewModel,document.getElementById("container_"+id))})}),dialog},tgd.dialog=function(options){var self=this;return this.modal=new BootstrapDialog(options),this.modal.setSize(BootstrapDialog.SIZE_WIDE),this.options=options,self},tgd.dialog.prototype={title:function(title){return this.modal.setTitle(title),this},content:function(content){return this.modal.setMessage(content),this},buttons:function(buttons){return this.modal.setClosable(!0).enableButtons(!0).setData("buttons",buttons),this},show:function(excludeClick,onHide,onShown){var self=this;self.modal.open();var mdl=self.modal.getModal();return excludeClick||mdl.bind("click",function(){self.modal.close()}),mdl.on("hide.bs.modal",onHide),mdl.on("shown.bs.modal",onShown),self}},tgd.extrasPopup=function(item){var self=this;self.item=item,self.characters=app.orderedCharacters;var selectedStatus=ko.observable(_.reduce(self.characters(),function(memo,character){return memo[character.id]="Vault"!==character.id,memo},{}));self.total=ko.computed(function(){return _.reduce(self.characters(),function(memo,character){var items=_.where(character.items(),{description:self.item.description});return memo+=_.reduce(items,function(memo,i){return memo+i.primaryStat()},0)},0)}),self.selectedCharacters=ko.computed(function(){return _.filter(self.characters(),function(c){return selectedStatus()[c.id]===!0})}),self.setSelectedCharacter=function(){var ss=selectedStatus();ss[this.id]=!ss[this.id],selectedStatus(ss)},self.setDialog=function(dialog){self.dialog=dialog}},tgd.Layout=function(layout){var self=this;self.name=layout.name,self.id=layout.view,self.bucketTypes=layout.bucketTypes,self.extras=layout.extras,self.headerText=layout.headerText,self.array=layout.array,self.counts=layout.counts,self.activeBucketTypes=ko.computed(self._activeBucketTypes,self)},tgd.Layout.prototype={_activeBucketTypes:function(){var self=this,bucketTypes=self.bucketTypes;return"3"==app.activeView()&&(bucketTypes=bucketTypes.concat(self.extras)),bucketTypes},countText:function(character){var self=this;return ko.pureComputed(function(){var text="";if(""!==self.array&&"Vault"==character.id&&_.has(character,self.array)){var currentAmount=character[self.array]().length,totalAmount="Vault"==character.id?self.counts[0]:self.counts[1];text="("+currentAmount+"/"+totalAmount+")",currentAmount==totalAmount&&(text="<label class='label label-danger'>"+text+"</label>")}return text})},titleText:function(character){var self=this;return"Vault"==character.id&&"Sub Classes"==self.name?"Vault Sub Classes":app.activeText()[self.headerText]},isVisible:function(character){var self=this;return"Vault"==character.id&&"Post Master"!==self.name||"Vault"!==character.id}},tgd.loadoutActionStates={0:{actionIcon:"assets/no-transfer.png"},1:{actionIcon:"assets/to-transfer.png"},2:{actionIcon:"assets/to-equip.png"},3:{actionIcon:"assets/swap.png"}},tgd.loadoutPair=function(pair,targetCharacter){var self=this;_.extend(self,pair);var compiledTemplate=_.template(pair.description);this.swapItem=ko.observable(self.swapItem),this.actionIcon=tgd.loadoutActionStates[pair.actionState].actionIcon,this.description=ko.computed(function(){var templateData={item:self.targetItem,swapItem:self.swapItem(),targetCharacter:targetCharacter};return compiledTemplate(templateData)}),this.activeTargetIcon=ko.computed(function(){return self.targetItem&&self.targetItem.icon||self.targetIcon}),this.activeSwapIcon=ko.computed(function(){return self.swapItem()&&self.swapItem().icon||self.swapIcon})},tgd.loadoutsTransferConfirm=function(masterSwapArray,targetCharacter){var self=this;self.swapArray=_.map(masterSwapArray,function(pair){return new tgd.loadoutPair(pair,targetCharacter)}),self.changeSwapItem=function(pair){if(pair&&pair.swapItem){var items=targetCharacter.all(pair.swapItem().bucketType),swapIds=_.pluck(_.map(self.swapArray,function(pair){return pair.swapItem()}),"_id"),candidates=_.filter(items,function(candidate){return(-1==swapIds.indexOf(candidate._id)||candidate._id==pair.swapItem()._id)&&candidate.transferStatus<2}),index=candidates.indexOf(pair.swapItem())+1;index>candidates.length-1&&(index=0),pair.swapItem(candidates[index])}},self.getSwapArray=function(){return _.map(self.swapArray,function(pair){return pair.swapItem=ko.unwrap(pair.swapItem),pair})}},tgd.loadoutManager=function(loadouts,dialog){var self=this;self.loadouts=loadouts,self.characterId=ko.observable(""),self.orderedCharacters=app.orderedCharacters,self.setDialog=function(dialog){self.dialog=dialog},this.isDisabled=function(direction,context,name){return ko.computed(function(){var activeClass="";if(_.has(context,"$index")){var activeLoadouts=self.loadouts(),itemsInGroup=_.filter(activeLoadouts,function(l){return l.characterId()==self.characterId()||_.isEmpty(l.characterId())&&_.isEmpty(self.characterId())}),startIndex=_.indexOf(activeLoadouts,_.first(itemsInGroup)),currentIndex=context.$index()-startIndex;"up"==direction&&0==currentIndex?activeClass="disabled":"down"==direction&&currentIndex==itemsInGroup.length-1&&(activeClass="disabled")}return activeClass})},self.equip=function(){confirm("Are you sure you want to close this dialog and open the Loadouts panel to equip this set?")&&(this.setActive(),self.dialog.close())}},tgd.loadoutId=0,tgd.LoadoutItem=function(model){var self=this;_.each(model,function(value,key){self[key]=value});var _doEquip=model&&"undefined"==typeof model.hash?self.doEquip&&"true"==self.doEquip.toString()||!1:!1;self.doEquip=ko.observable(_doEquip),self.doSwap=_.has(self,"doSwap")?self.doSwap:!1},tgd.Loadout=function(model,isItems,character){var self=this;_.each(model,function(value,key){self[key]=value}),this.characters=ko.observableArray(),this.loadoutId=tgd.loadoutId++;var _characterId="";if(_.has(character,"id")?_characterId=character.id:_.has(model,"characterId")&&(_characterId=model.characterId),(_.isEmpty(_characterId)||_.isUndefined(_characterId))&&(_characterId=""),this.characterId=ko.observable(_characterId||""),this.doAssign=ko.observable(!1),this.name=ko.observable(self.name||""),this.ids=ko.observableArray(),this.generics=ko.observableArray(),this.items=ko.pureComputed(function(){var _items=[];return _.each(self.ids(),function(equip){if(equip){var itemFound=self.findItemById(equip.id);itemFound&&(itemFound.doEquip=equip.doEquip,itemFound.doSwap=equip.doSwap,itemFound.markAsEquip=self.markAsEquip,equip&&equip.bonusOn&&(itemFound.bonusOn=equip.bonusOn),_items.push(itemFound))}}),_.each(self.generics(),function(item){if(item&&item.hash){var itemFound=self.findItemByHash(item.hash,item.characterId);itemFound&&(itemFound.doEquip=item.doEquip,itemFound.doSwap=item.doSwap,itemFound.markAsEquip=self.markAsEquip,_items.push(itemFound))}}),_items.sort(function(a,b){return a.armorIndex>-1?a.armorIndex-b.armorIndex:a.weaponIndex>-1?a.weaponIndex-b.weaponIndex:-1})}),this.editing=ko.observable(!1),this.sortUp=function(){var currentIndex=app.loadouts.indexOf(self),nextIndex=currentIndex-1;self.sortDirection(currentIndex,nextIndex)},this.sortDown=function(){var currentIndex=app.loadouts.indexOf(self),nextIndex=currentIndex+1;self.sortDirection(currentIndex,nextIndex)},this.sortDirection=function(currentIndex,nextIndex){var ref=app.loadouts.splice(currentIndex,1);app.loadouts.splice(nextIndex,0,ref[0])},this.rename=function(){self.editing(!self.editing())},this.markAsEquip=function(item,event){var existingItems=_.where(self.ids(),{bucketType:item.bucketType}).filter(function(loadoutItem){var foundItem=_.find(self.items(),{_id:loadoutItem.id});return foundItem?"Subclasses"==item.bucketType||-1!=foundItem.armorIndex?item.doEquip()===!0&&item._id!=loadoutItem.id&&item.character.classType()==foundItem.character.classType():item.doEquip()===!0&&item._id!=loadoutItem.id:!1});return 6==item.tierType&&item.hasLifeExotic===!1&&item.doEquip()&&_.each(self.ids(),function(equip){var itemFound=self.findItemById(equip.id);itemFound&&itemFound.tierType&&6==itemFound.tierType&&itemFound.hasLifeExotic===!1&&equip.doEquip()&&equip.id!=item._id&&(item.weaponIndex>-1&&itemFound.weaponIndex>-1||item.armorIndex>-1&&itemFound.armorIndex>-1)&&existingItems.push(equip)}),existingItems.length>0&&_.each(existingItems,function(loadoutItem){loadoutItem.doEquip(!1)}),item.doEquip()&&_.findWhere(self.ids(),{id:item._id}).doEquip(!0),!0},isItems)_.each(model,function(item){item._id>0?self.addUniqueItem({id:item._id,bucketType:item.bucketType,doEquip:!1}):self.addGenericItem({hash:item.id,bucketType:item.bucketType,characterId:item.characterId()})});else if(model&&model.ids&&model.ids.length>0){var firstItem=model.ids[0];if(firstItem&&_.isString(firstItem)){var _ids=[];_.each(model.ids,function(id){var equipDef=_.findWhere(model.equipIds,{_id:id}),item=self.findItemById(id);item&&_ids.push(new tgd.LoadoutItem({id:id,bucketType:equipDef?equipDef.bucketType:item.bucketType,doEquip:equipDef?!0:!1}))}),self.ids(_ids)}else self.ids(_.map(model.ids,function(obj){return new tgd.LoadoutItem(obj)})),self.generics(_.map(model.generics,function(obj){return new tgd.LoadoutItem(obj)}))}},tgd.Loadout.prototype={normalize:function(bucketTypes,extras){var arrUnion=_.difference(extras,bucketTypes),arr=[];return arr=arrUnion.length==extras.length?_.union(bucketTypes,extras):_.difference(bucketTypes,extras)},compareLoadout:function(){var ids=_.pluck(this.items(),"id").join(",");window.open("http://db.destinytracker.com/compare/"+ids,tgd.openTabAs)},setActive:function(){_.isEmpty(this.characterId())||_.findWhere(app.characters(),{id:this.characterId()}).statsShowing(!1),app.loadoutMode(!0),app.dynamicMode(!1),app.activeLoadout(_.clone(this))},remove:function(){if(confirm("Are you sure you want to remove this loadout? This action cannot be undone")){var ref=_.findWhere(app.loadouts(),{loadoutId:this.loadoutId});app.loadouts.remove(ref),app.createLoadout(),app.saveLoadouts(),app.loadoutMode(!1)}},assign:function(){this.doAssign(!this.doAssign())},save:function(){var ref=_.findWhere(app.loadouts(),{loadoutId:this.loadoutId}),nextIndex=app.loadouts().length-1;ref&&(nextIndex=app.loadouts().indexOf(ref),app.loadouts.splice(nextIndex,1)),app.loadouts.splice(nextIndex,0,this),app.saveLoadouts()},saveNew:function(){var app=this.character?this.character:app;app.loadouts.push(this),app.saveLoadouts()},addUniqueItem:function(obj){var li=new tgd.LoadoutItem(obj);this.ids.push(li)},addGenericItem:function(obj){var li=new tgd.LoadoutItem(obj);this.generics.push(li)},findItemByHash:function(hash,characterId){var itemFound;return app.characters().forEach(function(character){var match=_.filter(character.items(),function(item){return characterId?item.id==hash&&item.characterId()==characterId:item.id==hash})[0];match&&(itemFound=_.clone(match))}),itemFound},findItemById:function(id){var itemFound;return app.characters().forEach(function(character){var match=_.findWhere(character.items(),{_id:id});match&&(itemFound=_.clone(match))}),itemFound},swapItems:function(swapArray,targetCharacterId,callback){var self=this;tgd.autoTransferStacks=!0;var itemIndex=-1,increments=parseInt(Math.round(95/(1*swapArray.length))),progressValue=5,loader=$(".bootstrap-dialog-message .progress").show().find(".progress-bar").width(progressValue+"%"),transferNextItem=function(){var targetItem,swapItem,targetOwner,pair=swapArray[++itemIndex];progressValue+=increments,loader.width(progressValue+"%");var transferTargetItemToVault=function(complete){if(targetItem=pair.targetItem,"undefined"!=typeof targetItem)if(targetOwner=targetItem.character.id,"Vault"==targetOwner)complete();else{var originalCharacterId=targetItem.character.id;targetItem.store("Vault",function(profile){profile.id==originalCharacterId?($.toaster({priority:"danger",title:"Error",message:"Unable to unequip "+targetItem.description+" while playing in game"}),complete()):complete()})}else complete()},transferSwapItemToVault=function(complete){if(swapItem=pair.swapItem,"Vault"==swapItem.character.id)complete();else{var originalCharacterId=swapItem.character.id;swapItem.store("Vault",function(profile){if(profile.id==originalCharacterId){var equippedItem=swapItem,swapAndTargetIDs=_.flatten(_.map(swapArray,function(pair){var tmp=[];return pair.swapItem&&tmp.push(pair.swapItem._id),pair.targetItem&&tmp.push(pair.targetItem._id),tmp})),candidates=_.filter(swapItem.character.get(swapItem.bucketType),function(item){var isCandidate=-1==swapAndTargetIDs.indexOf(item._id)&&item.transferStatus<2;return isCandidate});candidates.length>0?(swapItem=candidates[0],swapItem.store("Vault",function(){complete()})):($.toaster({priority:"danger",title:"Error",message:"Unable to unequip "+equippedItem.description+" while playing in game"}),pair.swapItem=pair.targetItem=targetItem=swapItem=null,complete())}else complete()})}},transferTargetItemToDestination=function(complete){if("undefined"==typeof targetItem&&pair.targetItem&&(targetItem=pair.targetItem),targetItem){var action=0===_.where(self.ids(),{id:targetItem._id}).filter(function(item){return item.doEquip()===!0}).length?"store":"equip";if("Vault"==targetCharacterId&&"Vault"==targetItem.character.id)complete();else{var originalCharacterId=targetItem.character.id;targetItem[action](targetCharacterId,function(profile){profile.id==originalCharacterId?($.toaster({priority:"danger",title:"Error",message:"Unable to unequip "+targetItem.description+" while playing in game"}),complete()):complete()})}}else complete()},transferSwapItemToDestination=function(complete){"undefined"==typeof swapItem&&pair.swapItem&&(swapItem=pair.swapItem),swapItem?"Vault"==targetOwner&&"Vault"==swapItem.character.id?complete():swapItem.store(targetOwner,complete):complete()},startSwapping=function(finish){transferTargetItemToVault(function(){transferSwapItemToVault(function(){transferTargetItemToDestination(function(){transferSwapItemToDestination(function(){finish?finish():transferNextItem()})})})})},checkAndMakeFreeSpace=function(ref,spaceNeeded,fnHasFreeSpace){var item=ref;if("undefined"==typeof item)return BootstrapDialog.alert(self.description+": Item not found while attempting to transfer the item "+ref.description);if("Subclasses"==ref.bucketType)return fnHasFreeSpace();var otherBucketTypes,vault=_.findWhere(app.characters(),{id:"Vault"}),bucketType=item.bucketType,layout=_.filter(tgd.DestinyLayout,function(layout){return layout.bucketTypes.indexOf(bucketType)>-1&&-1==layout.extras.indexOf(bucketType)||-1==layout.bucketTypes.indexOf(bucketType)&&layout.extras.indexOf(bucketType)>-1})[0],actualBucketTypes=self.normalize(layout.bucketTypes,layout.extras),spaceNeededInVault=layout.counts[0]-spaceNeeded,spaceUsedInVault=_.filter(vault.items(),function(otherItem){return otherItem.actualBucketType==item.actualBucketType}).length;if(spaceNeededInVault>=spaceUsedInVault)fnHasFreeSpace();else{var maxFreeSpace=9,tmpItems=[],tmpIds=[],freeSpaceNeeded=spaceUsedInVault-spaceNeededInVault;otherBucketTypes=[].concat(actualBucketTypes),otherBucketTypes.splice(otherBucketTypes.indexOf(bucketType),1),_.each(otherBucketTypes,function(bucketType){-1==tgd.DestinyNonUniqueBuckets.indexOf(bucketType)&&_.each(app.characters(),function(character){if(freeSpaceNeeded>0&&"Vault"!=character.id){var freeSpace=maxFreeSpace-character.get(bucketType).length;if(freeSpace>0){var itemsToMove=vault.get(bucketType);_.each(itemsToMove,function(item){freeSpaceNeeded>0&&freeSpace>0&&-1==tmpIds.indexOf(item._id)&&(tmpItems.push({item:item,character:character}),tmpIds.push(item._id),freeSpaceNeeded-=1,freeSpace-=1)})}}})});var preCount=0,postCount=0,finish=function(){postCount++,postCount==tmpItems.length&&transferNextItem()},done=function(){preCount++,preCount==tmpItems.length&&fnHasFreeSpace(function(){_.each(tmpItems,function(pair){pair.item.store("Vault",finish)})})};_.each(tmpItems,function(pair){pair.item.store(pair.character.id,done)})}};pair?"undefined"!=typeof pair.swapItem?checkAndMakeFreeSpace(pair.swapItem,2,startSwapping):"undefined"!=typeof pair.targetItem&&pair.actionState>0?checkAndMakeFreeSpace(pair.targetItem,1,function(callback){transferTargetItemToDestination(function(){callback?callback():transferNextItem()})}):transferNextItem():(tgd.autoTransferStacks=!1,callback&&callback())};app.activeLoadout(new tgd.Loadout),app.loadoutMode(!1),transferNextItem()},transfer:function(targetCharacterId,callback){var self=this,targetCharacter=_.findWhere(app.characters(),{id:targetCharacterId});if("undefined"==typeof targetCharacter)return BootstrapDialog.alert("Target character not found");var targetCharacterIcon=targetCharacter.icon(),getFirstItem=function(sourceBucketIds,itemFound){return function(otherItem){return-1==sourceBucketIds.indexOf(otherItem._id)&&itemFound===!1?(itemFound=!0,sourceBucketIds.push(otherItem._id),otherItem):void 0}},getSwapItem=function(item,targetBucket,sourceBucketIds){var itemFound=!1,sourceBucketHashes=_.pluck(_.where(item.character.items(),{bucketType:item.bucketType}),"id"),transferables=_.filter(targetBucket,function(otherItem){return otherItem.transferStatus<2}),candidates=_.filter(transferables,function(otherItem){var index=sourceBucketHashes.indexOf(otherItem.id);return-1==index});return swapItem=_.filter(_.where(candidates,{type:item.type}),getFirstItem(sourceBucketIds,itemFound)),0===swapItem.length,swapItem=swapItem.length>0?swapItem[0]:_.filter(candidates,getFirstItem(sourceBucketIds,itemFound))[0],swapItem||(swapItem=_.filter(transferables,getFirstItem(sourceBucketIds,itemFound))[0]),swapItem},masterSwapArray=[],sourceItems=self.items();if(sourceItems.length>0){var targetList=targetCharacter.items(),sourceGroups=_.groupBy(sourceItems,"bucketType"),targetGroups=_.groupBy(targetList,"bucketType");masterSwapArray=_.flatten(_.map(sourceGroups,function(group,key){var sourceBucket=sourceGroups[key],targetBucket=targetGroups[key]||[],swapArray=[];if(sourceBucket&&targetBucket)if(-1==tgd.DestinyNonUniqueBuckets.indexOf(key)){var maxBucketSize=10,targetBucketSize=targetBucket.length;if("Vault"==targetCharacter.id){var layout=_.filter(tgd.DestinyLayout,function(layout){return layout.bucketTypes.indexOf(key)>-1&&-1==layout.extras.indexOf(key)||-1==layout.bucketTypes.indexOf(key)&&layout.extras.indexOf(key)>-1})[0],actualBucketTypes=self.normalize(layout.bucketTypes,layout.extras);targetBucketSize=_.filter(targetCharacter.items(),function(item){return actualBucketTypes.indexOf(item.bucketType)>-1}).length,maxBucketSize=layout.counts[0]}var sourceBucketIds=_.pluck(sourceBucket,"_id");swapArray=sourceBucket.length+targetBucketSize>maxBucketSize?_.map(sourceBucket,function(item){var ownerIcon=item.character.icon();if(_.findWhere(targetBucket,{_id:item._id}))return item.doEquip()===!0?{targetItem:item,actionState:2,description:"<%= item.description %> <%= app.activeText().loadouts_to_equip %>",swapIcon:targetCharacterIcon}:{targetItem:item,actionState:0,description:"<%= item.description %> <%= app.activeText().loadouts_alreadythere_pt1 %> <%= targetCharacter.classType() %> <%= app.activeText().loadouts_alreadythere_pt2 %> <%= item.bucketType %>",targetIcon:item.icon,swapIcon:ownerIcon};var swapItem;return swapItem="Shader"==item.bucketType?_.filter(targetBucket,function(otherItem){return otherItem.bucketType==item.bucketType&&"Default Shader"!=otherItem.description&&-1==sourceBucketIds.indexOf(otherItem._id)})[0]:getSwapItem(item,targetBucket,sourceBucketIds),swapItem?(targetBucket.splice(targetBucket.indexOf(swapItem),1),-1!=swapItem.armorIndex&&"Vault"!=item.character.id&&item.character.classType()!=targetCharacter.classType()?{targetItem:item,actionState:0,description:"<%= item.description %> <%= app.activeText().loadouts_no_transfer %>",targetIcon:item.icon,swapIcon:ownerIcon}:{targetItem:item,swapItem:swapItem,actionState:3,description:"<%= item.description %> <%= app.activeText().loadouts_swap %> <%= swapItem.description %>"}):{targetItem:item,actionState:1,description:"<%= item.description %> <%= app.activeText().loadouts_to_transfer %>",swapIcon:targetCharacterIcon,actionIcon:"assets/to-transfer.png"}}):_.map(sourceBucket,function(item){var ownerIcon=item.character.icon();if(_.findWhere(targetBucket,{_id:item._id}))return item.doEquip()===!0?{targetItem:item,actionState:2,description:"<%= item.description %> <%= app.activeText().loadouts_to_equip %>",actionIcon:"assets/to-equip.png",swapIcon:targetCharacterIcon}:{targetItem:item,actionState:0,description:"<%= item.description %> <%= app.activeText().loadouts_alreadythere_pt1 %> <%= targetCharacter.classType() %>  <%= app.activeText().loadouts_alreadythere_pt2 %> <%= item.bucketType %>",targetIcon:item.icon,actionIcon:"assets/no-transfer.png",swapIcon:ownerIcon};if("Subclasses"==item.bucketType)return{targetItem:item,actionState:0,description:"<%= item.description %> <%= app.activeText().loadouts_no_transfer %>",targetIcon:item.icon,swapIcon:ownerIcon};if(1==item.doSwap){var swapItem=getSwapItem(item,targetBucket,sourceBucketIds);return{targetItem:item,swapItem:swapItem,actionState:3,description:"<%= item.description %> <%= app.activeText().loadouts_swap %> <%= swapItem.description %>"}}return item.doEquip()===!0?{targetItem:item,actionState:2,description:"<%= item.description %> <%= app.activeText().loadouts_to_moveequip %>",swapIcon:targetCharacterIcon}:{targetItem:item,actionState:1,description:"<%= item.description %> <%= app.activeText().loadouts_to_transfer %>",swapIcon:targetCharacterIcon}})}else swapArray=_.map(sourceBucket,function(item){return{targetItem:item,actionState:1,description:"<%= item.description %> <%= app.activeText().loadouts_to_transfer %>",swapIcon:targetCharacterIcon}});return swapArray}))}if(callback){if(!_.isFunction(callback))return masterSwapArray;callback(masterSwapArray)}else self.promptUserConfirm(masterSwapArray,targetCharacterId)},promptUserConfirm:function(masterSwapArray,targetCharacterId,callback){if(masterSwapArray.length>0){var self=this,targetCharacter=_.findWhere(app.characters(),{id:targetCharacterId}),ltc=new tgd.loadoutsTransferConfirm(masterSwapArray,targetCharacter),transfer=function(dialog){self.swapItems(ltc.getSwapArray(),targetCharacterId,function(){$.toaster({settings:{timeout:15e3},priority:"success",title:"Success",message:app.activeText().loadouts_transferred}),setTimeout(function(){$(".donateLink").click(app.showDonate)},1e3),app.dynamicMode(!1),dialog.close(),callback&&callback(targetCharacter)})};new tgd.koDialog({templateName:"swapTemplate",viewModel:ltc,onFinish:transfer,buttons:[{label:app.activeText().loadouts_transfer,action:transfer},{label:app.activeText().cancel,action:function(dialog){dialog.close()}}]}).title(app.activeText().loadouts_transfer_confirm).show(!0)}}},tgd.locale={en:{agility:"Agility",armor:"Armor",best_combo:"Best Combo",cancel:"Cancel",cannot_equip:"Unknown error trying to equip ",cannot_unequip:"No more items to try to unequip the ",close_msg:"Close",ok_msg:"OK",disc:"Disc",discipline:"Discipline",donation_instructions:"This is a non-commercial project dedicated to Destiny. If you like this app provide a donation to keep this project alive and support the maintenance costs.",donation_title:"Donations for Tower Ghost for Destiny!",error_loading_inventory:"Error loading inventory ",gear_with_highest:"Equip Gear With Highest:",inte:"Int",intellect:"Intellect",invalid_transfer_amount:"Invalid amount entered: ",inventory_armor:"Armor",inventory_general:"General",inventory_postmaster:"Post Master",inventory_postmaster_messages:"Messages",inventory_postmaster_lost_items:"Lost Items",inventory_subclasses:"Sub Classes",inventory_weapons:"Weapons",itemDefs_undefined:"Could not load item definitions, please report the issue to my Github including the version number being used.",language_pack_downloaded:"Language Pack downloaded, please refresh to see the changes",language_text:"This will change the language for all items and the interface for some languages, more languages will be added in the future.",light:"Light",loadouts_alreadythere_pt1:" is already in the ",loadouts_alreadythere_pt2:"'s bucket of ",loadouts_delete:"Delete",loadouts_desktop:"check",loadouts_instructions:"No items in loadout, click items to add, ",loadouts_instructions_contd:" to equip.",loadouts_invalidbucket:" will not be moved. Because of this bucket: ",loadouts_mobile:"hold",loadouts_no_replacement:" will not be moved. There is no item to replace it.",loadouts_no_transfer:" will not be moved",loadouts_outofspace:" will not be moved, there is no space in ",loadouts_save:"Save",loadouts_save_new:"Save As",loadouts_swap:" will be swapped with ",loadouts_to_equip:" will be equipped.",loadouts_to_moveequip:" will be moved and equipped.",loadouts_to_transfer:" will be moved",loadouts_transfer:"Transfer",loadouts_transfer_confirm:"Transfer Confirm",loadouts_transferred:'<strong>Item(s) Transferred!</strong><br>If you like this app remember to <a style="color:#3080CF; cursor:pointer;" class="donateLink" target="_system">buy me a beer</a>.',login_authenticating_pt1:"Logging into Bungie... Please be patient.",login_authenticating_pt2:"If log in screen remains for 2+ minutes, use these links for",login_authenticating_pt3:"to retry login. If the problem persists, reinstall the app.",login_help:"Please wait for the login window to auto close as TGD prepares your information.",login_instructions:"To get started you'll need to log in to your Bungie.net account via:",login_loading_updates:"Please wait, downloading auto updates",login_loading_inventory:"Please wait, loading arsenal from Bungie",login_title:"Welcome to Tower Ghost for Destiny!",menu_viewformat:"View Format",menu_viewimagegrid:"Image Grid",
menu_viewitemlist:"Items List",menu_about:"About",menu_advancedtooltips:"Advanced Tooltips",menu_all:"All",menu_autorefresh:"Auto Refresh (5 min)",menu_autotransfer:"Auto Transfer Stacks",menu_clear:"Clear Filters",menu_destinydbtooltips:"DestinyDB Tooltips",menu_destinydbmode:"DestinyDB Mode",menu_destinystatus:"DestinyStatus Report",menu_destinytrials:"DestinyTrials Report",menu_destinytracker:"DestinyTracker Report",menu_destinyguardiangg:"Guardian.GG Report",menu_damage:"Damage",menu_donate:"Donate",menu_filter_by:"Filter By",menu_filter_by_subclass_eq:"Subclass Equipped",menu_filter_by_weapon_eq:"Weapons Equipped",menu_filter_for_class:"Filter for Class",menu_help:"Help",menu_language:"Language",menu_loadouts:"Loadouts",menu_loadouts_create:"Create",menu_loadouts_manage:"Manage",menu_padheight:"Auto Pad Height",menu_progress:"Progress",menu_progress_1:"Missing Perks",menu_progress_2:"Missing Border",menu_progress_3:"Maxed",menu_refresh:"Refresh (secs)",menu_set:"Set",menu_set_showmissing:"Show Missing Items",menu_set_showduplicates:"Show Duplicate Items",menu_settings:"Settings",menu_options:"More",menu_shareurl:"Share URL with friends",menu_sortby:"Sort By",menu_sortby_lightlvl:"Light Level",menu_sortby_name:"Name",menu_sortby_type:"Type",menu_sortby_tier_type:"Tier, Type, Light",menu_sortby_tier_light:"Tier, Light",menu_sortby_tier_name:"Tier, Name",menu_sortby_type_light:"Type, Light",menu_tier:"Tier",menu_usexbox:"Use Xbox Account",menu_useps:"Use Playstation Account",menu_view:"View",menu_view_armor:"Armor",menu_view_by:"View By",menu_view_by_lightlvl:"Light Level",menu_view_by_stat_points:"Combined Stat Points",menu_view_general:"General",menu_view_options:"View Options",menu_view_weapons:"Weapons",missing_items:"Missing Items",most_points:"Points",movepopup_move:"Move",movepopup_store:"store",movepopup_equip:"equip",movepopup_vault:"vault",movepopup_extras:"extras",normalize:"Normalize",normalize_title:"Normalize - equally distribute item across your characters",paypal_code:"EN",pick_a_set:"Please pick a Set before selecting this option",strength:"Strength",recovery:"Recovery",str:"Str",text_shareurl:"Your inventory is updated by clicking on Share URL from the menu again.",this_icon:"This icon is ",tier_common:"Common",tier_exotic:"Exotic",tier_legendary:"Legendary",tier_rare:"Rare",tier_uncommon:"Uncommon",transfer:"Transfer",transfer_all:"All",transfer_amount:"Transfer Amount",transfer_ask:"Don't ask in the future",consolidate:"Consolidate",transfer_consolidate:"Consolidate (pull from all characters",transfer_one:"One",unable_create_loadout_for_type:"Currently unable to create loadouts with this item type.",unable_unequip:"Unable to unequip ",unable_to_create_loadout_for_bucket:"You cannot create a loadout with more than 10 items in this slot: ",unable_to_move_bucketitems:"This item cannot be transferred with the API.",vo_container_width:"Container Width",vo_layout_mode:"Vault Mode",vo_layout_mode_cust:"Custom",vo_layout_mode_def:"Default",vo_number_of_columns:"Number of Columns",vo_vault_columns:"Vault Columns",vo_vault_first:"First/Left",vo_vault_last:"Last/Right",vo_vault_position:"Vault Position",vo_vault_width:"Vault Width",whats_new_title:"Tower Ghost for Destiny Updates"},de:{agility:"Agil",armor:"Rstg",best_combo:"Beste Komb.",cancel:"Abbrechen",cannot_equip:"Unbekannter Fehler beim Ausrüsten von ",cannot_unequip:"Keine Gegenstände mehr zum Ablegen von ",close_msg:"Schließen",ok_msg:"OK",disc:"Dis",discipline:"Dis",donation_instructions:"Dies ist ein nicht-kommerzielles Projekt, das Destiny gewidmet ist. Wenn dir diese App gefällt, denke doch über eine Spende nach um das Projekt am Leben zu halten.",donation_title:"Spenden an Tower Ghost für Destiny!",error_loading_inventory:"Fehler beim Laden des Inventars ",gear_with_highest:"Ausrüstung mit höchstem:",inte:"Int",intellect:"Int",invalid_transfer_amount:"Ungültige Menge eingegeben: ",inventory_armor:"Rüstung",inventory_general:"Allgemein",inventory_postmaster:"Post",inventory_postmaster_lost_items:"Verlorene Gegenstände",inventory_postmaster_messages:"Nachrichten",inventory_subclasses:"Fokusse",inventory_weapons:"Waffen",itemDefs_undefined:"Konnte Gegenstandsinformationen nicht laden, bitte melde dieses Problem bei meinem GitHub und stelle sicher, dass deine Schrift auf Englisch gestellt ist.",language_pack_downloaded:"Sprachpaket heruntergeladen, bitte aktualisiere um die Änderungen anzuzeigen",language_text:"Dies wird die Sprache für alle Gegnstände und bei manchen Sprachen das Interface verändern, weitere Sprachen werden in der Zukunft hinzugefügt.",light:"Licht",loadouts_alreadythere_pt1:" ist bereits im ",loadouts_alreadythere_pt2:"'s Bucket von ",loadouts_delete:"Löschen",loadouts_desktop:"prüfen",loadouts_instructions:"Keine Gegenstände in der Ausrüstung, klicke Gegenstände um sie hinzuzufügen, ",loadouts_instructions_contd:" zum Ausrüsten.",loadouts_invalidbucket:" wird nicht verschoben. Wegen diesem Bucket: ",loadouts_mobile:"halten",loadouts_no_replacement:" wird nicht verschoben. Es gibt keinen Gegenstand als Ersatz.",loadouts_no_transfer:" wird nicht verschoben",loadouts_outofspace:" wird nicht verschoben, es ist kein Platz in ",loadouts_save:"Speichern",loadouts_save_new:"Speichern Als",loadouts_swap:" wird ausgetauscht mit ",loadouts_to_equip:" wird ausgerüstet.",loadouts_to_moveequip:" wird verschoben und ausgerüstet.",loadouts_to_transfer:" wird verschoben",loadouts_transfer:"Übertragen",loadouts_transfer_confirm:"Übertragungsbestätigung",loadouts_transferred:'<strong>Gegenstände erfolgreich übertragen</strong><br> Wenn dir diese App gefällt, vergiss nicht <a style="color:#3080CF; cursor:pointer;" class="donateLink" target="_system">mir ein Bier zu kaufen</a>',login_authenticating_pt1:"Bei Bungie einloggen... Bitte habe ein wenig Geduld.",login_authenticating_pt2:"Wenn der Login Bildschirm für länger als 2 Minuten bleibt, nutze diese Links für",login_authenticating_pt3:"um das Einloggen erneut zu versuchen. Wenn das Problem weiterhin besteht, installiere die App erneut.",login_help:"Bitte warte bis sich das Loginfenster von selbst schließt, während TGD deine Daten vorbereitet.",login_instructions:"Zu Beginn musst du dich bei deinem Bungie.net Account einloggen via:",login_loading_inventory:"Bitte warten, lade Arsenal von Bungie",login_loading_updates:"Bitte warten, lade automatische Updates",login_title:"Willkommen bei Tower Ghost für Destiny!",menu_viewformat:"View Format",menu_viewimagegrid:"Image Grid",menu_viewitemlist:"Items List",menu_about:"Über",menu_advancedtooltips:"Erweiterte Tooltips",menu_all:"Alle",menu_autorefresh:"Automatisch Aktualiseren (5 min)",menu_autotransfer:"Stacks Automatisch Übertragen",menu_clear:"Filter Zurücksetzen",menu_damage:"Schaden",menu_destinydbmode:"DestinyDB Modus",menu_destinydbtooltips:"DestinyDB Tooltips",menu_destinystatus:"DestinyStatus Bericht",menu_destinytrials:"DestinyTrials Bericht",menu_destinytracker:"DestinyTracker Bericht",menu_destinyguardiangg:"Guardian.GG Bericht",menu_donate:"Spenden",menu_filter_by:"Filtern",menu_filter_by_subclass_eq:"Unterklasse ausgerüstet",menu_filter_by_weapon_eq:"Waffen ausgerüstet",menu_filter_for_class:"Filter nach Klasse",menu_help:"Hilfe",menu_language:"Sprache",menu_loadouts:"Ausrüstungen",menu_loadouts_create:"Erstellen",menu_loadouts_manage:"Manage",menu_padheight:"Automatische Feldhöhe",menu_progress:"Fortschritt",menu_progress_1:"Fehlende Perks",menu_progress_2:"Volle Perks",menu_progress_3:"Voll",menu_refresh:"Aktualisieren",menu_set:"Setzen",menu_set_showduplicates:"Doppelte anzeigen",menu_set_showmissing:"Fehlende anzeigen",menu_settings:"Einstellungen",menu_options:"More",menu_shareurl:"URL mit Freunden teilen",menu_sortby:"Sortieren",menu_sortby_lightlvl:"Licht Level",menu_sortby_name:"Name",menu_sortby_type:"Typ",menu_sortby_tier_type:"Seltenheit, Typ, Licht",menu_sortby_tier_light:"Seltenheit, Licht",menu_sortby_tier_name:"Seltenheit, Name",menu_sortby_type_light:"Typ, Licht",menu_tier:"Seltenheit",menu_useps:"Playstation Account Verwenden",menu_usexbox:"Xbox Account Verwenden",menu_view:"Anzeige",menu_view_armor:"Rüstung",menu_view_by:"Anzeigen nach",menu_view_by_lightlvl:"Licht Level",menu_view_by_stat_points:"Komb Stat Pkte",menu_view_general:"Allgemein",menu_view_options:"Optionen Anzeigen",menu_view_weapons:"Waffen",missing_items:"Fehlende Gegenstände",most_points:"Punkte",movepopup_equip:"Ausrüsten",movepopup_extras:"Extras",movepopup_move:"Verschieben",movepopup_store:"Lagern",movepopup_vault:"Tresor",normalize:"Normalisieren",normalize_title:"Normalisieren - Gegenstände gleichmäßig über deine Charaktere verteilen",paypal_code:"DE",pick_a_set:"Bitte wähle ein Set bevor du diese Option auswählst",recovery:"Erhlg",str:"Stä",strength:"Stä",text_shareurl:"Dein Inventar wird aktualisiert, indem du erneut auf URL teilen im Menü klickst.",this_icon:"Das Icon ist",tier_common:"Gewöhnlich",tier_exotic:"Exotisch",tier_legendary:"Legendär",tier_rare:"Selten",tier_uncommon:"Ungewöhnlich",transfer:"Übertrage",transfer_all:"Alle",transfer_amount:"Menge Übertragen",transfer_ask:"Nicht erneut fragen",consolidate:"Zusammenlegen",transfer_consolidate:"Zusammenlegen (von allen Charakteren",transfer_one:"Eins",unable_create_loadout_for_type:"Es ist aktuell nicht möglich Ausrüstungen mit diesem Gegenstand zu erstellen.",unable_to_create_loadout_for_bucket:"Du kannst keine Ausrüstung mit mehr als 10 Gegenständen in diesem Platz erstellen: ",unable_to_move_bucketitems:"Gegenstände in diesem Bucket können nicht mit dem API übertragen werden.",unable_unequip:"Ablegen unmöglich von ",vo_container_width:"Container Breite",vo_layout_mode:"Layout Modus",vo_layout_mode_cust:"Angepasst",vo_layout_mode_def:"Standard",vo_number_of_columns:"Spalten",vo_vault_columns:"Tresor Spalten",vo_vault_first:"Erste/Links",vo_vault_last:"Letzte/Rechts",vo_vault_position:"Tresor Position",vo_vault_width:"Tresor Breite",whats_new_title:"Tower Ghost für Destiny Updates"},es:{agility:"Agility",armor:"Armor",best_combo:"Best Combo",cancel:"Cancelar",cannot_equip:"Error desconocido tratando de equipar ",cannot_unequip:"No mas elementos para tratar de unequip la ",close_msg:"Cerrar",ok_msg:"OK",disc:"Disc",discipline:"Discipline",donation_instructions:"Este es un projecto non-commercial dedicado para Destiny. Si usted disfurat esta aplicacion proveve una donacion para supportar los gastos.",donation_title:"Donaciones para Tower Ghost for Destiny!",error_loading_inventory:"Error cargando inventario",gear_with_highest:"Equip Gear With Highest:",inte:"Int",intellect:"Intellect",invalid_transfer_amount:"Cantidad no valida entrada: ",inventory_armor:"Armadura",inventory_general:"General",inventory_postmaster:"Post Master",inventory_postmaster_lost_items:"Lost Items",inventory_postmaster_messages:"Messages",inventory_subclasses:"Subclases",inventory_weapons:"Armas",itemDefs_undefined:"Por favor informar el asunto a mi Github y asegurese de que su fuente se establece en Ingles.",language_pack_downloaded:"Language Pack downloaded, please refresh to see the changes",language_text:"Esto cambiara el lenguage de la aplicacion y de los articulos.",light:"Light",loadouts_alreadythere_pt1:" ya esta en el ",loadouts_alreadythere_pt2:"'s cubo de ",loadouts_delete:"Borrar",loadouts_desktop:"cheque",loadouts_instructions:"No hay articulos en loadout, haga clic en los articulos a anadir, ",loadouts_instructions_contd:" para equipar.",loadouts_invalidbucket:" no sera trasladado, Debido a este cubo: ",loadouts_mobile:"sostener",loadouts_no_replacement:" no sera trasladado. No hay otro para reemplazarlo.",loadouts_no_transfer:" no sera trasladado",loadouts_outofspace:" no sera trasladado, no hay espacio en ",loadouts_save:"Guardar",loadouts_save_new:"Guardar Como",loadouts_swap:" sera intercambiado con ",loadouts_to_equip:" sera equipado.",loadouts_to_moveequip:" sera trasladado y equipado.",loadouts_to_transfer:" sera trasladado",loadouts_transfer:"Transferir",loadouts_transfer_confirm:"Confirmar Transferencia",loadouts_transferred:'<strong>Articulo(s) transferido con exito</strong><br> Si te gusta esta aplicacion, puedes <a style="color:#3080CF; cursor:pointer;" class="donateLink" target="_system">comprarme una cervezita.</a>',login_authenticating_pt1:"Logging into Bungie... Please be patient.",login_authenticating_pt2:"If log in screen remains for 2+ minutes, use these links for",login_authenticating_pt3:"to retry login. If the problem persists, reinstall the app.",login_help:"Por favor, espere a que la ventana se cerra. TGD han preparado su informacion.",login_instructions:"Para empezar tendras que acceder a su cuenta a traves de Bungie.net:",login_loading_inventory:"Por favor espere, cargando arsenal de Bungie",login_loading_updates:"Please wait, downloading auto updates",login_title:"Bienvenido a Tower Ghost para Destiny!",menu_viewformat:"View Format",menu_viewimagegrid:"Image Grid",menu_viewitemlist:"Items List",menu_about:"Acerca De",menu_advancedtooltips:"Advanced Tooltips",menu_all:"Todo",menu_autorefresh:"Auto Refrescar (5 min)",menu_autotransfer:"Auto Mover Pilas",menu_clear:"Aclaro Filtro",menu_damage:"Daño",menu_destinydbmode:"DestinyDB Modo",menu_destinydbtooltips:"DestinyDB Tooltips",menu_destinystatus:"DestinyStatus Reporte",menu_destinytrials:"DestinyTrials Reporte",menu_destinytracker:"DestinyTracker Reporte",menu_destinyguardiangg:"Guardian.GG Reporte",menu_donate:"Donar",menu_filter_by:"Filter By",menu_filter_by_subclass_eq:"Subclass Equipped",menu_filter_by_weapon_eq:"Weapons Equipped",menu_filter_for_class:"Filter for Class",menu_help:"Ayuda",menu_language:"Language",menu_loadouts:"Loadouts",menu_loadouts_create:"Crear",menu_loadouts_manage:"Manage",menu_padheight:"Auto Adjusto Altura",menu_progress:"Progreso",menu_progress_1:"Falta Perks",menu_progress_2:"Completo Perks",menu_progress_3:"Al Maxmimo",menu_refresh:"Refrescar (seg.)",menu_set:"Conjunto",menu_set_showduplicates:"Monstrar articulos duplicados",menu_set_showmissing:"Monstrar articulos que faltan",menu_settings:"Ajustes",menu_options:"More",menu_shareurl:"Compartir Con Amigos",menu_sortby:"Sort By",menu_sortby_lightlvl:"Light Level",menu_sortby_name:"Name",menu_sortby_type:"Type",menu_sortby_tier_type:"Tier, Type, Light",menu_sortby_tier_light:"Tier, Light",menu_sortby_tier_name:"Tier, Name",menu_sortby_type_light:"Type, Light",menu_tier:"Nivel",menu_useps:"Usa Playstation Cuenta",menu_usexbox:"Usa Xbox Cuenta",menu_view:"Vista",menu_view_armor:"Armaduras",menu_view_by:"View By",menu_view_by_lightlvl:"Light Level",menu_view_by_stat_points:"Combined Stat Points",menu_view_general:"General",menu_view_options:"Opciones de Vista",menu_view_weapons:"Armas",missing_items:"Articulos que faltan",most_points:"Points",movepopup_equip:"equipar",movepopup_extras:"extras",movepopup_move:"Mover a",movepopup_store:"almacenar",movepopup_vault:"bodega",normalize:"Normalizar",normalize_title:"Normalizar - igualmente distribuir tema a traves de sus personajes",paypal_code:"ES",pick_a_set:"Por favor elija un Set antes de seleccionar esta opcion",recovery:"Recovery",str:"Str",strength:"Strength",text_shareurl:"Tu iventoria es actualizado cuando hagas click a Compartir URL denuevo.",this_icon:"Este icono es ",tier_common:"Común",tier_exotic:"Exótico",tier_legendary:"Legendario",tier_rare:"Raro",tier_uncommon:"Poco común",transfer:"Transfer",transfer_all:"Todos",transfer_amount:"Transferencia monto",transfer_ask:"Don't ask in the future",consolidate:"Consolidate",transfer_consolidate:"Consolidate (pull from all characters",transfer_one:"Uno",unable_create_loadout_for_type:"Actualmente no se puede crear loadouts con este tipo de elemento.",unable_to_create_loadout_for_bucket:"No se puede crear un loadout con mas de 10 articulos en esta ranura: ",unable_to_move_bucketitems:"Post Master no pueden ser transferidos con el programa.",unable_unequip:"Incapaz de inequippar ",vo_container_width:"Container Width",vo_layout_mode:"Layout Mode",vo_layout_mode_cust:"Custom",vo_layout_mode_def:"Default",vo_number_of_columns:"# de Columnas",vo_vault_columns:"Vault Columns",vo_vault_first:"Primero/Izquierda",vo_vault_last:"Ultimo/Derecha",vo_vault_position:"Position de Bodega",vo_vault_width:"Vault Width",whats_new_title:"Tower Ghost for Destiny Noticias"},fr:{agility:"Agilité",armor:"Armure",best_combo:"Meilleur combo",cancel:"Annuler",cannot_equip:"Erreur impossible d'équiper ",cannot_unequip:"Impossible. Il n'y a rien a équiper a la place ",close_msg:"Fermer",ok_msg:"OK",disc:"Disc",discipline:"Discipline",donation_instructions:"Ceci est un projet non commercial dédié au jeu Destiny. Si vous aimez ce logiciel, faîtes un don afin de garder ce projet en vie et de soutenir les coûts de maintenance.",donation_title:"Dons pour Tower Ghost pour Destiny!",error_loading_inventory:"Erreur chargement d'inventaire",gear_with_highest:"Equiper cet équipement avec le plus haut:",inte:"Int",intellect:"Intelligence",invalid_transfer_amount:"Le montant indiqué est incorrect: ",inventory_armor:"Armure",inventory_general:"General",inventory_postmaster:"Commis des postes",inventory_postmaster_lost_items:"Objets Perdus",inventory_postmaster_messages:"Messages",inventory_subclasses:"Doctrines",inventory_weapons:"Armes",itemDefs_undefined:"S'il vous plaît signaler le problème sur mon Github et assurez-vous que votre police est l'anglais.",language_pack_downloaded:"Pack de langue téléchargé, s'il vous plaît rafraîchissez pour voir les changements",language_text:"Cela va changer la langue pour tous les articles et l'interface pour certaines langues, d'autres langues seront ajoutées dans le futur.",light:"Lumière",loadouts_alreadythere_pt1:" est déjà dans le ",loadouts_alreadythere_pt2:"est dans la fente de ",loadouts_delete:"Supprimer",loadouts_desktop:"Bureau",loadouts_instructions:"Aucun object dans le loadout, cliquez sur l'objet pour l'ajouer , ",loadouts_instructions_contd:" équiper.",loadouts_invalidbucket:" ne sera pas déplacé. À cause de cette fente: ",loadouts_mobile:"tenir",loadouts_no_replacement:" ne sera pas déplacé. Il n'y a aucun objet pour le remplacer.",loadouts_no_transfer:" ne sera pas déplacé",loadouts_outofspace:" ne sera pas déplacé, Il n'y a pas de place ",loadouts_save:"Enregistrer",loadouts_save_new:"Enregistrer comme nouveau",loadouts_swap:" sera remplacée par ",loadouts_to_equip:" sera équipé.",loadouts_to_moveequip:" sera déplacé et équipé.",loadouts_to_transfer:" sera déplacé",loadouts_transfer:"Transférer",loadouts_transfer_confirm:"Transféré Confirmer",loadouts_transferred:'<strong>Articles transféré avec succès</strong><br> Si vous aimez ce logiciel pensez à <a style="color:#3080CF; cursor:pointer;" class="donateLink" target="_system">achetez-moi une bière</a>',login_authenticating_pt1:"Connexion à Bungie ... S'il vous plaît soyez patient.",login_authenticating_pt2:"Si cet écran de connexion reste + de 2 minutes, utiliser ces liens pour",login_authenticating_pt3:"pour réessayer de vous connexion. Si le problème persiste, réinstallez l'application.",login_help:"S'il vous plaît attendrez la fenêtre de connexion à proximité de l'automobile comme TGD prépare vos informations.",login_instructions:"Pour commencer, vous aurez besoin pour vous connecter à votre compte Bungie.net via:",login_loading_inventory:"S'il vous plaît attendez, chargement de votre inventaire depuis Bungie",login_loading_updates:"S'il vous plaît attendez, téléchargement de la mise à jour automatique",login_title:"Bienvenue à Tower Ghost pour Destiny!",menu_viewformat:"VoirFormat",menu_viewimagegrid:"Image Grille",menu_viewitemlist:"Liste d'objets",menu_about:"Propos",menu_advancedtooltips:"infobulles avancée",menu_view_by:"Voir de",menu_view_by_lightlvl:"Niveau de Lumière",menu_view_by_stat_points:"Points Stats combinés ",menu_all:"Tout",menu_autorefresh:"Auto Actualiser (5 min)",menu_autotransfer:"Auto transfert s'entasser",menu_clear:"Filtrer",menu_damage:"Dégâts",menu_destinydbmode:"DestinyDB Mode",menu_destinydbtooltips:"DestinyDB infobulles",menu_destinystatus:"DestinyStatus Report",menu_destinytrials:"DestinyTrials Report",menu_destinytracker:"DestinyTracker Report",menu_destinyguardiangg:"Guardian.GG Report",menu_donate:"Don",menu_filter_by:"Filtrer de",menu_filter_by_subclass_eq:"Doctrine Équipée",menu_filter_by_weapon_eq:"Armes Équipée",menu_filter_for_class:"Filtrer par classe",menu_help:"Aide",menu_language:"Langues",menu_loadouts:"Loadouts",menu_loadouts_create:"Créer",menu_loadouts_manage:"Gérer",menu_padheight:"Hauteur du Pad auto.",menu_progress:"Progression",menu_progress_1:"Atouts Manquant ",menu_progress_2:"Bordure Manquant",menu_progress_3:"au maximum",menu_refresh:"Actualisez",menu_set:"Collection",menu_set_showduplicates:"Afficher les doublons d'objets",menu_set_showmissing:"Afficher les éléments manquants",menu_settings:"Paramètres",menu_options:"Options",menu_shareurl:"Partager URL",menu_sortby:"Trier par",menu_sortby_lightlvl:"Niveau de lumière",menu_sortby_name:"Nom",menu_sortby_type:"Type",menu_sortby_tier_type:"Palier, Type, Lumière",menu_sortby_tier_light:"Palier, Lumière",menu_sortby_tier_name:"Palier, Nom",menu_sortby_type_light:"Type, Lumière",menu_tier:"Rareté",menu_useps:"Utiliser un compte Playstation",menu_usexbox:"Utiliser un compte Xbox",menu_view:"Voir",menu_view_armor:"Armure",menu_view_general:"General",menu_view_options:"Options d'affichage",menu_view_weapons:"Armes",missing_items:"Articles manquant",most_points:"Points",movepopup_equip:"équiper",movepopup_extras:"extras",movepopup_move:"Déplacer",movepopup_store:"transférer",movepopup_vault:"Coffre",normalize:"Normaliser",normalize_title:"Normaliser - distribuer également le thème à travers ses personnages",paypal_code:"FR",pick_a_set:"S'il vous plat choisez un ensemble avant de choisir cette option",recovery:"récupération",str:"For",strength:"Force",text_shareurl:"Votre inventaire est mis à jour en cliquant sur Partager URL dans le menu à nouveau.",this_icon:"Cette icône est ",tier_common:"Commun",tier_exotic:"Exotique",tier_legendary:"Legendaire",tier_rare:"Rare",tier_uncommon:"Peu commun",transfer:"Transférer",transfer_all:"Tous",transfer_amount:"montant du transfert",transfer_ask:"Ne demandez pas à l'avenir",consolidate:"Consolider",transfer_consolidate:"Consolider (retirer de tous les personnages)",transfer_one:"Un",unable_create_loadout_for_type:"Actuellement impossible de créer un loadouts avec ce type d'article",unable_to_create_loadout_for_bucket:"Vous ne pouvez pas crer un loadout avec plus de 10 articles dans cette fente: ",unable_to_move_bucketitems:"Impossible de transférer l'article avec l'application.",unable_unequip:"Impossible de retirer ",vo_container_width:"Largeur du contenu",vo_layout_mode:"Mode Présentation",vo_layout_mode_cust:"Personnalisé",vo_layout_mode_def:"Default",vo_number_of_columns:"Nombre de colonnes",vo_vault_columns:"Colonnes du coffres",vo_vault_first:"Première/Gauche",vo_vault_last:"dernièrer/Droite",vo_vault_position:"Position du coffre",vo_vault_width:"Largeur du Coffre",whats_new_title:"Actualité Tower Ghost pour Destiny"},it:{agility:"Agility",armor:"Armor",best_combo:"Best Combo",cancel:"Cancel",cannot_equip:"Unknown error trying to equip ",cannot_unequip:"No more items to try to unequip the ",close_msg:"Close",ok_msg:"OK",disc:"Disc",discipline:"Discipline",donation_instructions:"This is a non-commercial project dedicated to Destiny. If you like this app provide a donation to keep this project alive and support the maintenance costs.",donation_title:"Donations for Tower Ghost for Destiny!",error_loading_inventory:"Error loading inventory ",gear_with_highest:"Equip Gear With Highest:",inte:"Int",intellect:"Intellect",invalid_transfer_amount:"Invalid amount entered: ",inventory_armor:"Armor",inventory_general:"General",inventory_postmaster:"Post Master",inventory_postmaster_messages:"Messages",inventory_postmaster_lost_items:"Lost Items",inventory_subclasses:"Sub Classes",inventory_weapons:"Weapons",itemDefs_undefined:"Could not load item definitions, please report the issue to my Github including the version number being used.",language_pack_downloaded:"Language Pack downloaded, please refresh to see the changes",language_text:"This will change the language for all items and the interface for some languages, more languages will be added in the future.",light:"Light",loadouts_alreadythere_pt1:" is already in the ",loadouts_alreadythere_pt2:"'s bucket of ",loadouts_delete:"Delete",loadouts_desktop:"check",loadouts_instructions:"No items in loadout, click items to add, ",loadouts_instructions_contd:" to equip.",loadouts_invalidbucket:" will not be moved. Because of this bucket: ",loadouts_mobile:"hold",loadouts_no_replacement:" will not be moved. There is no item to replace it.",loadouts_no_transfer:" will not be moved",loadouts_outofspace:" will not be moved, there is no space in ",loadouts_save:"Save",loadouts_save_new:"Save As",loadouts_swap:" will be swapped with ",loadouts_to_equip:" will be equipped.",loadouts_to_moveequip:" will be moved and equipped.",loadouts_to_transfer:" will be moved",loadouts_transfer:"Transfer",loadouts_transfer_confirm:"Transfer Confirm",loadouts_transferred:'<strong>Item(s) Transferred!</strong><br>If you like this app remember to <a style="color:#3080CF; cursor:pointer;" class="donateLink" target="_system">buy me a beer</a>.',login_authenticating_pt1:"Logging into Bungie... Please be patient.",login_authenticating_pt2:"If log in screen remains for 2+ minutes, use these links for",login_authenticating_pt3:"to retry login. If the problem persists, reinstall the app.",login_help:"Please wait for the login window to auto close as TGD prepares your information.",login_instructions:"To get started you'll need to log in to your Bungie.net account via:",login_loading_inventory:"Please wait, loading arsenal from Bungie",login_loading_updates:"Please wait, downloading auto updates",login_title:"Welcome to Tower Ghost for Destiny!",menu_viewformat:"View Format",menu_viewimagegrid:"Image Grid",menu_viewitemlist:"Items List",menu_about:"About",menu_advancedtooltips:"Advanced Tooltips",menu_all:"All",menu_autorefresh:"Auto Refresh (5 min)",menu_autotransfer:"Auto Transfer Stacks",menu_clear:"Clear Filters",menu_destinydbtooltips:"DestinyDB Tooltips",menu_destinydbmode:"DestinyDB Mode",menu_destinystatus:"DestinyStatus Report",menu_destinytrials:"DestinyTrials Report",menu_destinytracker:"DestinyTracker Report",menu_destinyguardiangg:"Guardian.GG Report",menu_damage:"Damage",menu_donate:"Donate",menu_filter_by:"Filter By",menu_filter_by_subclass_eq:"Subclass Equipped",menu_filter_by_weapon_eq:"Weapons Equipped",menu_filter_for_class:"Filter for Class",menu_help:"Help",menu_language:"Language",menu_loadouts:"Loadouts",menu_loadouts_create:"Create",menu_loadouts_manage:"Manage",menu_padheight:"Auto Pad Height",menu_progress:"Progress",menu_progress_1:"Missing Perks",menu_progress_2:"Missing Border",menu_progress_3:"Maxed",menu_refresh:"Refresh (secs)",menu_set:"Set",menu_set_showmissing:"Show Missing Items",menu_set_showduplicates:"Show Duplicate Items",menu_settings:"Settings",menu_options:"More",menu_shareurl:"Share URL with friends",menu_sortby:"Sort By",menu_sortby_lightlvl:"Light Level",menu_sortby_name:"Name",menu_sortby_type:"Type",menu_sortby_tier_type:"Tier, Type, Light",menu_sortby_tier_light:"Tier, Light",menu_sortby_tier_name:"Tier, Name",menu_sortby_type_light:"Type, Light",menu_tier:"Tier",menu_usexbox:"Use Xbox Account",menu_useps:"Use Playstation Account",menu_view:"View",menu_view_armor:"Armor",menu_view_by:"View By",menu_view_by_lightlvl:"Light Level",menu_view_by_stat_points:"Combined Stat Points",menu_view_general:"General",menu_view_options:"View Options",menu_view_weapons:"Weapons",missing_items:"Missing Items",most_points:"Points",movepopup_move:"Move",movepopup_store:"store",movepopup_equip:"equip",movepopup_vault:"vault",movepopup_extras:"extras",normalize:"Normalize",normalize_title:"Normalize - equally distribute item across your characters",paypal_code:"EN",pick_a_set:"Please pick a Set before selecting this option",recovery:"Recovery",str:"Str",strength:"Strength",text_shareurl:"Your inventory is updated by clicking on Share URL from the menu again.",this_icon:"This icon is ",tier_common:"Common",tier_exotic:"Exotic",tier_legendary:"Legendary",tier_rare:"Rare",tier_uncommon:"Uncommon",transfer:"Transfer",transfer_all:"All",transfer_amount:"Transfer Amount",transfer_ask:"Don't ask in the future",consolidate:"Consolidate",transfer_consolidate:"Consolidate (pull from all characters",transfer_one:"One",unable_create_loadout_for_type:"Currently unable to create loadouts with this item type.",unable_unequip:"Unable to unequip ",unable_to_create_loadout_for_bucket:"You cannot create a loadout with more than 10 items in this slot: ",unable_to_move_bucketitems:"This item cannot be transferred with the API.",vo_container_width:"Container Width",vo_layout_mode:"Vault Mode",vo_layout_mode_cust:"Custom",vo_layout_mode_def:"Default",vo_number_of_columns:"Number of Columns",vo_vault_columns:"Vault Columns",vo_vault_first:"First/Left",vo_vault_last:"Last/Right",vo_vault_position:"Vault Position",vo_vault_width:"Vault Width",whats_new_title:"Tower Ghost for Destiny Updates"},ja:{agility:"Agility",armor:"Armor",best_combo:"Best Combo",cancel:"Cancel",cannot_equip:"Unknown error trying to equip ",cannot_unequip:"No more items to try to unequip the ",close_msg:"Close",ok_msg:"OK",disc:"Disc",discipline:"Discipline",donation_instructions:"This is a non-commercial project dedicated to Destiny. If you like this app provide a donation to keep this project alive and support the maintenance costs.",donation_title:"Donations for Tower Ghost for Destiny!",error_loading_inventory:"Error loading inventory ",gear_with_highest:"Equip Gear With Highest:",inte:"Int",intellect:"Intellect",invalid_transfer_amount:"Invalid amount entered: ",inventory_armor:"Armor",inventory_general:"General",inventory_postmaster:"Post Master",inventory_postmaster_messages:"Messages",inventory_postmaster_lost_items:"Lost Items",inventory_subclasses:"Sub Classes",inventory_weapons:"Weapons",itemDefs_undefined:"Could not load item definitions, please report the issue to my Github including the version number being used.",language_pack_downloaded:"Language Pack downloaded, please refresh to see the changes",language_text:"This will change the language for all items and the interface for some languages, more languages will be added in the future.",light:"Light",loadouts_alreadythere_pt1:" is already in the ",loadouts_alreadythere_pt2:"'s bucket of ",loadouts_delete:"Delete",loadouts_desktop:"check",loadouts_instructions:"No items in loadout, click items to add, ",loadouts_instructions_contd:" to equip.",loadouts_invalidbucket:" will not be moved. Because of this bucket: ",loadouts_mobile:"hold",loadouts_no_replacement:" will not be moved. There is no item to replace it.",loadouts_no_transfer:" will not be moved",loadouts_outofspace:" will not be moved, there is no space in ",loadouts_save:"Save",loadouts_save_new:"Save As",loadouts_swap:" will be swapped with ",loadouts_to_equip:" will be equipped.",loadouts_to_moveequip:" will be moved and equipped.",loadouts_to_transfer:" will be moved",loadouts_transfer:"Transfer",loadouts_transfer_confirm:"Transfer Confirm",loadouts_transferred:'<strong>Item(s) Transferred!</strong><br>If you like this app remember to <a style="color:#3080CF; cursor:pointer;" class="donateLink" target="_system">buy me a beer</a>.',login_authenticating_pt1:"Logging into Bungie... Please be patient.",login_authenticating_pt2:"If log in screen remains for 2+ minutes, use these links for",login_authenticating_pt3:"to retry login. If the problem persists, reinstall the app.",login_help:"Please wait for the login window to auto close as TGD prepares your information.",login_instructions:"To get started you'll need to log in to your Bungie.net account via:",
login_loading_inventory:"Please wait, loading arsenal from Bungie",login_loading_updates:"Please wait, downloading auto updates",login_title:"Welcome to Tower Ghost for Destiny!",menu_viewformat:"View Format",menu_viewimagegrid:"Image Grid",menu_viewitemlist:"Items List",menu_about:"About",menu_advancedtooltips:"Advanced Tooltips",menu_all:"All",menu_autorefresh:"Auto Refresh (5 min)",menu_autotransfer:"Auto Transfer Stacks",menu_clear:"Clear Filters",menu_destinydbtooltips:"DestinyDB Tooltips",menu_destinydbmode:"DestinyDB Mode",menu_destinystatus:"DestinyStatus Report",menu_destinytrials:"DestinyTrials Report",menu_destinytracker:"DestinyTracker Report",menu_destinyguardiangg:"Guardian.GG Report",menu_damage:"Damage",menu_donate:"Donate",menu_filter_by:"Filter By",menu_filter_by_subclass_eq:"Subclass Equipped",menu_filter_by_weapon_eq:"Weapons Equipped",menu_filter_for_class:"Filter for Class",menu_help:"Help",menu_language:"Language",menu_loadouts:"Loadouts",menu_loadouts_create:"Create",menu_loadouts_manage:"Manage",menu_padheight:"Auto Pad Height",menu_progress:"Progress",menu_progress_1:"Missing Perks",menu_progress_2:"Missing Border",menu_progress_3:"Maxed",menu_refresh:"Refresh (secs)",menu_set:"Set",menu_set_showmissing:"Show Missing Items",menu_set_showduplicates:"Show Duplicate Items",menu_settings:"Settings",menu_options:"More",menu_shareurl:"Share URL with friends",menu_sortby:"Sort By",menu_sortby_lightlvl:"Light Level",menu_sortby_name:"Name",menu_sortby_type:"Type",menu_sortby_tier_type:"Tier, Type, Light",menu_sortby_tier_light:"Tier, Light",menu_sortby_tier_name:"Tier, Name",menu_tier:"Tier",menu_usexbox:"Use Xbox Account",menu_useps:"Use Playstation Account",menu_view:"View",menu_view_armor:"Armor",menu_view_by:"View By",menu_view_by_lightlvl:"Light Level",menu_view_by_stat_points:"Combined Stat Points",menu_view_general:"General",menu_view_options:"View Options",menu_view_weapons:"Weapons",missing_items:"Missing Items",most_points:"Points",movepopup_move:"Move",movepopup_store:"store",movepopup_equip:"equip",movepopup_vault:"vault",movepopup_extras:"extras",normalize:"Normalize",normalize_title:"Normalize - equally distribute item across your characters",paypal_code:"EN",pick_a_set:"Please pick a Set before selecting this option",recovery:"Recovery",str:"Str",strength:"Strength",text_shareurl:"Your inventory is updated by clicking on Share URL from the menu again.",this_icon:"This icon is ",tier_common:"Common",tier_exotic:"Exotic",tier_legendary:"Legendary",tier_rare:"Rare",tier_uncommon:"Uncommon",transfer:"Transfer",transfer_all:"All",transfer_amount:"Transfer Amount",transfer_ask:"Don't ask in the future",consolidate:"Consolidate",transfer_consolidate:"Consolidate (pull from all characters",transfer_one:"One",unable_create_loadout_for_type:"Currently unable to create loadouts with this item type.",unable_unequip:"Unable to unequip ",unable_to_create_loadout_for_bucket:"You cannot create a loadout with more than 10 items in this slot: ",unable_to_move_bucketitems:"This item cannot be transferred with the API.",vo_container_width:"Container Width",vo_layout_mode:"Vault Mode",vo_layout_mode_cust:"Custom",vo_layout_mode_def:"Default",vo_number_of_columns:"Number of Columns",vo_vault_columns:"Vault Columns",vo_vault_first:"First/Left",vo_vault_last:"Last/Right",vo_vault_position:"Vault Position",vo_vault_width:"Vault Width",whats_new_title:"Tower Ghost for Destiny Updates"},pt:{agility:"Agility",armor:"Armor",best_combo:"Best Combo",cancel:"Cancel",cannot_equip:"Unknown error trying to equip ",cannot_unequip:"No more items to try to unequip the ",close_msg:"Close",ok_msg:"OK",disc:"Disc",discipline:"Discipline",donation_instructions:"This is a non-commercial project dedicated to Destiny. If you like this app provide a donation to keep this project alive and support the maintenance costs.",donation_title:"Donations for Tower Ghost for Destiny!",error_loading_inventory:"Error loading inventory ",gear_with_highest:"Equip Gear With Highest:",inte:"Int",intellect:"Intellect",invalid_transfer_amount:"Invalid amount entered: ",inventory_armor:"Armor",inventory_general:"General",inventory_postmaster:"Post Master",inventory_postmaster_messages:"Messages",inventory_postmaster_lost_items:"Lost Items",inventory_subclasses:"Sub Classes",inventory_weapons:"Weapons",itemDefs_undefined:"Could not load item definitions, please report the issue to my Github including the version number being used.",language_pack_downloaded:"Language Pack downloaded, please refresh to see the changes",language_text:"This will change the language for all items and the interface for some languages, more languages will be added in the future.",light:"Light",loadouts_alreadythere_pt1:" is already in the ",loadouts_alreadythere_pt2:"'s bucket of ",loadouts_delete:"Delete",loadouts_desktop:"check",loadouts_instructions:"No items in loadout, click items to add, ",loadouts_instructions_contd:" to equip.",loadouts_invalidbucket:" will not be moved. Because of this bucket: ",loadouts_mobile:"hold",loadouts_no_replacement:" will not be moved. There is no item to replace it.",loadouts_no_transfer:" will not be moved",loadouts_outofspace:" will not be moved, there is no space in ",loadouts_save:"Save",loadouts_save_new:"Save As",loadouts_swap:" will be swapped with ",loadouts_to_equip:" will be equipped.",loadouts_to_moveequip:" will be moved and equipped.",loadouts_to_transfer:" will be moved",loadouts_transfer:"Transfer",loadouts_transfer_confirm:"Transfer Confirm",loadouts_transferred:'<strong>Item(s) Transferred!</strong><br>If you like this app remember to <a style="color:#3080CF; cursor:pointer;" class="donateLink" target="_system">buy me a beer</a>.',login_authenticating_pt1:"Logging into Bungie... Please be patient.",login_authenticating_pt2:"If log in screen remains for 2+ minutes, use these links for",login_authenticating_pt3:"to retry login. If the problem persists, reinstall the app.",login_help:"Please wait for the login window to auto close as TGD prepares your information.",login_instructions:"To get started you'll need to log in to your Bungie.net account via:",login_loading_inventory:"Please wait, loading arsenal from Bungie",login_loading_updates:"Please wait, downloading auto updates",login_title:"Welcome to Tower Ghost for Destiny!",menu_viewformat:"View Format",menu_viewimagegrid:"Image Grid",menu_viewitemlist:"Items List",menu_about:"About",menu_advancedtooltips:"Advanced Tooltips",menu_all:"All",menu_autorefresh:"Auto Refresh (5 min)",menu_autotransfer:"Auto Transfer Stacks",menu_clear:"Clear Filters",menu_destinydbtooltips:"DestinyDB Tooltips",menu_destinydbmode:"DestinyDB Mode",menu_destinystatus:"DestinyStatus Report",menu_destinytrials:"DestinyTrials Report",menu_destinytracker:"DestinyTracker Report",menu_destinyguardiangg:"Guardian.GG Report",menu_damage:"Damage",menu_donate:"Donate",menu_filter_by:"Filter By",menu_filter_by_subclass_eq:"Subclass Equipped",menu_filter_by_weapon_eq:"Weapons Equipped",menu_filter_for_class:"Filter for Class",menu_help:"Help",menu_language:"Language",menu_loadouts:"Loadouts",menu_loadouts_create:"Create",menu_loadouts_manage:"Manage",menu_padheight:"Auto Pad Height",menu_progress:"Progress",menu_progress_1:"Missing Perks",menu_progress_2:"Missing Border",menu_progress_3:"Maxed",menu_refresh:"Refresh (secs)",menu_set:"Set",menu_set_showmissing:"Show Missing Items",menu_set_showduplicates:"Show Duplicate Items",menu_settings:"Settings",menu_options:"More",menu_shareurl:"Share URL with friends",menu_sortby:"Sort By",menu_sortby_lightlvl:"Light Level",menu_sortby_name:"Name",menu_sortby_type:"Type",menu_sortby_tier_type:"Tier, Type, Light",menu_sortby_tier_light:"Tier, Light",menu_sortby_tier_name:"Tier, Name",menu_sortby_type_light:"Type, Light",menu_tier:"Tier",menu_usexbox:"Use Xbox Account",menu_useps:"Use Playstation Account",menu_view:"View",menu_view_armor:"Armor",menu_view_by:"View By",menu_view_by_lightlvl:"Light Level",menu_view_by_stat_points:"Combined Stat Points",menu_view_general:"General",menu_view_options:"View Options",menu_view_weapons:"Weapons",missing_items:"Missing Items",most_points:"Points",movepopup_move:"Move",movepopup_store:"store",movepopup_equip:"equip",movepopup_vault:"vault",movepopup_extras:"extras",normalize:"Normalize",normalize_title:"Normalize - equally distribute item across your characters",paypal_code:"EN",pick_a_set:"Please pick a Set before selecting this option",recovery:"Recovery",str:"Str",strength:"Strength",text_shareurl:"Your inventory is updated by clicking on Share URL from the menu again.",this_icon:"This icon is ",tier_common:"Common",tier_exotic:"Exotic",tier_legendary:"Legendary",tier_rare:"Rare",tier_uncommon:"Uncommon",transfer:"Transfer",transfer_all:"All",transfer_amount:"Transfer Amount",transfer_ask:"Don't ask in the future",consolidate:"Consolidate",transfer_consolidate:"Consolidate (pull from all characters",transfer_one:"One",unable_create_loadout_for_type:"Currently unable to create loadouts with this item type.",unable_unequip:"Unable to unequip ",unable_to_create_loadout_for_bucket:"You cannot create a loadout with more than 10 items in this slot: ",unable_to_move_bucketitems:"This item cannot be transferred with the API.",vo_container_width:"Container Width",vo_layout_mode:"Vault Mode",vo_layout_mode_cust:"Custom",vo_layout_mode_def:"Default",vo_number_of_columns:"Number of Columns",vo_vault_columns:"Vault Columns",vo_vault_first:"First/Left",vo_vault_last:"Last/Right",vo_vault_position:"Vault Position",vo_vault_width:"Vault Width",whats_new_title:"Tower Ghost for Destiny Updates"},tr:{agility:"Agility",armor:"Armor",best_combo:"Best Combo",cancel:"Vazgeç",cannot_equip:"Öğeyi donanırken hata oluştu ",cannot_unequip:"Üzerinizdekini bırakmak için öğe yok ",close_msg:"Kapat",ok_msg:"OK",disc:"Disc",discipline:"Discipline",donation_instructions:"Bu program tamamen ücretsiz ve Destiny ye bağışlanmış bir programdır.Herhangi bir ücret talep etmemektedir yani kelepirdir. Programımızı geliştirmek ve daha iyi bir deneyim sağlamamızı istiyorsanız,lütfen bağışlarınızı ve desteğinizi esirgemeyiniz.Teşekkürler.",donation_title:"Destiny ye bağışlar!",error_loading_inventory:"Cephaneniz yüklenirken hata oluştu ",gear_with_highest:"Equip Gear With Highest:",inte:"Int",intellect:"Intellect",invalid_transfer_amount:"Geçersiz miktar girildi: ",inventory_armor:"Armorlar",inventory_general:"Görevler",inventory_postmaster:"Post Master",inventory_postmaster_lost_items:"Kayıp Öğeler",inventory_postmaster_messages:"Mesajlar",inventory_subclasses:"Sub Klaslar",inventory_weapons:"Silahlar",itemDefs_undefined:"Öğe tanımlanamadı, lütfen bu hatayı bana ingilizce olarak GitHub sayfamdan belirtin.",language_pack_downloaded:"Dil paketi indirildi,lütfen yenileyin ve değişikliklere göz atın.",language_text:"Bu seçenek,programın bütün içeriğinin dilini değiştirecektir.Ileride programda daha fazla dil desteği olacaktır.",light:"Light",loadouts_alreadythere_pt1:"zaten bunun içerisinde ",loadouts_alreadythere_pt2:"'s bucket of ",loadouts_delete:"Sil",loadouts_desktop:"kontrol",loadouts_instructions:"Teçhizatında donanmak için öğe yok.Donanmak için tıkla, ",loadouts_instructions_contd:" ekle.",loadouts_invalidbucket:" aktarılmayacak. Çünkü seçtiğin bu öğeler yüzünden: ",loadouts_mobile:"tut",loadouts_no_replacement:" aktarılmayacak. Bu öğenin yerine koyabileceğimiz başka bir öğe yok.",loadouts_no_transfer:" aktarılmayacak",loadouts_outofspace:" aktarılmayacak, çünkü yandaki yerde yeterli alanın yok ",loadouts_save:"Kaydet",loadouts_save_new:"Kaydet As",loadouts_swap:" ile takas yapılacak ",loadouts_to_equip:" donanılacak.",loadouts_to_moveequip:" aktarılacak ve donanılacak.",loadouts_to_transfer:" aktarılacak",loadouts_transfer:"Transfer",loadouts_transfer_confirm:"Aktarmayı Onayla",loadouts_transferred:'<strong>Öğe(ler) başarı ile aktarıldı!</strong><br> Eğer bu kolaylık hoşunuza gittiyse,<a style="color:#3080CF; cursor:pointer;" class="donateLink" target="_system">bana bi çay ısmarlayın</a>',login_authenticating_pt1:"Bungie'ye giriş yapılıyor.. Lütfen sabırlı olun :).",login_authenticating_pt2:"Eğer yükleme ekranı 2 dakikadan uzun sürdüyse, Yenilemek için bu linkleri kullanın",login_authenticating_pt3:"ve yeniden giriş yapmayı deneyin. Eğer sorun devam ederse,programı silip tekrar yükleyin.",login_help:"Yükleme ekranının otomatik kapanmasını bekleyiniz.Yüklendikten sonra program sizi cephanenize yönlendirecektir.",login_instructions:"Programı kullanabilmek için Bungie.Net hesabına giriş yapman gerekiyor:",login_loading_inventory:"Lütfen Bekleyin, Cephaneniz Bungie tarafından yükleniyor",login_loading_updates:"Please wait, downloading auto updates",login_title:"Tower Ghost for Destiny ye Hoşgeldiniz!",menu_viewformat:"View Format",menu_viewimagegrid:"Image Grid",menu_viewitemlist:"Items List",menu_about:"Hakkında",menu_advancedtooltips:"Advanced Tooltips",menu_all:"Hepsi",menu_autorefresh:"Otomatik yenileme (5 mins)",menu_autotransfer:"Otomatik Transfer",menu_clear:"Arama Filtrelerini Temizle",menu_damage:"Hasar Türü",menu_destinydbmode:"DestinyDB Modu",menu_destinydbtooltips:"DestinyDB Araçları",menu_destinystatus:"DestinyStatus Raporu",menu_destinytrials:"DestinyTrials Raporu",menu_destinytracker:"DestinyTracker Raporu",menu_destinyguardiangg:"Guardian.GG Raporu",menu_donate:"Bağış",menu_filter_by:"Filter By",menu_filter_by_subclass_eq:"Subclass Equipped",menu_filter_by_weapon_eq:"Weapons Equipped",menu_filter_for_class:"Filter for Class",menu_help:"Yardım",menu_language:"Dil",menu_loadouts:"Teçhizatlar",menu_loadouts_create:"Oluştur",menu_loadouts_manage:"Manage",menu_padheight:"Otomatik Ped Yüksekliği",menu_progress:"Ilerleme",menu_progress_1:"Ilerlemesi eksik olan öğeler",menu_progress_2:"Ilerlemesi Tam olan öğeler",menu_progress_3:"Maksimum olan öğeler",menu_refresh:"Yenile",menu_set:"Set",menu_set_showduplicates:"Birden Fazla Olan Öğeleri Göster",menu_set_showmissing:"Eksik Öğeleri Göster",menu_settings:"Ayarlar",menu_options:"More",menu_shareurl:"URL'yi Arkadaşlarınla paylaş",menu_sortby:"Sort By",menu_sortby_lightlvl:"Light Level",menu_sortby_name:"Name",menu_sortby_type:"Type",menu_sortby_tier_type:"Tier, Type, Light",menu_sortby_tier_light:"Tier, Light",menu_sortby_tier_name:"Tier, Name",menu_sortby_type_light:"Type, Light",menu_tier:"Öğe Türü",menu_useps:"PlayStation Hesabını Kullan",menu_usexbox:"Xbox Hesabını Kullan",menu_view:"Görüntüle",menu_view_armor:"Armorlar",menu_view_by:"View By",menu_view_by_lightlvl:"Light Level",menu_view_by_stat_points:"Combined Stat Points",menu_view_general:"Görevler",menu_view_options:"Görüntüleme Ayarları",menu_view_weapons:"Silahlar",missing_items:"Kayıp Öğeler",most_points:"Points",movepopup_equip:"donan",movepopup_extras:"ekstralar",movepopup_move:"taşı",movepopup_store:"al",movepopup_vault:"vault",normalize:"Normalize",normalize_title:"Normalize - bir öğeyi bütün karakterler arasında eşit olarak bölüştürür",paypal_code:"TR",pick_a_set:"Lütfen bir set seçin",recovery:"Recovery",str:"Str",strength:"Strength",text_shareurl:"Inventoriniz SHARE URL seçeneği ile tekrar yenilenebilir.",this_icon:"Bu ikon ",tier_common:"Yaygın",tier_exotic:"Exotic",tier_legendary:"Legendary",tier_rare:"Rare",tier_uncommon:"Nadir",transfer:"Transfer",transfer_all:"Hepsi",transfer_amount:"Aktarılacak Miktar",transfer_ask:"Don't ask in the future",consolidate:"Consolidate",transfer_consolidate:"Consolidate (pull from all characters",transfer_one:"Bir Adet",unable_create_loadout_for_type:"Bu öğe tipi ile teçhizat oluşturmak mümkün değil.",unable_to_create_loadout_for_bucket:"Bu slot içerisinde 10'dan fazla öğe ile teçhizat oluşturamazsın: ",unable_to_move_bucketitems:"Seçtiğin öğeler bu uygulama ile aktarılamaz.",unable_unequip:"Üzerinizden çıkartılamıyor ",vo_container_width:"Container Width",vo_layout_mode:"Layout Mode",vo_layout_mode_cust:"Custom",vo_layout_mode_def:"Default",vo_number_of_columns:"Columns",vo_vault_columns:"Vault Columns",vo_vault_first:"Ilk/Sol",vo_vault_last:"Son/Sağ",vo_vault_position:"Vault pozisyonu",vo_vault_width:"Vault Width",whats_new_title:"Tower Ghost for Destiny Güncellemeleri"}},tgd.selectMultiCharacters=function(description,characters){var self=this;self.description=description,self.characters=characters;var selectedStatus=ko.observable(_.reduce(self.characters(),function(memo,character){return memo[character.id]="Vault"!==character.id,memo},{}));self.selectedCharacters=ko.computed(function(){return _.filter(self.characters(),function(c){return selectedStatus()[c.id]===!0})}),self.setSelectedCharacter=function(){var ss=selectedStatus();ss[this.id]=!ss[this.id],selectedStatus(ss)}},tgd.settingsManager=function(settings){var self=this;_.extend(self,settings),self.activeLocale=ko.observable(self.currentLocale()),self.activeLocale.subscribe(function(language_code){self.appLocale(language_code),self.autoUpdates(!0),tgd.checkUpdates(),BootstrapDialog.alert("Downloading updated language files")}),self.autoUpdates.subscribe(function(autoUpdates){autoUpdates?tgd.checkUpdates():(localStorage.setItem("manifest",null),localStorage.setItem("last_update_files",null),tgd.loader.reset())})},tgd.getStoredValue=function(key){var saved="";return window.localStorage&&window.localStorage.getItem&&(saved=window.localStorage.getItem(key)),_.isEmpty(saved)?tgd.defaults[key]:saved},tgd.StoreObj=function(key,compare,writeCallback){var value=ko.observable(compare?tgd.getStoredValue(key)==compare:tgd.getStoredValue(key));this.read=function(){return value()},this.write=function(newValue){window.localStorage.setItem(key,newValue),value(newValue),writeCallback&&writeCallback(newValue)}},tgd.transferConfirm=function(item,targetCharacterId,characters,onFinish){var self=this,getItemCount=function(characters){return _.reduce(characters,function(memo,character){var items=_.where(character.items(),{description:item.description});return memo+=_.reduce(items,function(memo,i){return memo+i.primaryStat()},0)},0)};self.itemTotal=getItemCount(characters()),self.characterTotal=getItemCount(_.filter(characters(),function(character){return item.character.id==character.id})),self.dialog=null,self.consolidate=ko.observable(!1),self.materialsAmount=ko.observable(item.primaryStat()),self.finishTransfer=function(consolidate){if(consolidate)item.consolidate(targetCharacterId,item.description),self.dialog.close();else{var transferAmount=parseInt(self.materialsAmount());!isNaN(transferAmount)&&transferAmount>0&&transferAmount<=self.characterTotal?(onFinish(transferAmount),self.dialog.close()):BootstrapDialog.alert(app.activeText().invalid_transfer_amount+transferAmount)}},self.setDialog=function(dialog){self.dialog=dialog},self.decrement=function(){var num=parseInt(self.materialsAmount());isNaN(num)||self.materialsAmount(Math.max(num-1,1))},self.increment=function(){var num=parseInt(self.materialsAmount());isNaN(num)||self.materialsAmount(Math.min(num+1,self.characterTotal))},self.all=function(){var num=parseInt(self.materialsAmount());isNaN(num)||self.materialsAmount(self.characterTotal)},self.one=function(){var num=parseInt(self.materialsAmount());isNaN(num)||self.materialsAmount(1)}},tgd.showLoading=function(callback){$("body").css("cursor","progress"),setTimeout(function(){callback(),setTimeout(function(){$("body").css("cursor","default")},10)},600)},tgd.innerCartesianProductOf=function(subSets){for(var out=[],i0=0;2>i0;i0++)for(var i1=0;2>i1;i1++)for(var i2=0;2>i2;i2++)for(var i3=0;2>i3;i3++)for(var i4=0;2>i4;i4++)for(var i5=0;2>i5;i5++)for(var i6=0;2>i6;i6++)out.push([subSets[0][i0],subSets[1][i1],subSets[2][i2],subSets[3][i3],subSets[4][i4],subSets[5][i5],subSets[6][i6]]);return out},tgd.cartesianProductOf=function(x){return _.reduce(x,function(a,b){return _.flatten(_.map(a,function(x){return _.map(b,function(y){return x.concat([y])})}),!0)},[[]])},tgd.sum=function(arr){return _.reduce(arr,function(memo,num){return memo+num},0)},tgd.average=function(arr){return _.reduce(arr,function(memo,num){return memo+num},0)/arr.length},tgd.joinStats=function(arrItems){for(var tmp={Intellect:0,Discipline:0,Strength:0},i=0,len=arrItems.length;len>i;i++){var item;item=arrItems[i].activeRoll?arrItems[i].activeRoll:arrItems[i].stats,_.has(item,"Intellect")&&(tmp.Intellect+=item.Intellect,tmp.Discipline+=item.Discipline,tmp.Strength+=item.Strength)}return tmp},tgd.hashCode=function(str){if(Array.prototype.reduce)return str.split("").reduce(function(a,b){return a=(a<<5)-a+b.charCodeAt(0),a&a},0);var i,chr,len,hash=0;if(0===str.length)return hash;for(i=0,len=str.length;len>i;i++)chr=str.charCodeAt(i),hash=(hash<<5)-hash+chr,hash|=0;return hash},tgd.version="3.9.3.2",tgd.moveItemPositionHandler=function(element,item){if(app.destinyDbMode()===!0)return window.open(item.href,tgd.openTabAs),!1;if(app.loadoutMode()===!0){var existingItem,itemFound=!1;item._id>0?(existingItem=_.findWhere(app.activeLoadout().ids(),{id:item._id}),existingItem&&(app.activeLoadout().ids.remove(existingItem),itemFound=!0)):(existingItem=_.filter(app.activeLoadout().generics(),function(itm){return item.id==itm.hash&&item.characterId()==itm.characterId}),existingItem.length>0&&(app.activeLoadout().generics.removeAll(existingItem),itemFound=!0)),itemFound===!1&&(item.transferStatus>=2&&"Subclasses"!=item.bucketType?$.toaster({priority:"danger",title:"Warning",message:app.activeText().unable_create_loadout_for_type,settings:{timeout:tgd.defaults.toastTimeout}}):"0"===item._id?app.activeLoadout().addGenericItem({hash:item.id,bucketType:item.bucketType,characterId:item.characterId()}):_.where(app.activeLoadout().items(),{bucketType:item.bucketType}).length<10?app.activeLoadout().addUniqueItem({id:item._id,bucketType:item.bucketType,doEquip:!1}):$.toaster({priority:"danger",title:"Error",message:app.activeText().unable_to_create_loadout_for_bucket+item.bucketType,settings:{timeout:tgd.defaults.toastTimeout}}))}else{app.activeItem(item);var $movePopup=$("#move-popup");if(item.transferStatus>=2&&"Subclasses"!=item.bucketType||"Post Master"==item.bucketType||"Messages"==item.bucketType||"Invisible"==item.bucketType||"Lost Items"==item.bucketType||"Bounties"==item.bucketType||"Mission"==item.bucketType||"Armsday Order"==item.typeName)return void $.toaster({priority:"danger",title:"Error",message:app.activeText().unable_to_move_bucketitems,settings:{timeout:tgd.defaults.toastTimeout}});element==tgd.activeElement?($movePopup.hide(),tgd.activeElement=null):(tgd.activeElement=element,$ZamTooltips.hide(),window.isMobile?($("body").css("padding-bottom",$movePopup.height()+"px"),setTimeout(function(){$movePopup.show().addClass("mobile")},50)):$movePopup.removeClass("navbar navbar-default navbar-fixed-bottom").addClass("desktop").show().position({my:"left bottom",at:"left top",collision:"none",of:element,using:function(pos,ui){var obj=$(this),box=$(ui.element.element).find(".move-popup").width();obj.removeAttr("style"),box+pos.left>$(window).width()&&(pos.left=pos.left-box),obj.css(pos).width(box)}}))}};var Item=function(model,profile){var self=this;model&&model.id&&(model.equipRequiredLevel=0,model.isEquipment=!0),_.each(model,function(value,key){self[key]=value}),this.character=profile,this.futureBaseCSP=ko.observable(0),this.init(model),this.characterId=ko.observable(self.character.id),this.isFiltered=ko.observable(!1),this.isVisible=ko.pureComputed(this._isVisible,this),this.columnMode=ko.computed(this._columnMode,this),this.opacity=ko.computed(this._opacity,this),this.primaryStatValue=ko.pureComputed(this._primaryStatValue,this),this.maxLightPercent=ko.pureComputed(function(){var maxBonusPoints=self.getValue("MaxBonusPoints"),futureBaseCSP=self.futureBaseCSP(),maxBaseCSP=tgd.DestinyMaxCSP[self.bucketType];"2672107540"==self.id&&(maxBaseCSP=286),futureBaseCSP>maxBonusPoints&&("6917529080710062428"==self._id,maxBaseCSP-=maxBonusPoints),"6917529091018349244"==self._id;var maxLightPercent=futureBaseCSP/maxBaseCSP*100;return Math.round(100*maxLightPercent)/100}),this.cspStat=ko.pureComputed(this._cspStat,this),this.cspClass=ko.pureComputed(this._cspClass,this)};Item.prototype={init:function(item){var self=this,info={};if(item.itemHash in _itemDefs?info=_itemDefs[item.itemHash]:item.id in _itemDefs?(item.itemHash=item.id,info=_itemDefs[item.id]):info=item.itemHash in _questDefs?{bucketTypeHash:_questDefs[item.itemHash],itemName:"Classified Quest",tierTypeName:"Common",icon:"/img/misc/missing_icon.png",itemTypeName:"Quests"}:{bucketTypeHash:"1498876634",itemName:"Classified",tierTypeName:"Exotic",icon:"/img/misc/missing_icon.png",itemTypeName:"Classified"},info.bucketTypeHash in tgd.DestinyBucketTypes){if("2422292810"==info.bucketTypeHash&&info.deleteOnAction===!1)return;var description,tierTypeName,itemDescription,itemTypeName,bucketType;try{description=decodeURIComponent(info.itemName),tierTypeName=decodeURIComponent(info.tierTypeName),itemDescription=decodeURIComponent(info.itemDescription),itemTypeName=decodeURIComponent(info.itemTypeName)}catch(e){description=info.itemName,tierTypeName=info.tierTypeName,itemDescription=info.itemDescription,itemTypeName=info.itemTypeName}info.icon=""===info.icon?"/img/misc/missing_icon.png":info.icon,bucketType=item.bucketType||self.character.getBucketTypeHelper(item,info),$.extend(self,{id:item.itemHash,href:"http://destinydb.com/items/"+item.itemHash,_id:item.itemInstanceId,characterId:ko.observable(self.character.id),isEquipped:ko.observable(),locked:ko.observable(),bonusStatOn:ko.observable(),primaryStat:ko.observable(),damageType:item.damageType,damageTypeName:tgd.DestinyDamageTypes[item.damageType],isEquipment:item.isEquipment,isGridComplete:item.isGridComplete,description:description,itemDescription:itemDescription,classType:info.classType,bucketType:bucketType,type:info.itemSubType,typeName:itemTypeName,tierType:info.tierType,tierTypeName:tierTypeName,icon:tgd.dataDir+info.icon,maxStackSize:info.maxStackSize,equipRequiredLevel:item.equipRequiredLevel,canEquip:item.canEquip,weaponIndex:tgd.DestinyWeaponPieces.indexOf(bucketType),armorIndex:tgd.DestinyArmorPieces.indexOf(bucketType),transferStatus:item.transferStatus,backgroundPath:"Emblem"==itemTypeName?app.makeBackgroundUrl(info.secondaryIcon):"",actualBucketType:_.reduce(tgd.DestinyLayout,function(memo,layout){return(layout.bucketTypes.indexOf(bucketType)>-1&&-1==layout.extras.indexOf(bucketType)||-1==layout.bucketTypes.indexOf(bucketType)&&layout.extras.indexOf(bucketType)>-1)&&(memo=layout.array),memo},"")}),self.updateItem(item)}},updateItem:function(item){var self=this,info={};info=item.itemHash in _itemDefs?_itemDefs[item.itemHash]:item.itemHash in _questDefs?{bucketTypeHash:_questDefs[item.itemHash],itemName:"Classified Quest",tierTypeName:"Common",icon:"/img/misc/missing_icon.png",itemTypeName:"Quests"}:{bucketTypeHash:"1498876634",itemName:"Classified",tierTypeName:"Exotic",icon:"/img/misc/missing_icon.png",itemTypeName:"Classified"};var bucketType=item.bucketType||self.character.getBucketTypeHelper(item,info),primaryStat=self.parsePrimaryStat(item,bucketType);self.primaryStat(primaryStat),self.isEquipped(item.isEquipped),self.locked(item.locked),self.perks=self.parsePerks(item.id,item.talentGridHash,item.perks,item.nodes,item.itemInstanceId),self.perkTree=self.createPerkTree(item.id,item.talentGridHash,item.perks,item.nodes,item.itemInstanceId),self.statPerks=_.where(self.perks,{isStat:!0}),self.hasLifeExotic=_.where(self.perks,{name:"The Life Exotic"}).length>0,self.stats=self.parseStats(self.perks,item.stats,item.itemHash);var currentBonus=0===self.statPerks.length?0:tgd.bonusStatPoints(self.armorIndex,primaryStat),maxLightBonus=tgd.bonusStatPoints(self.armorIndex,tgd.DestinyLightCap),currentCSP=tgd.sum(_.filter(_.values(self.stats),function(value){return value>0}));self.statText=_.sortBy(_.reduce(self.stats,function(memo,stat,key){return stat>0&&memo.push(key.substring(0,3)+" "+stat),memo},[])).join("/"),self.rolls=self.normalizeRolls(self.stats,self.statPerks,primaryStat,currentBonus,""),self.futureRolls=self.calculateFutureRolls(self.stats,self.statPerks,primaryStat,currentBonus,maxLightBonus,bucketType,this.description);var hasUnlockedStats=_.where(self.statPerks,{active:!0}).length>0;self.bonusStatOn(hasUnlockedStats?_.findWhere(self.statPerks,{active:!0}).name:""),self.hasUnlockedStats=hasUnlockedStats||0===self.statPerks.length,self.progression=0===_.filter(self.perks,function(perk){return perk.active===!1&&-1===perk.isExclusive&&perk.isVisible===!0}).length;var infusedStats=[currentCSP];if(primaryStat>=200&&self.tierType>=5&&self.armorIndex>-1){var newStats=tgd.calculateInfusedStats(primaryStat,currentCSP-(self.hasUnlockedStats?currentBonus:0),bucketType);infusedStats=_.uniq(_.map(newStats,function(stat){return Math.min(stat+maxLightBonus,tgd.DestinyMaxCSP[self.bucketType])})),self.futureBaseCSP(newStats[1])}self.primaryValues={CSP:currentCSP,Default:primaryStat,MaxLightCSP:infusedStats[0],currentBonus:currentBonus,maxLightBonus:maxLightBonus,predictedCSP:infusedStats}},calculateFutureRolls:function(stats,statPerks,primaryStat,currentBonus,futureBonus,bucketType,description){var futureRolls=[];if(0===statPerks.length)futureRolls=[stats];else{var allStatsLocked=0===_.where(statPerks,{active:!0}).length;futureRolls=_.map(statPerks,function(statPerk){var tmp=_.clone(stats),isStatActive=statPerk.active,otherStatName=_.reduce(stats,function(memo,stat,name){return name!=statPerk.name&&stat>0?name:memo},""),activeStatName=isStatActive?statPerk.name:otherStatName;""!==activeStatName&&(tmp[activeStatName]=tmp[activeStatName]-(allStatsLocked?0:currentBonus));var currentStatValue=tmp[statPerk.name],otherStatValue=tmp[otherStatName];return tmp[statPerk.name]=(primaryStat>=tgd.DestinyStatCap?currentStatValue:tgd.calculateInfusedStats(primaryStat,currentStatValue,bucketType)[0])+futureBonus,tmp.bonusOn=statPerk.name,""!==otherStatName&&(tmp[otherStatName]=primaryStat>=tgd.DestinyStatCap?otherStatValue:tgd.calculateInfusedStats(primaryStat,otherStatValue,bucketType)[0]),tmp})}return futureRolls},normalizeRolls:function(stats,statPerks,primaryStat,bonus,description){var arrRolls=[];if(0===statPerks.length)arrRolls=[stats];else{var hasUnlockedStats=_.where(statPerks,{active:!0}).length>0;arrRolls=_.map(statPerks,function(statPerk){var tmp=_.clone(stats);if(tmp.bonusOn=statPerk.name,hasUnlockedStats&&statPerk.active===!1){var otherStatName=_.reduce(stats,function(memo,stat,name){return name!=statPerk.name&&stat>0?name:memo},"");tmp[otherStatName]=tmp[otherStatName]-bonus,tmp[statPerk.name]=tmp[statPerk.name]+bonus}else hasUnlockedStats===!1&&(tmp[statPerk.name]=tmp[statPerk.name]+bonus);return tmp})}return arrRolls},parsePrimaryStat:function(item,bucketType){var primaryStat="";if(item.primaryStat&&(primaryStat=item.primaryStat&&item.primaryStat.value?item.primaryStat.value:item.primaryStat),item&&item.objectives&&item.objectives.length>0){var progress=(100*tgd.average(_.map(item.objectives,function(objective){var result=0;return objective.objectiveHash in _objectiveDefs&&_objectiveDefs[objective.objectiveHash]&&_objectiveDefs[objective.objectiveHash].completionValue&&(result=objective.progress/_objectiveDefs[objective.objectiveHash].completionValue),result}))).toFixed(0)+"%";primaryStat=""===primaryStat?progress:primaryStat+"/"+progress}return _.has(tgd.DestinyBucketSizes,bucketType)&&(primaryStat=item.stackSize),primaryStat},parseStats:function(perks,stats,itemHash){var parsedStats={};return stats&&stats.length&&stats.length>0?(_.each(stats,function(stat){if(stat.statHash in window._statDefs){var p=window._statDefs[stat.statHash];parsedStats[p.statName]=stat.value}}),(_.findWhere(perks,{name:"Tripod",active:!0})||[1274330686,2808364178].indexOf(itemHash)>-1)&&(parsedStats.Magazine=3)):_.isObject(stats)&&(parsedStats=stats),parsedStats},createPerkTree:function(id,talentGridHash,perks,nodes,itemInstanceId){var self=this,talentGrid=_talentGridDefs[talentGridHash];self.dtrUrl=[];var perkTree=_.reduce(nodes,function(memo,node){
var tgNode=_.findWhere(talentGrid.nodes,{nodeHash:node.nodeHash}),level=tgNode.column,dtrHash=node.nodeHash.toString(16),stepIndex=node.stepIndex.toString(16);dtrHash.length>1&&(dtrHash+="."),dtrHash+=stepIndex,node.isActivated&&(dtrHash+="o"),self.dtrUrl.push(dtrHash);var talent=tgNode.steps[node.stepIndex];return talent&&!node.hidden&&(talent.node=node,talent.column=level,_.has(memo,level)||(memo[level]=[]),-1==_.pluck(memo[level],"nodeStepHash").indexOf(talent.nodeStepHash)&&memo[level].push(talent)),memo},[]);return self.ddbUrl=_.reduce(perkTree,function(memo,p,i){return i>0&&_.each(p,function(n,ii){n.node.isActivated&&memo.push([n.column,ii,n.node.stepIndex+1].join("-"))}),memo},[]).join(";"),-1==self.href.indexOf("#calc")&&(self.href=self.href+"#calc;"+self.ddbUrl),self.dtrUrl=self.dtrUrl.join(";"),perkTree},parsePerks:function(id,talentGridHash,perks,nodes,itemInstanceId){var parsedPerks=[];if(id)parsedPerks=perks;else if(_.isArray(perks)&&perks.length>0){var talentGrid=_talentGridDefs[talentGridHash];if(talentGrid&&talentGrid.nodes){_.each(perks,function(perk){if(perk.perkHash in window._perkDefs){var isInherent,p=window._perkDefs[perk.perkHash],nodeIndex=talentGrid.nodes.indexOf(_.filter(talentGrid.nodes,function(o){return _.flatten(_.pluck(o.steps,"perkHashes")).indexOf(p.perkHash)>-1})[0]);nodeIndex>0&&(isInherent=_.reduce(talentGrid.nodes[nodeIndex].steps,function(memo,step){if(memo===!1){var isPerk=_.values(step.perkHashes).indexOf(p.perkHash)>-1;isPerk&&0===step.activationRequirement.gridLevel&&(memo=!0)}return memo},!1));var description=p&&p.displayDescription?p.displayDescription:"";parsedPerks.push({iconPath:tgd.dataDir+p.displayIcon,name:p.displayName,description:"<strong>"+p.displayName+"</strong>: "+description,active:perk.isActive,isExclusive:talentGrid.exclusiveSets.indexOf(nodeIndex),isInherent:isInherent,isVisible:!0,hash:p.perkHash})}});var statNames=_.pluck(tgd.DestinyArmorStats,"statName"),perkHashes=_.pluck(parsedPerks,"hash"),perkNames=_.pluck(parsedPerks,"name"),talentPerks={},talentGridNodes=talentGrid.nodes;_.each(nodes,function(node){if(node.hidden===!1){var nodes=_.findWhere(talentGridNodes,{nodeHash:node.nodeHash});if(nodes&&nodes.steps&&_.isArray(nodes.steps)){var perk=nodes.steps[node.stepIndex],isSkill=_.intersection(perk.nodeStepName.split(" "),statNames);if(0!==isSkill.length||-1!=tgd.DestinyUnwantedNodes.indexOf(perk.nodeStepName)||-1!=perkNames.indexOf(perk.nodeStepName)||0!==perk.perkHashes.length&&-1!==perkHashes.indexOf(perk.perkHashes[0])){if(isSkill.length>0){var statName=isSkill[0];talentPerks[statName]={active:node.isActivated===!0&&-1==[7,1].indexOf(node.state),name:statName,description:"",iconPath:"",isExclusive:-1,isVisible:!1,isStat:!0,hash:_.findWhere(tgd.DestinyArmorStats,{statName:statName})}}}else talentPerks[perk.nodeStepName]={active:node.isActivated,name:perk.nodeStepName,description:"<strong>"+perk.nodeStepName+"</strong>: "+perk.nodeStepDescription,iconPath:tgd.dataDir+perk.icon,isExclusive:-1,hash:perk.icon.match(/icons\/(.*)\.png/)[1],isVisible:node.isActivated}}}}),_.each(talentPerks,function(perk){parsedPerks.push(perk)})}}return parsedPerks},_opacity:function(){return this.equipRequiredLevel<=this.character.level()||"Vault"==this.character.id?1:.3},_columnMode:function(){var self=this,className="";return className="Vault"==self.characterId()?"col-xs-"+app.vaultColumns():4==tgd.DestinyBucketColumns[self.bucketType]?"col-xs-"+tgd.bootstrapGridColumns/4:"col-xs-"+tgd.bootstrapGridColumns/3,self.isGridComplete&&(className+=" complete"),className},isEquippable:function(avatarId){var self=this;return ko.pureComputed(function(){var equippableSubclass="Subclasses"==self.bucketType&&!self.isEquipped()&&self.character.id==avatarId||"Subclasses"!==self.bucketType;return self.characterId()==avatarId&&!self.isEquipped()&&"Vault"!==avatarId&&"Materials"!=self.bucketType&&"Consumables"!=self.bucketType&&"Ornaments"!=self.bucketType&&-1==self.description.indexOf("Engram")&&-1==self.typeName.indexOf("Armsday")&&equippableSubclass||self.characterId()!=avatarId&&"Vault"!==avatarId&&"Materials"!=self.bucketType&&"Consumables"!=self.bucketType&&-1==self.description.indexOf("Engram")&&equippableSubclass&&self.transferStatus<2})},isStoreable:function(avatarId){var self=this;return ko.pureComputed(function(){return self.characterId()!=avatarId&&"Vault"!==avatarId&&"Subclasses"!==self.bucketType&&self.transferStatus<2||self.isEquipped()&&self.character.id==avatarId})},clone:function(){var self=this,model={};for(var i in self)if(self.hasOwnProperty(i)){var val=ko.unwrap(self[i]);"function"!=typeof val&&(model[i]=val)}var newItem=new Item(model,self.character);return newItem},hasPerkSearch:function(search){var foundPerk=!1,self=this;if(self.perks){var vSearch=search.toLowerCase();self.perks.forEach(function(perk){(perk.name.toLowerCase().indexOf(vSearch)>-1||perk.description.toLowerCase().indexOf(vSearch)>-1)&&(foundPerk=!0)})}return foundPerk},hashProgress:function(state){var self=this;return"undefined"!=typeof self.progression?"1"==state&&self.progression===!1?!0:"2"==state&&self.progression===!0&&self.isGridComplete===!1?!0:"3"==state&&self.progression===!0&&self.isGridComplete===!0?!0:!1:!1},hasGeneral:function(type){return"Engrams"==type&&this.description.indexOf("Engram")>-1&&this.isEquipment===!1?!0:"Chroma Colors"==type&&this.description.indexOf("Chroma")>-1&&this.isEquipment===!1?!0:type in tgd.DestinyGeneralItems&&tgd.DestinyGeneralItems[type].indexOf(this.id)>-1?!0:!1},_cspStat:function(){var stat=this.primaryStat();return"CSP"==app.armorViewBy()&&_.has(tgd.DestinyMaxCSP,this.bucketType)&&(stat=this.getValue("All")+"-"+this.getValue("MaxLightCSP")),stat},_cspClass:function(){var rollType="None";if(_.has(tgd.DestinyMaxCSP,this.bucketType)){var maxLightPercent=ko.unwrap(this.maxLightPercent),minAvgPercentNeeded=ko.unwrap(app.minAvgPercentNeeded);rollType="BadRoll",maxLightPercent>=minAvgPercentNeeded?rollType="GoodRoll":maxLightPercent>=minAvgPercentNeeded-4&&(rollType="OkayRoll")}return this.weaponIndex>-1&&(rollType=this.damageTypeName),rollType},_primaryStatValue:function(){if(this.primaryStat&&"function"==typeof this.primaryStat){var primaryStat=ko.unwrap(this.primaryStat());return this.objectives&&"string"==typeof primaryStat&&primaryStat.indexOf("/")>-1&&(primaryStat=parseInt(primaryStat.split("/")[0])),primaryStat}},_isVisible:function(){var $parent=app,self=this;if("undefined"==typeof self.id)return!1;var dmgFilter=!0,progressFilter=!0,weaponFilter=!0,armorFilter=!0,showDuplicate=!0,setFilter=!0,searchFilter=""===$parent.searchKeyword()||""!==$parent.searchKeyword()&&self.description.toLowerCase().indexOf($parent.searchKeyword().toLowerCase())>-1,tierFilter="0"==$parent.tierFilter()||$parent.tierFilter()==self.tierType,lockFilter=""==$parent.lockedState()||"locked"==$parent.lockedState()&&self.locked()||"unlocked"==$parent.lockedState()&&!self.locked(),itemStatValue="";this.primaryStatValue&&this.primaryStatValue()&&(itemStatValue=this.primaryStatValue().toString());var operator=$parent.searchKeyword().substring(0,1);if(""!==itemStatValue&&-1==itemStatValue.indexOf("%")&&(">"==operator||"<"==operator||$.isNumeric($parent.searchKeyword()))){var operand="=",searchValue=$parent.searchKeyword();">"===operator||"<"===operator?(operand=operator+operand,searchValue=searchValue.replace(operator,"")):operand="="+operand,searchFilter=new Function("return "+itemStatValue+operand+searchValue.toString())()}if(self.armorIndex>-1||self.weaponIndex>-1){if(setFilter=0===$parent.setFilter().length||$parent.setFilter().indexOf(self.id)>-1,searchFilter=searchFilter||self.hasPerkSearch($parent.searchKeyword()),self.weaponIndex>-1)dmgFilter=0===$parent.dmgFilter().length||$parent.dmgFilter().indexOf(self.damageTypeName)>-1,weaponFilter="0"==$parent.weaponFilter()||$parent.weaponFilter()==self.typeName;else{var types=_.map(_.pluck(self.perks,"name"),function(name){return name&&name.split(" ")[0]});dmgFilter=0===$parent.dmgFilter().length||_.intersection($parent.dmgFilter(),types).length>0,armorFilter="0"==$parent.armorFilter()||$parent.armorFilter()==self.bucketType}progressFilter="0"==$parent.progressFilter()||self.hashProgress($parent.progressFilter())}generalFilter="0"==$parent.generalFilter()||self.hasGeneral($parent.generalFilter()),showDuplicate=$parent.customFilter()===!1||$parent.customFilter()===!0&&self.isFiltered()===!0;var isVisible=lockFilter&&searchFilter&&dmgFilter&&setFilter&&tierFilter&&progressFilter&&weaponFilter&&armorFilter&&generalFilter&&showDuplicate;return isVisible},unequip:function(callback){var self=this;if(self.isEquipped()===!0){var otherEquipped=!1,itemIndex=-1,otherItems=_.sortBy(_.filter(self.character.items(),function(item){return item._id!=self._id&&item.bucketType==self.bucketType&&item.isEquippable(self.character.id)()}),function(item){return-1*(item.getValue("Light")+item.getValue("CSP"))});if(otherItems.length>0){var minTier=_.min(_.pluck(otherItems,"tierType")),tryNextItem=function(){var item=otherItems[++itemIndex];return _.isUndefined(item)?void(callback?callback(!1):$.toaster({priority:"danger",title:"Error",message:app.activeText().cannot_unequip+self.description,settings:{timeout:tgd.defaults.toastTimeout}})):void(otherEquipped===!1&&(item!=self&&item.equip?item.equip(self.characterId(),function(isEquipped,result){isEquipped===!0?(otherEquipped=!0,callback(!0)):isEquipped===!1&&result&&result.ErrorCode&&1634===result.ErrorCode?callback(!1):tryNextItem()}):tryNextItem()))};if(6==minTier){var otherItemUnequipped=!1,otherBucketTypes=self.weaponIndex>-1?_.clone(tgd.DestinyWeaponPieces):_.clone(tgd.DestinyArmorPieces);otherBucketTypes.splice(self.weaponIndex>-1?self.weaponIndex:self.armorIndex,1),_.each(otherBucketTypes,function(bucketType){var itemEquipped=self.character.itemEquipped(bucketType);itemEquipped&&itemEquipped.tierType&&6==itemEquipped.tierType&&(itemEquipped.unequip(function(result){result?tryNextItem():($.toaster({priority:"danger",title:"Error",message:app.activeText().unable_unequip+itemEquipped.description,settings:{timeout:tgd.defaults.toastTimeout}}),callback(!1))}),otherItemUnequipped=!0)}),otherItemUnequipped||tryNextItem()}else tryNextItem()}else callback(!1)}else callback(!0)},equip:function(targetCharacterId,callback){var self=this,done=function(){app.bungie.equip(targetCharacterId,self._id,function(e,result){if(result&&result.Message&&"Ok"==result.Message){var done=function(){self.isEquipped(!0),self.character.items().forEach(function(item){item._id!=self._id&&item.bucketType==self.bucketType&&item.isEquipped()===!0&&item.isEquipped(!1)}),"Emblem"==self.bucketType&&(self.character.icon(self.icon),self.character.background(self.backgroundPath)),callback&&callback(!0)};self instanceof Item?done():app.findReference(self,function(item){self=item,done()})}else callback?callback(!1,result):result&&result.Message?$.toaster({priority:"info",title:"Error",message:result.Message,settings:{timeout:tgd.defaults.toastTimeout}}):BootstrapDialog.alert(self.description+":"+app.activeText().cannot_equip+(result&&result.error)?result.error:"")})},sourceCharacterId=self.characterId();if(targetCharacterId==sourceCharacterId)if(6==self.tierType&&self.hasLifeExotic===!1){var otherExoticFound=!1,otherBucketTypes=self.weaponIndex>-1?_.clone(tgd.DestinyWeaponPieces):_.clone(tgd.DestinyArmorPieces);otherBucketTypes.splice(self.weaponIndex>-1?self.weaponIndex:self.armorIndex,1),_.each(otherBucketTypes,function(bucketType){var otherExotic=_.filter(_.where(self.character.items(),{bucketType:bucketType,tierType:6}),function(item){return item.isEquipped()&&item.hasLifeExotic===!1});otherExotic.length>0&&(otherExoticFound=!0,otherExotic[0].unequip(done))}),otherExoticFound===!1&&done()}else done();else self.store(targetCharacterId,function(newProfile){self.character=newProfile,self.characterId(newProfile.id),self.equip(targetCharacterId,callback)})},getStackAmount:function(stacks){return _.reduce(stacks,function(memo,item){return memo+=item.primaryStat()},0)},adjustGenericItem:function(sourceCharacter,targetCharacter,amount,callback){var self=this,maxStackSize=this.maxStackSize,sourceStacks=sourceCharacter.getSiblingStacks(self.description),targetStacks=targetCharacter.getSiblingStacks(self.description),sourceRemainder=Math.max(0,self.getStackAmount(sourceStacks)-amount),targetItem=_.findWhere(targetCharacter.items(),{description:this.description}),amountInTarget=self.getStackAmount(targetStacks),targetAmount=amount+amountInTarget,remainder=0;if(0===sourceRemainder)_.each(sourceStacks,function(item){sourceCharacter.items.remove(item)});else if(maxStackSize>=sourceRemainder)self.primaryStat(sourceRemainder),sourceStacks.length>1&&_.each(sourceStacks,function(item,index){item!=self&&self.character.items.remove(item)});else{Math.ceil(sourceRemainder/maxStackSize);remainder=sourceRemainder,_.each(sourceStacks,function(item){var itemAmount=remainder-maxStackSize>0?maxStackSize:remainder;itemAmount>0?(item.primaryStat(itemAmount),remainder-=itemAmount):self.character.items.remove(item)})}if(maxStackSize>=targetAmount)if(targetItem)targetItem.primaryStat(targetAmount);else{var theClone=self.clone();theClone.characterId(targetCharacter.id),theClone.character=targetCharacter,theClone.primaryStat(targetAmount),targetCharacter.items.push(theClone)}else{var totalTargetStacks=Math.ceil(targetAmount/maxStackSize),missingItemsAmount=totalTargetStacks-targetStacks.length;remainder=0===amountInTarget?targetAmount:targetAmount-(totalTargetStacks-1)*maxStackSize,_.each(targetStacks,function(item){item.primaryStat()<maxStackSize&&item.primaryStat(maxStackSize)}),_.times(missingItemsAmount,function(index){var itemAmount=remainder-maxStackSize>0?maxStackSize:remainder;remainder-=itemAmount;var theClone=self.clone();theClone.characterId(targetCharacter.id),theClone.character=targetCharacter,theClone.primaryStat(itemAmount),targetCharacter.items.push(theClone)})}callback()},transfer:function(sourceCharacterId,targetCharacterId,amount,cb){var x,y,self=this,characters=app.characters();if(0===characters.length)return app.refresh(),BootstrapDialog.alert("Attempted a transfer with no characters loaded, how is that possible? Please report this issue to my Github.");var isVault="Vault"==targetCharacterId,ids=_.pluck(characters,"id");if(x=characters[ids.indexOf(sourceCharacterId)],y=characters[ids.indexOf(targetCharacterId)],_.isUndefined(y))return app.refresh();var itemsInDestination=_.where(y.items(),{bucketType:self.bucketType}).length,maxBucketSize=self.bucketType in tgd.DestinyBucketSizes?tgd.DestinyBucketSizes[self.bucketType]:10;return itemsInDestination==maxBucketSize&&"Vault"!=y.id?BootstrapDialog.alert("Cannot transfer "+self.description+" because "+self.bucketType+" is full."):void app.bungie.transfer(isVault?sourceCharacterId:targetCharacterId,self._id,self.id,amount,isVault,function(e,result){result&&result.Message&&"Ok"==result.Message?"Materials"==self.bucketType||"Consumables"==self.bucketType||"Ornaments"==self.bucketType?self.adjustGenericItem(x,y,amount,function(){cb(y,x)}):(x.items.remove(function(item){return item._id==self._id}),self.character=y,y.items.push(self),setTimeout(function(){self.characterId(targetCharacterId),cb&&cb(y,x)},500)):cb?cb(y,x,result):result&&result.Message&&$.toaster({priority:"info",title:"Error",message:result.Message,settings:{timeout:tgd.defaults.toastTimeout}})})},handleTransfer:function(targetCharacterId,cb){var self=this;return function(y,x,result){if(result&&result.ErrorCode&&(1656==result.ErrorCode||1623==result.ErrorCode))x._reloadBucket(self.bucketType,void 0,function(){y._reloadBucket(self.bucketType,void 0,function(){app.findReference(self,function(newItem){newItem.store(targetCharacterId,cb)})})});else if(result&&result.ErrorCode&&1642==result.ErrorCode)x._reloadBucket(self.bucketType,void 0,function(){y._reloadBucket(self.bucketType,void 0,function(){var adhoc=new tgd.Loadout;self._id>0?adhoc.addUniqueItem({id:self._id,bucketType:self.bucketType,doEquip:!1}):adhoc.addGenericItem({hash:self.id,bucketType:self.bucketType,characterId:self.characterId()});var msa=adhoc.transfer(targetCharacterId,!0);msa.length>0&&adhoc.swapItems(msa,targetCharacterId,function(){cb&&cb(y,x)})})});else if(result&&result.ErrorCode&&1648==result.ErrorCode){var vaultItems=_.findWhere(app.characters(),{id:"Vault"}).items(),targetItem=_.where(vaultItems,{id:self.id});targetItem.length>0&&targetItem[0].store(targetCharacterId,function(){self.character.id=targetCharacterId,self.store("Vault",cb)})}else cb?cb(y,x):result&&result.Message&&$.toaster({priority:"info",title:"Error",message:result.Message,settings:{timeout:tgd.defaults.toastTimeout}})}},store:function(targetCharacterId,callback){var self=this,sourceCharacterId=self.characterId(),defaultTransferAmount=1,done=function(transferAmount){"Vault"==targetCharacterId?self.unequip(function(result){result===!0?self.transfer(sourceCharacterId,"Vault",transferAmount,self.handleTransfer(targetCharacterId,callback)):callback?callback(self.character):$.toaster({priority:"danger",title:"Error",message:"Unable to unequip "+self.description,settings:{timeout:tgd.defaults.toastTimeout}})}):"Vault"!==sourceCharacterId?self.unequip(function(result){result===!0?"Subclasses"==self.bucketType?callback&&callback(self.character):self.transfer(sourceCharacterId,"Vault",transferAmount,self.handleTransfer(targetCharacterId,function(){self.character.id==targetCharacterId?callback&&callback(self.character):self.transfer("Vault",targetCharacterId,transferAmount,self.handleTransfer(targetCharacterId,callback))})):callback?callback(self.character):$.toaster({priority:"danger",title:"Error",message:"Unable to unequip "+self.description,settings:{timeout:tgd.defaults.toastTimeout}})}):self.transfer("Vault",targetCharacterId,transferAmount,self.handleTransfer(targetCharacterId,callback))};if("Materials"==self.bucketType||"Consumables"==self.bucketType||"Ornaments"==self.bucketType)if(self.primaryStat()==defaultTransferAmount)done(defaultTransferAmount);else if(app.autoXferStacks()===!0||tgd.autoTransferStacks===!0)done(self.primaryStat());else{var confirmTransfer=new tgd.transferConfirm(self,targetCharacterId,app.orderedCharacters,done),defaultAction=function(){confirmTransfer.finishTransfer(confirmTransfer.consolidate())};new tgd.koDialog({templateName:"confirmTransferTemplate",viewModel:confirmTransfer,onFinish:defaultAction,buttons:[{label:app.activeText().transfer,cssClass:"btn-primary",action:defaultAction},{label:app.activeText().close_msg,action:function(dialogItself){dialogItself.close()}}]}).title(app.activeText().transfer+" "+self.description).show(!0,function(){},function(){$("input.materialsAmount").select()})}else{var adhoc=new tgd.Loadout;adhoc.addUniqueItem({id:self._id,bucketType:self.bucketType,doEquip:!1});var result=adhoc.transfer(targetCharacterId,!0)[0];result&&result.swapItem?adhoc.promptUserConfirm([result],targetCharacterId,callback):done(defaultTransferAmount)}},normalize:function(characters){app.normalizeSingle(this.description,characters,!1,void 0)},consolidate:function(targetCharacterId,description,selectedCharacters){var activeCharacters="undefined"==typeof selectedCharacters?[]:selectedCharacters,getNextStack=function(){var i=0,chars=_.filter(app.orderedCharacters(),function(c){return c.id!==targetCharacterId&&0===activeCharacters.length||activeCharacters.indexOf(c.id)>-1}),stacks=_.flatten(_.map(chars,function(c){return _.filter(c.items(),{description:description})}));return function(){return i>=stacks.length?void 0:stacks[i++]}}(),nextTransfer=function(callback){var theStack=getNextStack();if("undefined"==typeof theStack)return void(void 0!==callback&&callback());var transferAmount=theStack.primaryStat();"Vault"==targetCharacterId?theStack.transfer(theStack.character.id,"Vault",transferAmount,function(){nextTransfer(callback)}):"Vault"==theStack.character.id?theStack.transfer("Vault",targetCharacterId,transferAmount,function(){nextTransfer(callback)}):theStack.character.id==targetCharacterId?nextTransfer(callback):theStack.transfer(theStack.character.id,"Vault",transferAmount,function(){theStack.transfer("Vault",targetCharacterId,transferAmount,function(){nextTransfer(callback)})})};nextTransfer(void 0)},showExtras:function(){var self=this,extrasPopup=new tgd.extrasPopup(self);new tgd.koDialog({templateName:"normalizeTemplate",viewModel:extrasPopup,buttons:[{label:app.activeText().normalize,cssClass:"btn-primary",action:function(dialogItself){var characters=extrasPopup.selectedCharacters();return characters.length<=1?void BootstrapDialog.alert("Need to select two or more characters."):(self.normalize(characters),void dialogItself.close())}},{label:app.activeText().consolidate,cssClass:"btn-primary",action:function(dialogItself){var characters=_.pluck(extrasPopup.selectedCharacters(),"id");self.consolidate(self.character.id,self.description,characters),dialogItself.close()}},{label:app.activeText().close_msg,action:function(dialogItself){dialogItself.close()}}]}).title("Extras for "+self.description).show(!0)},toggleLock:function(){var self=this,characterId="Vault"==self.characterId()?_.find(app.orderedCharacters(),function(c){return"Vault"!==c.id}).id:self.character.id,newState=!self.locked();app.bungie.setlockstate(characterId,self._id,newState,function(results,response){return 1!==response.ErrorCode?BootstrapDialog.alert("setlockstate error: "+JSON.stringify(response)):void self.locked(newState)})},openPerkTree:function(){new tgd.koDialog({templateName:"itemPerkTreeTemplate",viewModel:this,buttons:[{label:app.activeText().cancel,action:function(dialog){dialog.close()}}]}).title("Perks for "+this.description).show(!0)},openInDestinyTracker:function(){window.open("http://db.destinytracker.com/items/"+this.id+"#"+this.dtrUrl,tgd.openTabAs)},openInArmory:function(){window.open("https://www.bungie.net/en/armory/Detail?type=item&item="+this.id,tgd.openTabAs)},openInDestinyDB:function(){window.open(this.href,tgd.openTabAs)},getValue:function(type){var value;return value="Light"==type?this.primaryValues.Default:"MaxLightCSP"==type?this.primaryValues.MaxLightCSP:"MaxLightPercent"==type?this.maxLightPercent():"MaxBonusPoints"==type?this.primaryValues.maxLightBonus:"All"==type||"CSP"==type?this.primaryValues.CSP:_.isObject(this.stats)&&type in this.stats?parseInt(this.stats[type]):0}},Profile.prototype={init:function(profile){var self=this;"Vault"==self.id?(self.background("assets/vault_emblem.jpg"),self.icon("assets/vault_icon.jpg"),self.gender("Tower"),self.classType("Vault")):self.updateCharacter(profile),_.has(profile,"processed")&&profile.processed?self.items(_.map(profile.items,function(item){return new Item(item,self)})):self.addItems(profile.items,[]),"Vault"!=self.id&&"undefined"==typeof profile.processed&&self._reloadBucket(self,void 0,function(){},!0)},setFarmTarget:function(){app.farmTarget(this.id)},updateCharacter:function(profile){var self=this;profile&&profile.processed?(self.background(profile.characterBase.background),self.icon(profile.characterBase.icon),self.gender(profile.characterBase.gender),self.classType(profile.characterBase.classType),self.level(profile.characterBase.level),self.stats(profile.characterBase.stats),self.race(profile.characterBase.race)):(self.background(tgd.dataDir+profile.backgroundPath),self.icon(tgd.dataDir+profile.emblemPath),self.gender(tgd.DestinyGender[profile.characterBase.genderType]),self.classType(tgd.DestinyClass[profile.characterBase.classType]),self.level(profile.characterLevel),self.stats(profile.characterBase.stats),"STAT_LIGHT"in self.stats()||(self.stats().STAT_LIGHT=0),self.race(_raceDefs[profile.characterBase.raceHash].raceName))},refresh:function(profile,event){var self=this;"Vault"==self.id?self._reloadBucket(self,event):app.bungie.character(self.id,function(result){result&&result.data&&(self.updateCharacter(result.data),self._reloadBucket(self,event))})},getBucketTypeHelper:function(item,info){return"undefined"==typeof info?"":4!==item.location?tgd.DestinyBucketTypes[info.bucketTypeHash]:item.isEquipment||tgd.lostItemsHelper.indexOf(item.itemHash)>-1||4==item.location&&item.itemInstanceId>0?"Lost Items":tgd.invisibleItemsHelper.indexOf(item.itemHash)>-1?"Invisible":"Messages"},reloadBucketFilter:function(buckets){var self=this;return function(item){var info={};if(info=item.itemHash in _itemDefs?_itemDefs[item.itemHash]:{bucketTypeHash:"1498876634",itemName:"Classified",tierTypeName:"Exotic",icon:"/img/misc/missing_icon.png",itemTypeName:"Classified"},info&&info.bucketTypeHash&&info.bucketTypeHash in tgd.DestinyBucketTypes){var itemBucketType=self.getBucketTypeHelper(item,info);if(buckets.indexOf(itemBucketType)>-1)return!0}}},addItems:function(newItems,buckets){var self=this,newUniqueItems=_.filter(newItems,function(newItem){return newItem.itemInstanceId>0}),newGenericItems=_.filter(newItems,function(item){return"0"===item.itemInstanceId}),newGenericItemCounts=_.object(_.map(_.groupBy(newGenericItems,"itemHash"),function(items,hash){var info=_itemDefs[hash];return[parseInt(hash),{newQuantity:tgd.sum(_.pluck(items,"stackSize")),maxStackSize:info.maxStackSize}]})),currentItems=_.filter(self.items(),function(item){return buckets.indexOf(item.bucketType)>-1||0===buckets.length}),currentGenericItems=_.filter(currentItems,function(item){return"0"==item._id}),currentGenericItemCounts=_.object(_.map(_.groupBy(currentGenericItems,"id"),function(items,hash){return[parseInt(hash),tgd.sum(_.pluck(items,"stackSize"))]})),currentUniqueItems=_.filter(currentItems,function(item){return item._id>0});_.each(currentUniqueItems,function(item){var existingItem=_.first(_.filter(newUniqueItems,function(newItem){return newItem.itemInstanceId==item._id}));existingItem?item.updateItem(existingItem):self.items.remove(item)}),_.each(newUniqueItems,function(newItem){var foundItem=_.filter(currentUniqueItems,function(item){return newItem.itemInstanceId==item._id});if(0===foundItem.length){var processedItem=new Item(newItem,self);"id"in processedItem&&self.items.push(processedItem)}}),_.each(newGenericItemCounts,function(info,hash){var existingItems=_.filter(currentGenericItems,function(item){return item.itemHash==hash});if(existingItems.length>0){var currentQuantity=currentGenericItemCounts[hash];if(currentQuantity!=info.newQuantity){var newItem=_.findWhere(newGenericItems,{itemHash:parseInt(hash)});if(info.newQuantity<=info.maxStackSize)existingItems.length>1&&_.each(existingItems,function(item,index){index>0&&self.items.remove(item)}),existingItems[0].updateItem(newItem);else{var missingItemsAmount=Math.ceil(info.newQuantity/info.maxStackSize)-existingItems.length,remainder=info.newQuantity;_.times(missingItemsAmount,function(index){var newItm=_.clone(newItem);newItm.stackSize=remainder%info.maxStackSize>=info.maxStackSize?info.maxStackSize:remainder%info.maxStackSize,remainder-=newItm.stackSize;var processedItem=new Item(newItm,self);"id"in processedItem&&self.items.push(processedItem)}),_.each(existingItems,function(item,index){if(0>missingItemsAmount&&index+1<=Math.abs(missingItemsAmount))self.items.remove(item);else{var primaryStat=remainder-info.maxStackSize>0?info.maxStackSize:remainder;item.primaryStat(primaryStat),remainder-=primaryStat}})}}}else{var genericItemsToAdd=_.where(newGenericItems,{itemHash:parseInt(hash)});_.each(genericItemsToAdd,function(newItem){var processedItem=new Item(newItem,self);"id"in processedItem&&self.items.push(processedItem)})}}),_.each(currentGenericItems,function(item){_.has(newGenericItemCounts,item.itemHash)||self.items.remove(item)})},reloadBucketHandler:function(buckets,done){var self=this;return function(results,response){if(!(results&&results.data&&results.data.buckets))return results&&results.ErrorCode&&99==results.ErrorCode?(done(),BootstrapDialog.alert(results.Message)):(done(),app.refresh(),BootstrapDialog.alert("Code 20: "+app.activeText().error_loading_inventory+JSON.stringify(response)));var newItems=_.filter(app.bungie.flattenItemArray(results.data.buckets),self.reloadBucketFilter(buckets));self.addItems(newItems,buckets),done()}},setPane:function(pane){var self=this;return function(){return self.statsPane(pane),!1}},calculatePowerLevelWithItems:function(items){if(0===items.length)return 0;var index=_.filter(items,function(item){return"Artifact"==item.bucketType&&item.isEquipped()===!0}).length,weights=tgd.DestinyBucketWeights[index];if(weights){var eligibleGear=_.filter(items,function(item){return item.bucketType in weights}),primaryStatsGear=_.map(eligibleGear,function(item){return item.primaryStatValue()*(weights[item.bucketType]/100)}),powerLevelSum=tgd.sum(primaryStatsGear),powerLevel=Math.floor(powerLevelSum);return this.percentToNextLevel(Math.round((1e3*powerLevelSum-1e3*powerLevel)/1e3*100)),powerLevel}return 0},getCooldown:function(tier,statHash){var activeSubclass=this.itemEquipped("Subclasses").id;return 144602215===statHash?tgd.subclassesSuperA.indexOf(activeSubclass)>-1?tgd.cooldownsSuperA[tier]:tgd.cooldownsSuperB[tier]:4244567218===statHash?tgd.subclassesStrengthA.indexOf(activeSubclass)>-1?tgd.cooldownsMelee[tier]:tgd.cooldownsGrenade[tier]:1735777505===statHash?tgd.cooldownsGrenade[tier]:void 0},_equippedGear:function(){return this.activeBestSets(null),_.filter(this.items(),function(item){return item.isEquipped()})},_equippedStats:function(){return tgd.joinStats(this.equippedGear())},_equippedSP:function(){return _.filter(this.equippedStats(),function(value,stat){return _.where(tgd.DestinyArmorStats,{statName:stat}).length>0})},_sumCSP:function(){return tgd.sum(this.equippedSP())},_equippedTier:function(){var effectiveTier=tgd.sum(_.map(this.equippedSP(),function(value){return Math.floor(value/tgd.DestinySkillTier)}));return effectiveTier},_potentialTier:function(){return Math.floor(this.sumCSP()/tgd.DestinySkillTier)},_potentialCSP:function(){return tgd.sum(_.map(_.filter(this.equippedGear(),function(item){return item.armorIndex>-1}),function(item){return item.getValue("MaxLightCSP")}))},_classLetter:function(){return this.classType()[0].toUpperCase()},_uniqueName:function(){return this.level()+" "+this.race()+" "+this.gender()+" "+this.classType()},_iconBG:function(){return app.makeBackgroundUrl(this.icon(),!0)},_powerLevel:function(){return"Vault"==this.id?"":this.calculatePowerLevelWithItems(this.equippedGear())},_reloadBucket:function(model,event,callback,excludeMessage){function done(){function reallyDone(){self.reloadingBucket=!1,element&&element.removeClass("fa-spin"),excludeMessage||$.toaster({priority:"info",title:"Success",message:"Refresh completed for "+self.uniqueName(),settings:{timeout:tgd.defaults.toastTimeout}}),callback&&callback(),app.farmMode()&&app.farmItemHandler(self.items())}needsInvisibleRefresh?app.bungie.account(function(results,response){if(!(results&&results.data&&results.data.inventory&&results.data.inventory.buckets&&results.data.inventory.buckets.Invisible))return reallyDone(),app.refresh(),BootstrapDialog.alert("Code 40: "+app.activeText().error_loading_inventory+JSON.stringify(response));var invisible=results.data.inventory.buckets.Invisible;invisible.forEach(function(b){b.items.forEach(function(item){self.items.push(new Item(item,self,!0))})}),reallyDone()}):reallyDone()}var element,self=this;if(!self.reloadingBucket){excludeMessage||$.toaster({priority:"info",title:"Success",message:"Refreshing "+self.uniqueName(),settings:{timeout:tgd.defaults.toastTimeout}});var buckets=[];"string"==typeof model||model instanceof String?buckets.push(model):model instanceof tgd.Layout?buckets.push.apply(buckets,model.bucketTypes):model instanceof Profile&&(_.each(tgd.DestinyLayout,function(layout){buckets.push.apply(buckets,layout.bucketTypes)}),buckets.splice(buckets.indexOf("Invisible"),1)),self.reloadingBucket=!0,"undefined"!=typeof event&&(element=$(event.target),element.hasClass("emblem")===!1&&(element=element.parent().find(".emblem")),
element.addClass("fa-spin"));var needsInvisibleRefresh=buckets.indexOf("Invisible")>-1;"Vault"==self.id?app.bungie.vault(self.reloadBucketHandler(buckets,done)):app.bungie.inventory(self.id,self.reloadBucketHandler(buckets,done))}},_weapons:function(){return _.filter(this.items(),function(item){return item.weaponIndex>-1?item:void 0})},_armor:function(){return _.filter(this.items(),function(item){return item.armorIndex>-1&&-1==tgd.DestinyGeneralExceptions.indexOf(item.bucketType)?item:void 0})},_general:function(){return _.filter(this.items(),function(item){return(-1==item.armorIndex||tgd.DestinyGeneralExceptions.indexOf(item.bucketType)>-1)&&-1==item.weaponIndex&&"Post Master"!==item.bucketType&&"Messages"!==item.bucketType&&"Invisible"!==item.bucketType&&"Lost Items"!==item.bucketType&&"Subclasses"!==item.bucketType?item:void 0})},_invisible:function(){return _.filter(this.items(),function(item){return"Invisible"==item.bucketType?item:void 0})},_lostItems:function(){return _.filter(this.items(),function(item){return"Lost Items"==item.bucketType?item:void 0})},all:function(type){var items=_.where(this.items(),{bucketType:type}),activeSort=parseInt(app.activeSort());return 0===activeSort?items=_.sortBy(items,function(item){return[-1*item.tierType,item.type,-1*item.primaryStatValue()]}).reverse():1===activeSort?items=_.sortBy(items,function(item){return item.type}):2===activeSort?items=_.sortBy(items,function(item){return-1*item.primaryStatValue()}):3===activeSort?items=_.sortBy(items,function(item){return[item.type,-1*item.primaryStatValue()]}):4===activeSort?items=_.sortBy(items,function(item){return item.description}):5===activeSort?items=_.sortBy(items,function(item){return[-1*item.tierType,-1*item.primaryStatValue()]}).reverse():6===activeSort&&(items=_.sortBy(items,function(item){return[-1*item.tierType,-1*item.description]}).reverse()),items},getSiblingStacks:function(description){return _.where(this.items(),{description:description})},get:function(type){return _.filter(this.all(type),function(item){return item.isEquipped()===!1})},getVisible:function(type){return _.filter(this.get(type),function(item){return item.isVisible()})},itemEquipped:function(type){return _.first(_.filter(this.items(),function(item){return item.isEquipped()===!0&&item.bucketType==type}))},itemEquippedVisible:function(type){var ie=this.itemEquipped(type);return _.isEmpty(ie)?!1:ie.isVisible()},toggleStats:function(){this.statsShowing(!this.statsShowing())},queryVendorArmor:function(callback){var self=this,additionalVendors=[3902439767,2680694281,242140165,2796397637],armorVendors=_.map(_.filter(_vendorDefs,function(vendor){return[300,400,500].indexOf(vendor.summary.vendorSubcategoryHash)>-1||additionalVendors.indexOf(vendor.summary.vendorHash)>-1}),function(vendor){return vendor.hash}),armor=[],count=0,finish=function(vendorItems){if(armor=armor.concat(vendorItems),count++,count==armorVendors.length){var armorItems=_.sortBy(armor,function(item){return-1*item.getValue("MaxLightPercent")});callback(armorItems)}};_.each(armorVendors,function(vendorId){var vendorSummary=_vendorDefs[vendorId].summary;app.bungie.getVendorData(self.id,vendorId,function(response){var vendorItems=[];_.has(response.data,"vendor")&&(vendorItems=_.reduce(response.data.vendor.saleItemCategories,function(memo,categories){var armor=_.filter(_.map(categories.saleItems,function(sItem){var tgdItem=new Item(sItem.item,self);return tgdItem._id=tgdItem.instanceId=tgdItem.itemHash.toString()+vendorSummary.vendorHash,tgdItem.isVendor=!0,tgdItem.itemDescription="<strong style='color: LawnGreen;'> Available at "+vendorSummary.vendorName+"</strong> <br> "+tgdItem.itemDescription,tgdItem}),function(item){return item.armorIndex>-1&&item.getValue("Light")>=280&&(3==item.classType||_.has(tgd.DestinyClass,item.classType)&&tgd.DestinyClass[item.classType]==item.character.classType())});return memo=memo.concat(armor)},[])),finish(vendorItems)})})},queryRolls:function(items,callback){function done(){count++,items.length==count&&callback()}function getRolls(item,callback){app.bungie.getItemDetail(item.characterId(),item._id,function(detail){item.rolls=_.reduce(detail.data.statsOnNodes,function(rolls,stat,key,stats){var index=_.keys(stats).indexOf(key);return _.each(stat.currentNodeStats,function(node){_.each(rolls,function(roll,rollIndex){var key=_statDefs[node.statHash].statName;(0===index||index>0&&0===rollIndex)&&(roll[key]=(roll[key]||0)+node.value)})}),_.each(stat.nextNodeStats,function(node){_.each(rolls,function(roll,rollIndex){var key=_statDefs[node.statHash].statName;1===rollIndex&&(roll[key]=(roll[key]||0)+node.value)})}),rolls},[{},{}]),window.localStorage.setItem("rolls_"+item._id,JSON.stringify(item.rolls)),callback()})}var count=0;_.each(items,function(item){if(item.rolls)done();else{var cachedRolls=window.localStorage.getItem("rolls_"+item._id);cachedRolls?(item.rolls=JSON.parse(cachedRolls),tgd.sum(item.rolls[0])!=tgd.sum(item.stats)?getRolls(item,done):done()):1==_.keys(item.stats).length?(item.rolls=[item.stats],done()):getRolls(item,done)}})},reduceMaxSkill:function(type,buckets,items){var character=this,fullSets=[],alternatives=[];_.each(buckets,function(bucket){candidates=_.filter(items,function(item){return _.isObject(item.stats)&&item.bucketType==bucket&&item.equipRequiredLevel<=character.level()&&item.canEquip===!0&&(3!=item.classType&&tgd.DestinyClass[item.classType]==character.classType()||3===item.classType&&item.armorIndex>-1&&item.typeName.indexOf(character.classType())>-1||item.weaponIndex>-1||"Ghost"==item.bucketType)}),_.each(candidates,function(candidate){candidate.stats[type]>0?fullSets.push([candidate]):alternatives.push([candidate])})});var statAlternatives=_.flatten(fullSets);_.each(fullSets,function(set){var mainItem=set[0],currentStat=mainItem.stats[type];_.each(buckets,function(bucket){if(bucket!=mainItem.bucketType)if(currentStat<tgd.DestinySkillCap){if(candidates=_.filter(statAlternatives,function(item){return item.bucketType==bucket&&(6!=item.tierType&&6==mainItem.tierType||6!=mainItem.tierType)}),candidates.length>0){primaryStats=_.map(candidates,function(item){return item.stats[type]});var maxCandidateValue=_.max(primaryStats);maxCandidate=candidates[primaryStats.indexOf(maxCandidateValue)];var deltas={};_.each(candidates,function(candidate,index){var delta=currentStat+candidate.stats[type]-tgd.DestinySkillCap;if(delta>=0){var allStatsSummed=currentStat+candidate.getValue("All")-candidate.stats[type]-tgd.DestinySkillCap;allStatsSummed>=0&&(deltas[index]=allStatsSummed)}});var values=_.values(deltas),keys=_.keys(deltas);values.length>0&&(maxCandidate=candidates[keys[values.indexOf(_.min(values))]]),currentStat+=maxCandidate.stats[type],set.push(maxCandidate)}}else candidates=_.filter(alternatives,function(item){return item.bucketType==bucket}),candidates.length>0&&(primaryStats=_.map(candidates,function(item){return item.getValue("All")}),set.push(candidates[primaryStats.indexOf(_.max(primaryStats))]))})});var availableSets=[];_.map(fullSets,function(set){var sumSet=tgd.joinStats(set);sumSet[type]>=tgd.DestinySkillCap&&availableSets.push({set:set,sumSet:sumSet})});var sumSetValues=_.sortBy(_.map(availableSets,function(combo){var score=tgd.sum(_.map(combo.sumSet,function(value,key){var result=Math.floor(value/tgd.DestinySkillTier);return result>5?5:result}));combo.sum=tgd.sum(_.values(combo.sumSet));var subScore=combo.sum/1e3;return combo.score=score+subScore,combo}),"score"),highestSetObj=sumSetValues[sumSetValues.length-1];return[highestSetObj.sum,highestSetObj.set]},findMaxLightSet:function(items,callback){var buckets=[].concat(tgd.DestinyArmorPieces),groups={},statGroups={},highestArmorTier=0,highestArmorValue=0,highestTierValue=0,character=this;_.each(buckets,function(bucket){groups[bucket]=_.filter(items,function(item){return item.bucketType==bucket&&item.equipRequiredLevel<=character.level()&&item.canEquip===!0&&(3!=item.classType&&tgd.DestinyClass[item.classType]==character.classType()||3==item.classType&&item.armorIndex>-1&&item.typeName.indexOf(character.classType())>-1||item.weaponIndex>-1||"Ghost"==item.bucketType)});var csps=_.map(groups[bucket],function(item){return item.getValue("MaxLightCSP")});statGroups[bucket]={max:_.max(csps),min:_.min(csps)}}),highestArmorValue=tgd.sum(_.map(statGroups,function(stat){return stat.max})),highestArmorTier=Math.floor(highestArmorValue/tgd.DestinySkillTier),highestTierValue=highestArmorTier*tgd.DestinySkillTier,groups=_.object(_.map(groups,function(items,bucketType){var minCSP=highestTierValue-(highestArmorValue-statGroups[bucketType].max),newItems=_.sortBy(_.filter(items,function(item){return item.getValue("MaxLightCSP")>=minCSP}),function(item){return-1*item.getValue("MaxLightCSP")});return[bucketType,newItems]})),callback(groups)},findBestArmorSetV2:function(items,callback){var candidates,buckets=[].concat(tgd.DestinyArmorPieces),sets=[],bestSets=[],backups=[],groups={},statGroups={},highestArmorTier=0,highestArmorValue=0,highestTierValue=0,character=this,outerHighestScore=0,setsRoll0=[],setsRoll1=[],joinStats=tgd.joinStats,cartesianProductOf=tgd.cartesianProductOf;tgd.showLoading(function(){_.each(buckets,function(bucket){groups[bucket]=_.filter(items,function(item){return item.bucketType==bucket&&item.equipRequiredLevel<=character.level()&&(3!=item.classType&&tgd.DestinyClass[item.classType]==character.classType()||3==item.classType&&item.armorIndex>-1&&item.typeName.indexOf(character.classType())>-1||item.weaponIndex>-1||"Ghost"==item.bucketType)});var csps=_.map(groups[bucket],function(item){return item.getValue("All")});statGroups[bucket]={max:_.max(csps),min:_.min(csps)}}),highestArmorValue=tgd.sum(_.map(statGroups,function(stat){return stat.max})),highestArmorTier=Math.floor(highestArmorValue/tgd.DestinySkillTier),highestTierValue=highestArmorTier*tgd.DestinySkillTier,_.each(groups,function(items,bucketType){var minCSP=highestTierValue-(highestArmorValue-statGroups[bucketType].max);candidates=_.filter(items,function(item){return item.getValue("All")>=minCSP}),_.each(candidates,function(candidate){sets.push([candidate])})}),backups=_.flatten(sets);for(var i=0,len=sets.length;len>i;i++){var item=sets[i];item[0].itemNr=i;var itemClone=_.clone(item[0]);itemClone.activeRoll=item[0].rolls[0],setsRoll0.push(itemClone),itemClone=_.clone(item[0]),itemClone.activeRoll=item[0].rolls[1],setsRoll1.push(itemClone)}_.each(sets,function(set){var mainPiece=set[0],outerSubSets=[[mainPiece]],outerCandidates=_.groupBy(_.filter(backups,function(item){return item.bucketType!=mainPiece.bucketType&&(6!=item.tierType&&6==mainPiece.tierType||6!=mainPiece.tierType)&&mainPiece._id!=item._id}),"bucketType");_.each(outerCandidates,function(items){outerSubSets.push(items)});for(var products=cartesianProductOf(outerSubSets),outerCombos=[],tmpDestinySkillTier=tgd.DestinySkillTier,n=0,len2=products.length;len2>n;n++){for(var sets=products[n],minCSP=tmpDestinySkillTier*outerHighestScore,exoticItems=0,csp=0,i=0,len=sets.length;len>i;i++){var item=sets[i];6===item.tierType&&item.hasLifeExotic===!1&&exoticItems++,csp+=item.primaryValues.CSP}2>exoticItems&&csp>=minCSP&&outerCombos.push(sets)}for(var n=0,len2=outerCombos.length;len2>n;n++){for(var innerCombo=outerCombos[n],subSets=[],i=0,len=innerCombo.length;len>i;i++){var nr=innerCombo[i].itemNr;subSets[i]=new Array,subSets[i][0]=setsRoll0[nr],subSets[i][1]=setsRoll1[nr]}for(var combos=tgd.innerCartesianProductOf(subSets),scoredCombos=[],highestScore=0,i=0,len=combos.length;len>i;i++){var items=combos[i],tmp=joinStats(items),result=[];result.Intellect=Math.floor(tmp.Intellect/tmpDestinySkillTier),result.Intellect>5&&(result.Intellect=5),result.Discipline=Math.floor(tmp.Discipline/tmpDestinySkillTier),result.Discipline>5&&(result.Discipline=5),result.Strength=Math.floor(tmp.Strength/tmpDestinySkillTier),result.Strength>5&&(result.Strength=5);var sumresult=result.Intellect+result.Discipline+result.Strength,tmpscore=sumresult+(tmp.Intellect+tmp.Discipline+tmp.Strength)/1e3;scoredCombos[i]={set:items,score:tmpscore},tmpscore>highestScore&&(highestScore=tmpscore)}outerHighestScore<Math.floor(highestScore)&&(outerHighestScore=Math.floor(highestScore));for(var i=0,len=scoredCombos.length;len>i;i++){var combo=scoredCombos[i];combo.score>=outerHighestScore&&bestSets.push(combo)}}});var highestFinalScore=Math.floor(_.max(_.pluck(bestSets,"score"))),lastSets=[];_.each(bestSets,function(combo){combo.score>=highestFinalScore&&lastSets.push(combo)}),callback(_.sortBy(lastSets,"score"))})},findHighestItemsByLight:function(buckets,items){var character=this,characterId=character.id,characterClassType=character.classType(),characterLevel=character.level(),candidates=_.map(buckets,function(bucket){return _.filter(items,function(item){return item.bucketType==bucket&&item.equipRequiredLevel<=characterLevel&&item.transferStatus<2&&item.canEquip===!0&&(3!=item.classType&&tgd.DestinyClass[item.classType]==characterClassType||3==item.classType&&("Ghost"==item.bucketType||"Artifact"==item.bucketType)||item.weaponIndex>-1)})});candidates=_.map(candidates,function(group){var maxLightValues=_.reduce(group,function(memo,candidate){var location=candidate.characterId()==characterId?"local":"global",type=5==candidate.tierType?"Legendary":"Exotic";return memo[location+type]=Math.max(memo[location+type],candidate.getValue("Light")),memo},{localLegendary:0,localExotic:0,globalLegendary:0,globalExotic:0});return _.filter(group,function(candidate){var location=candidate.characterId()==characterId?"local":"global",type=5==candidate.tierType?"Legendary":"Exotic",maxLightPossible=maxLightValues[location+type];return candidate.getValue("Light")>=maxLightPossible})});for(var combos=tgd.cartesianProductOf(candidates),sortedCombos=[],n=(tgd.sum,0),len2=combos.length;len2>n;n++){for(var sets=combos[n],exoticItems=0,light=0,localCount=0,i=0,len=sets.length;len>i;i++){var item=sets[i];6===item.tierType&&item.hasLifeExotic===!1&&exoticItems++,light+=item.primaryValues.Default,item.character.id==characterId&&(localCount+=1)}2>exoticItems&&sortedCombos.push({items:sets,light:light,localCount:localCount})}var localItems=_.filter(sortedCombos,function(combo){return combo.localCount==buckets.length}),remoteItems=_.filter(sortedCombos,function(combo){return combo.localCount!==buckets.length}),absMaxLight=_.max(_.map(sortedCombos,function(combo){return combo.light})),localMaxLight=_.max(_.map(localItems,function(combo){return combo.light})),highestComboSet=_.first(_.sortBy(absMaxLight>localMaxLight?remoteItems:localItems,function(combo){return-1*combo.light})),highestSet=highestComboSet.items,highestSetValue=highestComboSet.light;return[highestSetValue,highestSet]},findHighestItemBy:function(type,buckets,items){var candidates,character=this,sets=[],backups=[],primaryStats={};_.each(buckets,function(bucket){candidates=_.filter(items,function(item){return item.bucketType==bucket&&item.equipRequiredLevel<=character.level()&&item.canEquip===!0&&(3!=item.classType&&tgd.DestinyClass[item.classType]==character.classType()||3==item.classType&&item.armorIndex>-1||item.weaponIndex>-1)&&("All"==type&&item.armorIndex>-1||"All"!=type)}),_.each(candidates,function(candidate){("Light"==type||"All"==type||"Light"!=type&&candidate.stats[type]>0)&&(6==candidate.tierType&&candidate.hasLifeExotic===!1?sets:backups)[candidate.isEquipped()?"unshift":"push"]([candidate])})}),backups=_.flatten(backups),_.each(_.groupBy(_.flatten(sets),"bucketType"),function(items,bucketType){primaryStats[bucketType]=_.max(_.map(items,function(item){return item.getValue(type)}))}),_.each(backups,function(spare){var maxCandidate=primaryStats[spare.bucketType]||0;maxCandidate<spare.getValue(type)&&sets.push([spare])}),_.each(sets,function(set){var main=set[0];_.each(buckets,function(bucket){if(bucket!=main.bucketType&&(candidates=_.where(backups,{bucketType:bucket}),candidates.length>0)){primaryStats=_.map(candidates,function(item){return item.getValue(type)});var maxCandidate=_.max(primaryStats),candidate=candidates[primaryStats.indexOf(maxCandidate)];set.push(candidate)}})});var sumSets=_.map(sets,function(set){return tgd.sum(_.map(set,function(item){return item.getValue(type)}))});return highestSetValue=_.max(sumSets),highestSet=_.sortBy(sets[sumSets.indexOf(highestSetValue)],function(item){return-1*item.tierType}),[highestSetValue,highestSet]},equipAction:function(type,highestSetValue,highestSet){var character=this;$.toaster({priority:"success",title:"Result",message:" The highest set available for "+type+"  is  "+highestSetValue,settings:{timeout:7e3}});var count=0,done=function(){if(count++,count==highestSet.length){var msa=adhoc.transfer(character.id,!0);adhoc.swapItems(msa,character.id,function(){$.toaster({settings:{timeout:7e3},priority:"success",title:"Result",message:" Completed equipping the highest "+type+" set at "+highestSetValue}),character.statsShowing(!1)})}},adhoc=new tgd.Loadout;_.each(highestSet,function(candidate){var itemEquipped=character.itemEquipped(candidate.bucketType);if(itemEquipped&&itemEquipped._id&&itemEquipped._id!==candidate._id){var message;if("Light"==type&&candidate.primaryStatValue()>itemEquipped.primaryStatValue()||"Light"!=type){var doSwap="Vault"!=character.id;doSwap&&character.get(candidate.bucketType).length>=8&&(tgd.DestinyWeaponPieces.indexOf(candidate.bucketType)>-1||"Ghost"==candidate.bucketType?doSwap=!0:"Artifact"==candidate.bucketType&&3==candidate.classType?doSwap=!0:tgd.DestinyArmorPieces.indexOf(candidate.bucketType)>-1&&tgd.DestinyClass[candidate.classType]==character.classType()&&(doSwap=!0)),adhoc.addUniqueItem({id:candidate._id,bucketType:candidate.bucketType,doEquip:!0,doSwap:doSwap}),message=candidate.bucketType+" can have a better item with "+candidate.description,$.toaster({priority:"info",title:"Equip",message:message,settings:{timeout:tgd.defaults.toastTimeout}})}done()}else done()})},renderBestGroups:function(type,groups){var character=this,armorSelection=new tgd.armorSelection(type,groups,character);tgd.activeArmorSelection=armorSelection;var defaultAction=function(dialog){var selectedCombo=_.first(armorSelection.bestSets());selectedCombo&&(armorSelection.saveSelectedCombo(selectedCombo),dialog.close())};new tgd.koDialog({templateName:"maxLightTemplates",viewModel:armorSelection,onFinish:defaultAction,buttons:[{label:app.activeText().movepopup_equip,action:function(dialog){var selectedCombo=_.first(armorSelection.bestSets());selectedCombo&&(armorSelection.equipSelectedCombo(selectedCombo),dialog.close())}},{label:app.activeText().loadouts_save,action:defaultAction},{label:app.activeText().cancel,action:function(dialog){dialog.close()}}]}).title("Armor Builds for "+type).show(!0,function(){groups=null},_.noop)},renderBestSets:function(type,bestSets){var character=this,weaponsEquipped=_.filter(character.equippedGear(),function(item){return item.weaponIndex>-1}),weaponTypes=_.map(app.weaponTypes(),function(type){return type.name.split(" ")[0]}).concat(tgd.DestinyWeaponPieces),highestTier=Math.floor(_.max(_.pluck(bestSets,"score"))),armorBuilds={},arrArmorBuilds=[],regex=new RegExp(weaponTypes.join("|"));_.each(bestSets,function(combo){if(combo.score>=highestTier){var statTiers="",statValues="",stats=tgd.joinStats(combo.set),sortedKeys=_.pluck(tgd.DestinyArmorStats,"statName");combo.stats=[],_.each(sortedKeys,function(name){statTiers=statTiers+" <strong>"+name.substring(0,3)+"</strong> T"+Math.floor(stats[name]/tgd.DestinySkillTier),statValues=statValues+stats[name]+"/",combo.stats.push(stats[name])}),combo.light=character.calculatePowerLevelWithItems(combo.set.concat(weaponsEquipped)),combo.statTiers=$.trim(statTiers),combo.statValues=statValues.substring(0,statValues.length-1),combo.statTierValues=_.map(sortedKeys,function(name){return Math.floor(stats[name]/tgd.DestinySkillTier)}).join("/"),combo.perks=_.sortBy(_.filter(_.flatten(_.map(combo.set,function(item){return _.map(item.perks,function(perk){return perk.bucketType=item.bucketType,perk})})),function(perk){return perk.active===!0&&"Class Items"!=perk.bucketType&&regex.test(perk.name)||perk.active===!0&&"Helmet"==perk.bucketType&&-1==perk.isExclusive&&perk.isInherent===!1}),"name"),combo.similarityScore=_.values(_.countBy(_.map(_.filter(combo.perks,function(perk){return"Class Items"!=perk.bucketType&&"Helmet"!=perk.bucketType}),function(perk){return _.intersection(weaponTypes,perk.name.split(" "))[0]}))),combo.similarityScore=3/combo.similarityScore.length+tgd.sum(combo.similarityScore),combo.hash=_.pluck(_.sortBy(combo.set,"bucketType"),"_id").join(","),combo.id=tgd.hashCode(combo.statTiers),combo.statTiers in armorBuilds||(armorBuilds[combo.statTiers]=[]),armorBuilds[combo.statTiers].push(combo)}}),_.each(armorBuilds,function(statTiers,key){var newTiers=_.reduce(statTiers,function(memo,combo){return _.findWhere(memo,{hash:combo.hash})||memo.push(combo),memo},[]);arrArmorBuilds.push(_.first(_.sortBy(newTiers,function(combo){return[combo.similarityScore,combo.score]}).reverse(),200))}),armorBuilds={},arrArmorBuilds=_.sortBy(arrArmorBuilds,function(builds){return-1*_.max(_.pluck(builds,"similarityScore"))});var renderTemplate=function(builds){var _template=$(tgd.armorTemplates({builds:builds}));return _template.find(".itemImage,.perkImage").bind("error",function(){tgd.imageErrorHandler(this.src.replace(location.origin,"").replace("www/",""),this)()}),_template},assignBindingHandlers=function(){$("a.itemLink").each(function(){var element=$(this),itemId=element.attr("itemId"),instanceId=element.attr("instanceId");element.click(!1),Hammer(element[0],{time:2e3}).on("tap",function(ev){$ZamTooltips.lastElement=element,$ZamTooltips.show("destinydb","items",itemId,element)}).on("press",function(ev){arrArmorBuilds=_.map(_.filter(arrArmorBuilds,function(sets){return _.filter(sets,function(combos){return _.pluck(combos.set,"_id").indexOf(instanceId)>-1}).length>0}),function(sets){return _.filter(sets,function(combos){return _.pluck(combos.set,"_id").indexOf(instanceId)>-1})}),armorTemplateDialog.content(renderTemplate(arrArmorBuilds)),setTimeout(assignBindingHandlers,10)})}),$(".prevCombo").bind("click",function(){var currentRow=$(this).parents(".row"),currentId=currentRow.attr("id"),newId=currentId.split("_")[0]+"_"+(parseInt(currentId.split("_")[1])-1);currentRow.hide(),$("#"+newId).show()}),$(".nextCombo").bind("click",function(){var currentRow=$(this).parents(".row"),currentId=currentRow.attr("id"),newId=currentId.split("_")[0]+"_"+(parseInt(currentId.split("_")[1])+1);currentRow.hide(),$("#"+newId).show()})},$template=renderTemplate(arrArmorBuilds),armorTemplateDialog=new tgd.dialog({buttons:[{label:app.activeText().movepopup_equip,action:function(dialog){if(0===$("input.armorBuild:checked").length)BootstrapDialog.alert("Error: Please select one armor build to equip.");else{var selectedBuild=$("input.armorBuild:checked").val(),selectedStatTier=selectedBuild.split("_")[0],selectedIndex=selectedBuild.split("_")[1];highestCombo=_.filter(arrArmorBuilds,function(sets){return sets[0].statTiers==selectedStatTier})[0][selectedIndex],character.equipAction(type,highestCombo.score.toFixed(3),highestCombo.set),dialog.close()}}},{label:app.activeText().loadouts_save,action:function(dialog){if(0===$("input.armorBuild:checked").length)BootstrapDialog.alert("Error: Please select one armor build to equip.");else{var selectedBuild=$("input.armorBuild:checked").val(),selectedStatTier=selectedBuild.split("_")[0],selectedIndex=selectedBuild.split("_")[1];highestCombo=_.filter(arrArmorBuilds,function(sets){return sets[0].statTiers==selectedStatTier})[0][selectedIndex],app.createLoadout(character);var loadoutName=tgd.calculateLoadoutName(highestCombo);app.activeLoadout().name(loadoutName),_.each(highestCombo.set,function(item){var bonusOn=item.bonusStatOn();item&&item.activeRoll&&item.activeRoll.bonusOn&&(bonusOn=item.activeRoll.bonusOn),app.activeLoadout().addUniqueItem({id:item._id,bucketType:item.bucketType,doEquip:!0,bonusOn:bonusOn})}),dialog.close()}}},{label:app.activeText().cancel,action:function(dialog){dialog.close()}}]}).title("Armor Build"+(arrArmorBuilds.length>1?"s":"")+" Found for Tier "+highestTier).content($template).show(!0,function(){armorBuilds=null,arrArmorBuilds=null},function(){assignBindingHandlers()})},equipBest:function(type,armor,items){var character=this,activeItems=_.filter(items,function(item){var isFiltered=item.armorIndex>-1&&item.primaryStat()>3&&item.tierType>=5&&item.isEquipment===!0,isForClass=tgd.DestinyClass[item.classType]==character.classType()||3==item.classType,isForCharacter=-1==app.globalItems().indexOf(item.bucketType)&&item.characterId()==character.id||app.globalItems().indexOf(item.bucketType)>-1;return isFiltered&&isForCharacter&&isForClass});if(tgd.weaponTypes=_.map(app.weaponTypes(),function(type){return type.name.split(" ")[0]}).concat(tgd.DestinyWeaponPieces),"OptimizedBest"==type&&(activeItems=_.reduce(_.groupBy(activeItems,"bucketType"),function(memo,group){var sortedItems=_.sortBy(group,function(item){return-1*item.getValue("All")});return memo=memo.concat(_.first(sortedItems,3))},[])),"Best"==type||"OptimizedBest"==type)character.findBestArmorSetV2(activeItems,function(sets){character.renderBestSets(type,sets)});else if("MaxLight"==type)(isMobile&&confirm("Warning: This button analyzes all of your armor requiring a lot of processing power and might make the app unresponsive, are you sure you want to continue?")||!isMobile)&&character.findMaxLightSet(activeItems,function(groups){character.renderBestGroups(type,groups)});else if("Custom"==type){var groups=_.groupBy(activeItems,"bucketType");character.renderBestGroups(type,groups)}},viewCombo:function(combo){var character=this;return function(){character.statsShowing(!1),app.createLoadout(character);var loadoutName=tgd.calculateLoadoutName(combo);app.activeLoadout().name(loadoutName),_.each(combo.set,function(item){app.activeLoadout().addUniqueItem({id:item._id,bucketType:item.bucketType,doEquip:!0,bonusOn:item.activeRoll.bonusOn})})}},optimizeGear:function(type){var character=this;return function(){tgd.showLoading(function(){var armor=_.filter(character.equippedGear(),function(item){return item.armorIndex>-1&&("Equipped"==type||"Minus Other"==type&&-1==tgd.DestinyOtherArmor.indexOf(item.bucketType))}),otherArmor=[];"Minus Other"==type&&(otherArmor=_.map(tgd.DestinyOtherArmor,function(bucketType){return _.where(character.items(),{bucketType:bucketType})}),armor=armor.concat(otherArmor));var otherArmorPieces=_.flatten(otherArmor).length;if(12>=otherArmorPieces&&isMobile||otherArmorPieces>=13&&isMobile&&confirm("Warning: There are "+otherArmorPieces+" pieces of Artifacts, Class Items and Ghosts available, this operation is processing intensive and may make the app unresponsive, would you like to conitnue?")||!isMobile){var bestSets=tgd.calculateBestSets(armor,"rolls");character.activeBestSets(bestSets)}})}},equipHighest:function(type){var character=this;return function(){if("Vault"!=character.id){var highestSet,highestSetValue,bestArmorSets,bestWeaponSets,armor=[].concat(tgd.DestinyArmorPieces),weapons=tgd.DestinyWeaponPieces,items=_.flatten(_.map(app.characters(),function(avatar){return avatar.items()}));"Best"==type||"OptimizedBest"==type||"MaxLight"==type||"Custom"==type?character.equipBest(type,armor,items):"Light"==type?(bestArmorSets=character.findHighestItemsByLight(armor,items)[1],bestWeaponSets=character.findHighestItemsByLight(weapons,items)[1],highestSet=bestArmorSets.concat(bestWeaponSets),highestSetValue=character.calculatePowerLevelWithItems(highestSet),character.equipAction(type,highestSetValue,highestSet)):"All"==type?(bestArmorSets=character.findHighestItemBy("All",armor,items),highestSet=bestArmorSets[1],highestSetValue=bestArmorSets[0],character.equipAction(type,highestSetValue,highestSet)):(bestArmorSets=character.findHighestItemBy(type,armor,items),bestArmorSets[0]<tgd.DestinySkillCap?(highestSetValue=bestArmorSets[0],highestSet=bestArmorSets[1]):(bestArmorSets=character.reduceMaxSkill(type,armor,items),highestSetValue=bestArmorSets[0],highestSet=bestArmorSets[1]),character.equipAction(type,highestSetValue,highestSet))}}}},window.Hammer.Tap.prototype.defaults.threshold=9;var app=function(){var self=this;this.loadingUser=ko.observable(!1),this.hiddenWindowOpen=ko.observable(!1),this.loadoutMode=ko.observable(!1),this.destinyDbMode=ko.observable(!1),this.dynamicMode=ko.observable(!1),this.viewOptionsEnabled=ko.observable(!1),this.minAvgPercentNeeded=ko.observable(96.15),this.activeLoadout=ko.observable(new tgd.Loadout),this.loadouts=ko.observableArray(),this.searchKeyword=ko.observable(tgd.defaults.searchKeyword),this.preferredSystem=ko.pureComputed(new tgd.StoreObj("preferredSystem")),this.appLocale=ko.pureComputed(new tgd.StoreObj("appLocale")),this.locale=ko.pureComputed(new tgd.StoreObj("locale")),this.layoutMode=ko.pureComputed(new tgd.StoreObj("layoutMode")),this.ccWidth=ko.pureComputed(new tgd.StoreObj("ccWidth")),this.vaultColumns=ko.pureComputed(new tgd.StoreObj("vaultColumns")),this.vaultWidth=ko.pureComputed(new tgd.StoreObj("vaultWidth")),this.vaultPos=ko.pureComputed(new tgd.StoreObj("vaultPos")),this.xsColumn=ko.pureComputed(new tgd.StoreObj("xsColumn")),this.smColumn=ko.pureComputed(new tgd.StoreObj("smColumn")),this.mdColumn=ko.pureComputed(new tgd.StoreObj("mdColumn")),this.lgColumn=ko.pureComputed(new tgd.StoreObj("lgColumn")),this.activeView=ko.pureComputed(new tgd.StoreObj("activeView")),this.activeSort=ko.pureComputed(new tgd.StoreObj("activeSort")),this.autoUpdates=ko.pureComputed(new tgd.StoreObj("autoUpdates","true")),this.doRefresh=ko.pureComputed(new tgd.StoreObj("doRefresh","true")),this.autoXferStacks=ko.pureComputed(new tgd.StoreObj("autoXferStacks","true")),this.padBucketHeight=ko.pureComputed(new tgd.StoreObj("padBucketHeight","true")),this.dragAndDrop=ko.pureComputed(new tgd.StoreObj("dragAndDrop","true")),this.farmViewEnabled=ko.pureComputed(new tgd.StoreObj("farmViewEnabled","true")),this.farmMode=ko.pureComputed(new tgd.StoreObj("farmMode","true")),this.farmTarget=ko.pureComputed(new tgd.StoreObj("farmTarget")),this.farmItems=ko.observableArray(),this.globalItems=ko.observableArray(),this.farmItemCounts=ko.observable({}),this.advancedTooltips=ko.pureComputed(new tgd.StoreObj("advancedTooltips","true")),this.sectionsTemplate=ko.pureComputed(new tgd.StoreObj("sectionsTemplate")),this.tooltipsEnabled=ko.pureComputed(new tgd.StoreObj("tooltipsEnabled","true",function(newValue){$ZamTooltips.isEnabled=newValue})),this.refreshSeconds=ko.pureComputed(new tgd.StoreObj("refreshSeconds")),this.tierFilter=ko.pureComputed(new tgd.StoreObj("tierFilter")),this.weaponFilter=ko.observable(tgd.defaults.weaponFilter),this.armorFilter=ko.observable(tgd.defaults.armorFilter),this.generalFilter=ko.observable(tgd.defaults.generalFilter),this.progressFilter=ko.observable(tgd.defaults.progressFilter),this.setFilter=ko.observableArray(_.clone(tgd.defaults.setFilter)),this.dmgFilter=ko.observableArray(_.clone(tgd.defaults.dmgFilter)),this.activeClasses=ko.observableArray(_.clone(tgd.defaults.activeClasses)),this.activeStats=ko.observableArray(_.clone(tgd.defaults.activeStats)),this.shareView=ko.observable(tgd.defaults.shareView),this.shareUrl=ko.observable(tgd.defaults.shareUrl),this.showMissing=ko.observable(tgd.defaults.showMissing),this.customFilter=ko.observable(tgd.defaults.customFilter),this.showDuplicate=ko.observable(tgd.defaults.showDuplicate),this.showArmorSC=ko.observable(tgd.defaults.showArmorSC),this.showArmorPerks=ko.observable(tgd.defaults.showArmorPerks),this.armorViewBy=ko.observable(tgd.defaults.armorViewBy),this.lockedState=ko.observable(""),this.activeItem=ko.observable(),this.activeUser=ko.observable({}),this.allLayouts=ko.observableArray().extend({rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}}),this.tierTypes=ko.observableArray(),this.weaponTypes=ko.observableArray(),this.characters=ko.observableArray().extend({
rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}}),this.orderedCharacters=ko.pureComputed(function(){return self.characters().sort(function(a,b){return a.order()-b.order()})}),this.currentLocale=ko.computed(function(){var locale=self.locale();return""!==self.appLocale()&&(locale=self.appLocale()),locale=_.findWhere(tgd.languages,{bungie_code:locale}).code||locale}),this.activeText=ko.pureComputed(function(){return tgd.locale[self.currentLocale()]}),this.localLoadouts=ko.computed(function(){return _.filter(self.loadouts(),function(loadout){return _.isEmpty(loadout.characterId())||_.isUndefined(loadout.characterId())})}),this.manageLoadouts=function(){var loadoutManager=new tgd.loadoutManager(self.loadouts);new tgd.koDialog({templateName:"manageLoadoutsTemplate",viewModel:loadoutManager,buttons:[{label:app.activeText().loadouts_save,action:function(dialog){confirm("Are you sure you want to save your changes?")&&(self.saveLoadouts(!0),dialog.close())}},{label:app.activeText().cancel,action:function(dialog){dialog.close()}}]}).title(self.activeText().menu_loadouts_manage+" Loadouts").show(!0)},this.createLoadout=function(character){self.loadoutMode(!0),self.activeLoadout(new tgd.Loadout([],!1,character))},this.cancelLoadout=function(){self.loadoutMode(!1),self.dynamicMode(!1),self.activeLoadout(new tgd.Loadout)},this.startMultiSelect=function(){self.dynamicMode(!0),self.createLoadout()},this.showFarmHelp=function(){(new tgd.dialog).title(self.activeText().menu_help+" for Farm Mode").content(tgd.farmhelpTemplate()).show()},this.showHelp=function(){self.toggleBootstrapMenu(),(new tgd.dialog).title(self.activeText().menu_help).content(tgd.helpTemplate()).show(!0)},this.showSettings=function(){self.toggleBootstrapMenu();var settingsManager=new tgd.settingsManager({doRefresh:self.doRefresh,currentLocale:self.currentLocale,appLocale:self.appLocale,refreshSeconds:self.refreshSeconds,tooltipsEnabled:self.tooltipsEnabled,advancedTooltips:self.advancedTooltips,autoXferStacks:self.autoXferStacks,padBucketHeight:self.padBucketHeight,dragAndDrop:self.dragAndDrop,farmViewEnabled:self.farmViewEnabled,autoUpdates:self.autoUpdates,activeText:self.activeText});new tgd.koDialog({viewModel:settingsManager,templateName:"settingsTemplate",buttons:[{label:self.activeText().close_msg,action:function(dialogItself){dialogItself.close()}}]}).title(self.activeText().menu_settings).show(!0)},this.handleGoogleResponse=function(data){data&&data.response?data.response.errorType?BootstrapDialog.alert("Error: "+data.response.errorType):data.response.orderId?BootstrapDialog.alert("Donation accepted Ref# "+data.response.orderId):BootstrapDialog.alert("Unknown error has occurred"):BootstrapDialog.alert("No response returned")},this.showDonate=function(){self.toggleBootstrapMenu(),(new tgd.dialog).title(self.activeText().donation_title).content(tgd.donateTemplate()).show(!0,_.noop,function(){$("a.donatePaypal").click(function(){return window.open("https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=XGW27FTAXSY62&lc="+self.activeText().paypal_code+"&no_note=1&no_shipping=1&currency_code=USD",tgd.openTabAs),!1}),$("div.supportsIAB").toggle(isChrome===!0||isAndroid===!0||isIOS===!0),$("div.chromeWallet").toggle(isChrome===!0),$("div.googlePlay").toggle(isAndroid===!0),$("div.appleIAP").toggle(isIOS===!0),$("a.donate").bind("click",function(){isChrome&&!isNWJS?google.payments.inapp.buy({parameters:{env:"prod"},sku:$(this).attr("sku"),success:self.handleGoogleResponse,failure:self.handleGoogleResponse}):(isAndroid||isIOS)&&inappbilling.buy(function(){BootstrapDialog.alert("Donation accepted, thank you for your support")},_.noop,$(this).attr("sku"))})})},this.showAbout=function(){self.toggleBootstrapMenu(),(new tgd.dialog).title(self.activeText().menu_about).content(tgd.aboutTemplate()).show()},this.clearFilters=function(model,element){return self.toggleBootstrapMenu(),self.activeView(tgd.defaults.activeView),self.searchKeyword(tgd.defaults.searchKeyword),self.refreshSeconds(tgd.defaults.refreshSeconds),self.tierFilter(tgd.defaults.tierFilter),self.weaponFilter(tgd.defaults.weaponFilter),self.armorFilter(tgd.defaults.armorFilter),self.generalFilter(tgd.defaults.generalFilter),self.activeStats(_.clone(tgd.defaults.activeStats)),self.activeClasses(_.clone(tgd.defaults.activeClasses)),self.dmgFilter(_.clone(tgd.defaults.dmgFilter)),self.setFilter(_.clone(tgd.defaults.setFilter)),self.progressFilter(tgd.defaults.progressFilter),self.shareView(tgd.defaults.shareView),self.shareUrl(tgd.defaults.shareUrl),self.showMissing(tgd.defaults.showMissing),self.showDuplicate(tgd.defaults.showDuplicate),self.customFilter(tgd.defaults.customFilter),self.showArmorPerks(tgd.defaults.showArmorPerks),self.armorViewBy(tgd.defaults.armorViewBy),$(element.target).removeClass("active"),self.redraw(),!1},this.renderCallback=function(context,content,element,callback){element&&(lastElement=element),content=content.replace(/(<img\ssrc=")(.*?)("\s?>)/g,"");var activeItem,query,instanceId=$(lastElement).attr("instanceId"),$content=$("<div>"+content+"</div>");if(instanceId>0)query={_id:instanceId};else{var id=$(lastElement).attr("href");query={id:parseInt(id.split("/")[id.split("/").length-1])}}if(self.characters().forEach(function(character){var item=_.findWhere(character.items(),query);item&&(activeItem=item)}),!activeItem&&tgd&&tgd.activeArmorSelection&&(activeItem=_.reduce(tgd.activeArmorSelection.armorGroups(),function(memo,group){var item=_.findWhere(group.items(),query);return item&&(memo=item),memo},void 0)),activeItem){if($content.find("h2.destt-has-icon").text(activeItem.description),tgd.DestinyGeneralItems["Glimmer Credit"].indexOf(activeItem.id)>-1&&$content.find("div.destt-info span").after(" valued at "+200*activeItem.primaryStat()+"G"),activeItem.equipRequiredLevel){var classType=3==activeItem.classType?"":" for  "+tgd.DestinyClass[activeItem.classType];$content.find(".destt-required-level").remove(),$content.find(".destt-title").after('<span class="destt-info" style="float:right;">Required Level: <span>'+activeItem.equipRequiredLevel+classType+"</span></span>")}$content.find("h3.destt-has-icon").text(activeItem.typeName);var primaryStatMin=$content.find(".destt-primary-min");if(0===primaryStatMin.length&&(activeItem.armorIndex>-1||activeItem.weaponIndex>-1)&&""!==activeItem.primaryStat()){var statType=activeItem.armorIndex>-1?"DEFENSE":"ATTACK",statBlock='<div class="destt-primary"><div class="destt-primary-min">'+activeItem.primaryStat()+'</div><div class="destt-primary-max destt-primary-no-max">'+statType+"</div></div>";$content.find(".destt-desc").before(statBlock)}else primaryStatMin.html(activeItem.primaryStat());if($content.find(".destt-desc").html(activeItem.itemDescription),$content.find(".fhtt-emblem").length>0&&$content.find("span").remove(),$content.find(".fhtt-emblem-icon").length>0&&$content.find(".fhtt-emblem-icon").html($("<img>").attr("src",activeItem.icon)),0===$content.find("[class*='destt-damage-color-']").length&&activeItem.damageType>1){var burnIcon=$("<div></div>").addClass("destt-primary-damage-"+activeItem.damageType);$content.find(".destt-primary").addClass("destt-damage-color-"+activeItem.damageType).prepend(burnIcon)}if(!_.isEmpty(activeItem.stats)){var itemStats,stats=$content.find(".destt-stat"),statKeys=0===activeItem.statPerks.length?_.keys(activeItem.stats):_.pluck(activeItem.futureRolls,"bonusOn"),statValues={stats:_.clone(activeItem.stats),armorIndex:activeItem.armorIndex,statPerks:activeItem.statPerks,primaryValues:activeItem.primaryValues,futureRolls:activeItem.futureRolls,rolls:activeItem.rolls,bonusStatOn:activeItem.bonusStatOn(),keys:statKeys,maxCSP:tgd.DestinyMaxCSP[activeItem.bucketType],extraStats:[]},itemDef=_itemDefs[activeItem.id];if(itemDef&&itemDef.stats&&(itemStats=_.map(itemDef.stats,function(obj,key){return obj.name=_statDefs[key].statName,obj})),activeItem.weaponIndex>-1)statValues.keys=statValues.keys.concat(["Aim assistance","Equip Speed","Recoil direction","Inventory Size"]),_.each(statValues.keys,function(statName){var statObj=_.findWhere(itemStats,{name:statName});if(statObj){var label=statObj.name;"Recoil direction"==statName?label="Recoil":"Aim assistance"==statName?label="Aim Assist":"Inventory Size"==statName&&(label="Inventory"),statValues.stats[label]={base:statObj.value,value:statObj.value},_.has(activeItem.stats,statObj.name)&&(statValues.stats[label].value=activeItem.stats[statObj.name]),statObj.minimum>0&&statObj.maximum>0&&(statValues.stats[label].minMax=statObj.minimum+"/"+statObj.maximum)}});else if(activeItem.armorIndex>-1){if(3==activeItem.primaryStat())statValues.extraStats=[{label:"Stat Roll",value:_.pluck(activeItem.rolls,"bonusOn").join(", ")}];else{var isItemLeveled=activeItem.hasUnlockedStats,itemCSP=activeItem.primaryValues.CSP,currentBonusPoints=activeItem.primaryValues.currentBonus,maxBonusPoints=activeItem.primaryValues.maxLightBonus;isItemLeveled||(itemCSP=itemCSP+"<span class='font-smaller-2'>("+(itemCSP+currentBonusPoints)+")</span>");var qualityValues,qualityDetails,maxStatRoll=tgd.DestinyMaxCSP[activeItem.bucketType],maxBaseCSP=maxStatRoll-maxBonusPoints,futureMaxCSP=activeItem.primaryValues.predictedCSP.slice(0),statsDetails=itemCSP+" out of "+maxStatRoll,qualityPercentage=activeItem.maxLightPercent();if(1==futureMaxCSP.length){futureMaxCSP=futureMaxCSP[0];var futureBaseCSP=futureMaxCSP-maxBonusPoints;activeItem.tierType>=5&&futureMaxCSP!=itemCSP&&statValues.extraStats.push({label:"Infusible&nbsp;to",value:_.template("<%- futureMaxCSP %> out of <%- maxStatRoll %>")({futureMaxCSP:futureMaxCSP,maxStatRoll:maxStatRoll})}),qualityValues={percent:qualityPercentage,futureBaseCSP:futureBaseCSP,maxBaseCSP:maxBaseCSP}}else{if(futureMaxCSP=futureMaxCSP.reverse(),activeItem.tierType>=5){var extraRowDetails=_.template("<%- futureMaxCSP %> out of <%- maxStatRoll %>")({futureMaxCSP:futureMaxCSP.join("-"),maxStatRoll:maxStatRoll});statValues.extraStats.push({label:"Infusible&nbsp;to",value:extraRowDetails})}var futureBaseCSPs=_.map(futureMaxCSP,function(csp){return csp-maxBonusPoints}),maxLightPercents=_.uniq(_.map(futureBaseCSPs,function(fbc){return Math.round(fbc/maxBaseCSP*100)}));qualityValues={percent:1==maxLightPercents.length?qualityPercentage:maxLightPercents.join("-"),futureBaseCSP:futureBaseCSPs.join("-"),maxBaseCSP:maxBaseCSP}}statValues.extraStats.push({label:"Stats Total",value:statsDetails}),activeItem.tierType>=5&&activeItem.statPerks.length>0&&(qualityDetails=_.template("<%- percent %>% <span class='font-smaller-2'>(<%- futureBaseCSP %> out of <%- maxBaseCSP %>)</span>")(qualityValues),statValues.extraStats.push({label:"Quality",value:qualityDetails,className:activeItem.tierType>=5?activeItem.cspClass()+"Text":""}))}}var statsTemplate=tgd.statsTemplate(statValues);0===stats.length?($content.find(".destt-desc").after(statsTemplate),stats=$content.find(".destt-stat")):stats.html(statsTemplate)}if(activeItem.perks.length>0){var activePerksTemplate=tgd.perksTemplate({perks:_.filter(activeItem.perks,function(perk){var hasStat=_.has(perk,"isStat");return(perk.active===!0&&hasStat===!1||perk.active===!1&&self.advancedTooltips()===!0&&hasStat===!1||hasStat===!0&&perk.isStat===!1)&&perk.isVisible===!0})}),weaponTypes=_.pluck(app.weaponTypes(),"name");weaponTypes.indexOf(activeItem.typeName)>-1?1==$content.find(".destt-talent").length&&$content.find(".destt-talent-description").text().indexOf("Year 1")?$content.find(".destt-talent").replaceWith(activePerksTemplate):0===$content.find(".destt-talent").length&&$content.find(".destt-stat").after(activePerksTemplate):activeItem.armorIndex>-1&&($content.find(".destt-talent").length>0?$content.find(".destt-talent").replaceWith(activePerksTemplate):$content.find(".destt-stat").after(activePerksTemplate)),$content.find("img").bind("error",function(){var perkName=$(this).attr("data-name"),src=_.findWhere(activeItem.perks,{name:perkName}).iconPath,element=$('img[data-name="'+perkName+'"]')[0];tgd.imageErrorHandler(src,element)()})}activeItem.objectives&&activeItem.objectives.length>0&&_.each(activeItem.objectives,function(objective){var info=_objectiveDefs[objective.objectiveHash],label="",value=0;info&&info.displayDescription&&(label="<strong>"+info.displayDescription+"</strong>:"),info&&info.completionValue&&(value=Math.floor(objective.progress/info.completionValue*100)+"% ("+objective.progress+"/"+info.completionValue+")"),$content.find(".destt-desc").after(label+value+"<br>")})}var width=$(window).width();340>width&&($content.find(".fhtt.des").css("width",width-15+"px"),$content.find(".stat-bar-empty").addClass("mobile")),callback($content.html())},this.toggleViewOptions=function(){self.toggleBootstrapMenu(),self.viewOptionsEnabled(!self.viewOptionsEnabled()),self.viewOptionsEnabled()?($(".character").css("margin","auto"),$(".character-box").css("position","relative")):($(".character").css("margin",""),$(".character-box").css("position","fixed"))},this.toggleRefresh=function(){self.toggleBootstrapMenu(),self.doRefresh(!self.doRefresh())},this.togglePadBucketHeight=function(){self.toggleBootstrapMenu(),self.padBucketHeight(!self.padBucketHeight()),self.redraw()},this.toggleDragAndDrop=function(){self.toggleBootstrapMenu(),self.dragAndDrop(!self.dragAndDrop()),self.dragAndDrop()===!0&&(self.padBucketHeight(!0),location.reload())},this.toggleFarmMode=function(){self.farmViewEnabled(!self.farmViewEnabled())},this.toggleTransferStacks=function(){self.toggleBootstrapMenu(),self.autoXferStacks(!self.autoXferStacks())},this.toggleDestinyDbMode=function(){self.toggleBootstrapMenu(),self.destinyDbMode(!self.destinyDbMode())},this.toggleDestinyDbTooltips=function(){self.toggleBootstrapMenu(),self.tooltipsEnabled(!self.tooltipsEnabled())},this.toggleAdvancedTooltips=function(){self.toggleBootstrapMenu(),self.advancedTooltips(!self.advancedTooltips())},this.toggleShareView=function(){if(self.toggleBootstrapMenu(),!self.shareView()){var username=self.preferredSystem().toLowerCase()+"/"+self.bungie.gamertag();self.shareUrl(tgd.remoteServer+"/share/?"+username),self.apiRequest({action:"save_inventory",username:username,data:self.generateStatic()},function(){self.shareView(!self.shareView())})}},this.toggleDuplicates=function(model,event){if(self.toggleBootstrapMenu(),self.showDuplicate(!self.showDuplicate()),self.customFilter(self.showDuplicate()),self.showDuplicate()){var items=_.flatten(_.map(self.characters(),function(avatar){return avatar.items()})),ids=_.pluck(items,"id");_.each(items,function(item){var itemCount=_.filter(ids,function(id){return id==item.id}).length;item.isFiltered(itemCount>1)})}},this.toggleArmorPerks=function(){self.toggleBootstrapMenu(),self.showArmorPerks(!self.showArmorPerks()),self.customFilter(self.showArmorPerks()),self.showArmorPerks()&&(self.activeView(2),_.each(self.characters(),function(character){var weaponsEquipped=_.filter(character.weapons(),function(item){return item.isEquipped()}),weaponTypes=_.map(weaponsEquipped,function(item){return item&&item.typeName&&item.typeName.split(" ")[0]});_.each(character.armor(),function(item){var itemPerks=_.pluck(item.perks,"name"),matches=_.filter(itemPerks,function(perk){return _.filter(perk.split(" "),function(name){return weaponTypes.indexOf(name)>-1}).length>0});item.isFiltered(matches.length>0)})}))},this.toggleArmorSC=function(){self.toggleBootstrapMenu(),self.showArmorSC(!self.showArmorSC()),self.customFilter(self.showArmorSC()),self.showArmorSC()&&(self.activeView(2),_.each(self.characters(),function(character){var damagedBasedSubclass=_.filter(character.items(),function(item){return item.bucketType.indexOf("Subclasses")>-1&&item.isEquipped()===!0});damagedBasedSubclass.length>0&&(damagedBasedSubclass=damagedBasedSubclass[0].damageTypeName,_.each(character.armor(),function(item){var itemPerks=_.pluck(item.perks,"name"),matches=_.filter(itemPerks,function(perk){return _.filter(perk.split(" "),function(name){return damagedBasedSubclass.indexOf(name)>-1}).length>0});item.isFiltered(matches.length>0)}))}))},this.toggleArmorClass=function(){var classType=this.toString();if(self.toggleBootstrapMenu(),self.activeClasses[-1==self.activeClasses().indexOf(classType)?"push":"remove"](classType),self.customFilter(self.activeClasses().length>0),self.customFilter()){self.activeView(2);var classTypeNums=_.map(self.activeClasses(),function(className){return _.values(tgd.DestinyClass).indexOf(className)});_.each(self.characters(),function(character){_.each(character.armor(),function(item){item.isFiltered(classTypeNums.indexOf(item.classType)>-1)})})}},this.toggleArmorStat=function(){var statType=this.toString();if(self.toggleBootstrapMenu(),self.activeStats[-1==self.activeStats().indexOf(statType)?"push":"remove"](statType),self.customFilter(self.activeStats().length>0),self.customFilter()){self.activeView(2);var activeStats=self.activeStats();_.each(self.characters(),function(character){_.each(character.items(),function(armor){if(armor.armorIndex>-1){var itemStats=_.reduce(armor.stats,function(memo,stat,name){return stat>0&&memo.push(name),memo},[]),hasStats=2==activeStats.length?2==_.intersection(itemStats,activeStats).length:_.intersection(itemStats,activeStats).length>0;armor.isFiltered(hasStats)}})})}},this.showArmorStat=function(statType){return self.activeStats().indexOf(statType)>-1},this.showArmorClass=function(classType){return self.activeClasses().indexOf(classType)>-1},this.toggleShowMissing=function(){self.toggleBootstrapMenu(),0===self.setFilter().length?$.toaster({priority:"danger",title:"Warning",message:self.activeText().pick_a_set,settings:{timeout:tgd.defaults.toastTimeout}}):self.showMissing(!self.showMissing())},this.openStatusReport=function(type){return function(){self.toggleBootstrapMenu();var sReportURL,prefSystem=self.preferredSystem().toLowerCase(),info=self.bungie.systemIds[prefSystem];return 1===type?sReportURL="http://destinystatus.com/"+prefSystem+"/"+info.id:2===type?sReportURL="http://my.destinytrialsreport.com/"+("xbl"==prefSystem?"xbox":"ps")+"/"+info.id:3===type?sReportURL="http://destinytracker.com/destiny/player/"+("xbl"==prefSystem?"xbox":"ps")+"/"+info.id:4===type?sReportURL="http://guardian.gg/en/profile/"+info.type+"/"+info.id:5===type&&(sReportURL="http://towerghostfordestiny.com/index.php/tower-vendor-rolls/"),window.open(sReportURL,tgd.openTabAs),!1}},this.setArmorView=function(){var type=this.toString();self.armorViewBy(type)},this.setVaultColumns=function(){var columns=this.toString();self.vaultColumns(columns),self.redraw()},this.setVaultWidth=function(){var width=this.toString();self.vaultWidth(width),self.redraw()},this.setCCWidth=function(model,evt){var width=$(evt.target).text();width="Default"==width?"":width,self.ccWidth(width),self.redraw()},this._setSetFilter=function(collection){self.toggleBootstrapMenu(),collection in _collections||"All"==collection?(("Year 2 Items"==collection||"Year 1 Items"==collection)&&(_collections[collection]=_.pluck(_.filter(_.flatten(_.map(self.characters(),function(character){return character.items()})),function(item){return"Year 2 Items"==collection?item.primaryStatValue()>tgd.DestinyY1Cap||_collections[collection].indexOf(item.id)>-1:item.primaryStatValue()<=tgd.DestinyY1Cap&&-1==_collections["Year 2 Items"].indexOf(item.id)}),"id")),self.setFilter("All"==collection?[]:_collections[collection]),"All"==collection?self.showMissing(!1):collection.indexOf("Weapons")>-1?(self.activeView(1),self.armorFilter(0),self.generalFilter(0)):collection.indexOf("Armor")>-1&&(self.activeView(2),self.weaponFilter(0),self.generalFilter(0))):(self.setFilter([]),self.showMissing(!1))},this.setSetFilter=function(collection){return this._setSetFilter},this.setViewFormat=function(model,event){self.toggleBootstrapMenu(),self.sectionsTemplate($(event.target).closest("li").attr("value"))},this.setSort=function(model,event){self.toggleBootstrapMenu(),self.activeSort($(event.target).closest("li").attr("value"))},this.setView=function(model,event){self.toggleBootstrapMenu(),self.activeView($(event.target).closest("li").attr("value"))},this.setDmgFilter=function(){self.toggleBootstrapMenu();var dmgType=this.toString();-1==self.dmgFilter.indexOf(dmgType)?self.dmgFilter.push(dmgType):self.dmgFilter.remove(dmgType)},this.setTierFilter=function(){var tier=this.toString();self.toggleBootstrapMenu(),self.tierFilter(tier)},this.setWeaponFilter=function(weaponType){return function(){self.toggleBootstrapMenu(),self.activeView(1);var type=weaponType.name;self.weaponFilter(type)}},this._setArmorFilter=function(){self.toggleBootstrapMenu(),self.activeView(2);var armorType=this;self.armorFilter(armorType)},this.setArmorFilter=function(armorType){return this._setArmorFilter.bind(armorType)},this.setLockState=function(){var state=this.toString();""!=self.lockedState()&&self.lockedState()==state&&(state=""),self.lockedState(state)},this.setGeneralFilter=function(){var searchType=this.toString();self.toggleBootstrapMenu(),"Engrams"!=searchType&&self.activeView(3),self.generalFilter(searchType)},this.setProgressFilter=function(model,event){self.toggleBootstrapMenu(),self.progressFilter($(event.target).closest("li").attr("value"))},this.missingSets=ko.pureComputed(function(){var allItemNames=_.pluck(_.flatten(_.map(self.characters(),function(character){return character.items()})),"description"),armorFilter=ko.unwrap(self.armorFilter),weaponFilter=ko.unwrap(self.weaponFilter),missingIds=_.filter(self.setFilter(),function(id){var isMissing=!0,isVisible=!1;if(id in _itemDefs){var info=_itemDefs[id],description=decodeURIComponent(info.itemName);if(isMissing=-1==allItemNames.indexOf(description),info.bucketTypeHash in tgd.DestinyBucketTypes){var bucketType=tgd.DestinyBucketTypes[info.bucketTypeHash],typeName=decodeURIComponent(info.itemTypeName);isVisible=!(0!==self.armorFilter()&&armorFilter!=bucketType||0!==self.weaponFilter()&&weaponFilter!=typeName)}}return isMissing&&isVisible});return missingIds}),this.addWeaponTypes=function(weapons){weapons.forEach(function(item){item.isEquipment===!0&&item.type>1&&0===_.where(self.weaponTypes(),{name:item.typeName}).length&&self.weaponTypes.push({name:item.typeName,type:item.type})})},this.addTierTypes=function(items){items.forEach(function(item){item.tierTypeName&&item.tierType>0&&0===_.where(self.tierTypes(),{name:item.tierTypeName}).length&&self.tierTypes.push({name:item.tierTypeName,tier:item.tierType})})},this.makeBackgroundUrl=function(path,excludeDomain){return'url("'+(excludeDomain?"":self.bungie.getUrl())+path+'")'},this.hasBothAccounts=function(){return!_.isEmpty(self.activeUser().psnId)&&!_.isEmpty(self.activeUser().gamerTag)},this.useXboxAccount=function(){self.toggleBootstrapMenu(),self.preferredSystem("XBL"),self.characters.removeAll(),self.loadingUser(!0),self.search()},this.usePlaystationAccount=function(){self.toggleBootstrapMenu(),self.preferredSystem("PSN"),self.characters.removeAll(),self.loadingUser(!0),self.search()},this.redraw=function(){setTimeout(self.bucketSizeHandler,1e3),setTimeout(self.quickIconHighlighter,1e3)};var loadingData=!1;this.search=function(){function done(profile){profiles.push(profile),count++,count==total&&(self.characters(profiles),self.tierTypes.sort(function(a,b){return a.tier-b.tier}),self.weaponTypes.sort(function(a,b){return a.name>b.name?1:a.name<b.name?-1:0}),loadingData=!1,self.loadingUser(!1),$ZamTooltips.init(),setTimeout(function(){self.loadLoadouts()},1e4),self.farmModeHandler(self.farmMode()))}if("user"in self.activeUser()&&loadingData!==!0){loadingData=!0;var total=0,count=0,profiles=[];self.bungie.search(self.preferredSystem(),function(e){if(e&&e.error||!e)return loadingData=!1,self.loadingUser(!1),self.preferredSystem("PSN"==self.preferredSystem()?"XBL":"PSN"),void self.search();if("undefined"==typeof e.data)return e&&"undefined"!=typeof e.Message?BootstrapDialog.alert(e.Message):BootstrapDialog.alert("Code 10: "+self.activeText().error_loading_inventory+JSON.stringify(e));var avatars=e.data.characters,characterIds=_.sortBy(_.map(avatars,function(character){return character.characterBase.characterId})),items=self.bungie.flattenItemArray(e.data.inventory.buckets),vaultItems=_.where(items,function(item){return"Invisible"!=item.bucketName}),globalItems=_.where(items,{bucketName:"Invisible"});_.each(avatars,function(avatar){avatar.index=characterIds.indexOf(avatar.characterBase.characterId)+1,avatar.items=globalItems}),avatars.push({characterBase:{characterId:"Vault"},items:vaultItems,index:parseInt(self.vaultPos())}),total=avatars.length,_.map(avatars,function(avatar){var profile=new Profile(avatar);done(profile)})})}},this.loadData=function(ref){(self.loadingUser()===!1||self.hiddenWindowOpen()===!0)&&(self.loadingUser(!0),self.bungie=new tgd.bungie(self.bungie_cookies,function(){self.characters.removeAll(),self.bungie.user(function(user){return user.error?"network error:502"==user.error?self.logout():void(isMobile?self.hiddenWindowOpen()===!1?(self.hiddenWindowOpen(!0),self.openHiddenBungieWindow()):(self.activeUser(user),self.loadingUser(!1),self.hiddenWindowOpen(!1),window.localStorage.setItem("bungie_cookies","")):(self.activeUser(user),self.loadingUser(!1))):(ref&&ref.close&&(ref.close(),self.hiddenWindowOpen(!1),ref=null),self.activeUser(user),user.psnId&&user.gamerTag&&($.toaster({settings:{timeout:1e4},priority:"info",title:"Info",message:"Currently using "+self.preferredSystem()+", <br><a href='' id='useOtherAccount'>click here to use "+("XBL"==self.preferredSystem()?"PSN":"XBL")+"</a>"}),$("#useOtherAccount").click(function(){"XBL"==self.preferredSystem()?self.usePlaystationAccount():self.useXboxAccount()})),self.locale(self.activeUser().user.locale),self.loadingUser(!1),void _.defer(function(){self.search()}))})}))},this.toggleBootstrapMenu=function(){$(".navbar-toggle").hasClass("collapsed")===!1&&$(".navbar-toggle").click()},this.refreshButton=function(){self.toggleBootstrapMenu(),self.refresh()},this.logout=function(){self.clearCookies(),self.bungie.logout(function(){window.location.reload()})},this.refresh=function(){if(self.bungie.gamertag()){tgd.autoRefreshTime=(new Date).getTime();var count=0,finish=function(){count++,count==self.characters().length&&$.toaster({priority:"success",title:"Success",message:"All the inventory has been updated.",settings:{timeout:tgd.defaults.toastTimeout}})};self.bungie.account(function(result){if(result&&result.data&&result.data.characters){var characters=result.data.characters;_.each(self.characters(),function(character){if("Vault"!=character.id){var result=_.filter(characters,function(avatar){return avatar.characterBase.characterId==character.id})[0];character.updateCharacter(result)}character._reloadBucket(character,void 0,finish,!0)})}})}},this.refreshHandler=function(){clearInterval(self.refreshInterval),self.loadoutMode()===!0?(self.dynamicMode()===!1&&self.toggleBootstrapMenu(),$("body").css("padding-bottom","260px")):$("body").css("padding-bottom","80px"),self.doRefresh()===!0&&self.loadoutMode()===!1&&(self.refreshInterval=setInterval(function(){self.refresh()},1e3*self.refreshSeconds()))},this.bucketSizeHandler=function(){var buckets=$("div.profile .itemBucket:visible").css({height:"auto","min-height":"auto"});if(self.padBucketHeight()===!0){var bucketSizes={},itemHeight=0,vaultPos=parseInt(self.vaultPos())-1;vaultPos=0>vaultPos?0:vaultPos;var vaultColumns=tgd.bootstrapGridColumns/self.vaultColumns();buckets.each(function(){var bucketType=this.className.split(" ")[2],isVault=this.className.indexOf("Vault")>-1,columnsPerBucket=isVault?vaultColumns:tgd.DestinyBucketColumns[bucketType],$visibleBucketItems=$(this).find(".bucket-item:visible"),visibleBucketHeight=$visibleBucketItems.eq(0).height(),bucketHeight=Math.ceil($visibleBucketItems.length/columnsPerBucket)*(visibleBucketHeight+2);visibleBucketHeight&&visibleBucketHeight>itemHeight&&!isVault&&(itemHeight=visibleBucketHeight),bucketType in bucketSizes?bucketSizes[bucketType].push(bucketHeight):bucketSizes[bucketType]=[bucketHeight]}),_.each(bucketSizes,function(sizes,type){var maxHeight=_.max(sizes),profileSizes=sizes.slice(0);profileSizes.splice(vaultPos,1);var maxProfilesHeight=_.max(profileSizes),minNumRows=3;"Bounties"==type?minNumRows=4:tgd.DestinyFiveRowBuckets.indexOf(type)>-1&&(minNumRows=5),maxProfilesHeight=Math.max(itemHeight*minNumRows,maxProfilesHeight);var itemBuckets=buckets.filter("."+type);itemBuckets.css("min-height",maxHeight),itemBuckets.find(".itemBucketBG").css("height",maxProfilesHeight)});var vaultSubClass=$('div.profile .title2:visible strong:contains("Vault Sub")').parent().parent().css("height","auto"),notVaultSubClass=$('div.profile .title2:visible strong:contains("Sub")').not(':contains("Vault")').first().parent().parent().css("height","auto");vaultSubClass.css("min-height",notVaultSubClass.height()),vaultSubClass.css("visibility","hidden")}else buckets.find(".itemBucketBG").css("height","auto")},this.globalClickHandler=function(e){$("#move-popup").is(":visible")&&-1==e.target.className.indexOf("itemLink")&&-1==e.target.parentNode.className.indexOf("itemLink")&&($("#move-popup").hide(),tgd.activeElement=null)},this.quickIconHighlighter=function(){var scrollTop=$(window).scrollTop();$(".profile").each(function(index,item){var $item=$(item),characterId=$item.attr("id"),$quickIcon=$(".quickScrollView ."+characterId),$characterBox=$(".character-box."+characterId),top=$item.position().top-55,bottom=top+$item.height(),isActive=scrollTop>=top&&bottom>=scrollTop&&scrollTop>0;$quickIcon.toggleClass("activeProfile",isActive),$characterBox.toggleClass("active",isActive),$characterBox.toggleClass("not-active",!isActive),$characterBox.css({width:$characterBox.parent().width()+"px"})})},this.readBungieCookie=function(ref,loop){try{ref.executeScript({code:"document.cookie"},function(result){(result||"").toString().indexOf("bungled")>-1&&(self.bungie_cookies=result,window.localStorage.setItem("bungie_cookies",result),self.loadData(ref,loop))})}catch(e){}},this.openHiddenBungieWindow=function(){window.ref=window.open("https://www.bungie.net/en/User/Profile","_blank","location=no,hidden=yes"),ref.addEventListener("loadstop",function(event){self.readBungieCookie(ref,1)})},this.findReference=function(item,callback){if(item&&item.id>0){var subscriptions=[],newItemHandler=function(items){var foundItem=_.where(items,{_id:item._id});foundItem.length>0&&(_.each(subscriptions,function(sub){sub.dispose()}),callback(foundItem[0]))},allItems=_.flatten(_.map(self.characters(),function(character){return subscriptions.push(character.items.subscribe(newItemHandler)),character.items()}));newItemHandler(allItems)}},this.clearCookies=function(){window.localStorage.setItem("bungie_cookies","");try{window.cookies.clear(function(){})}catch(e){}},this.openBungieWindow=function(type){return function(){var loop;if(isNWJS){var gui=require("nw.gui");gui.Window.get();window.ref=gui.Window.open("https://www.bungie.net/en/User/SignIn/"+type+"?bru=%252Fen%252FUser%252FProfile","Test Popup")}else isChrome||isMobile?window.ref=window.open("https://www.bungie.net/en/User/SignIn/"+type+"?bru=%252Fen%252FUser%252FProfile","_blank","location=yes"):window.ref=window.open("https://www.bungie.net/en/User/SignIn/"+type,"_blank","toolbar=0,location=0,menubar=0");isMobile?(ref.addEventListener("loadstop",function(event){self.readBungieCookie(ref,loop)}),ref.addEventListener("exit",function(){_.isEmpty(self.bungie_cookies)&&self.readBungieCookie(ref,loop)})):isNWJS?window.ref.on("loaded",function(){location.reload()}):(clearInterval(loop),loop=setInterval(function(){if(window.ref.closed)if(clearInterval(loop),isMobile||isChrome)self.loadData();else{$.toaster({priority:"success",title:"Loading",message:"Please wait while Firefox acquires your arsenal",settings:{timeout:tgd.defaults.toastTimeout}});var event=new CustomEvent("request-cookie-from-ps",{});window.dispatchEvent(event),setTimeout(function(){self.loadData()},5e3)}},100))}},this.scrollTo=function(distance,callback){
isWindowsPhone?($("html,body").scrollTop(distance),callback&&callback()):$("body").animate({scrollTop:distance},300,"swing",callback)},this.scrollToActiveIndex=function(newIndex){var index=$(".quickScrollView img").filter(function(){var classAttr=$(this).attr("class"),className=_.isUndefined(classAttr)?"":classAttr;return className.indexOf("activeProfile")>-1}).index(".quickScrollView img");self.scrollTo($(".profile:eq("+index+")").position().top-50,function(){$.toaster({priority:"info",title:"View",message:tgd.DestinyViews[newIndex],settings:{timeout:tgd.defaults.toastTimeout}})})},this.shiftViewLeft=function(){var newIndex=parseInt(self.activeView())-1;0>newIndex&&(newIndex=3),self.activeView(newIndex),self.scrollToActiveIndex(newIndex)},this.shiftViewRight=function(){var newIndex=parseInt(self.activeView())+1;4==newIndex&&(newIndex=0),self.activeView(newIndex),self.scrollToActiveIndex(newIndex)},this.requests={};this.apiRequest=function(params,callback){var apiURL=tgd.remoteServer+"/api3.cfm";$.ajax({url:apiURL,data:params,type:"POST",success:function(data){var response="string"==typeof data?JSON.parse(data):data;callback(response)}})},this.staticApiRequest=function(params,callback){var apiURL=tgd.remoteServer+"/static_api.cfm";$.ajax({url:apiURL,data:params,type:"POST",success:function(data){var response="string"==typeof data?JSON.parse(data):data;callback(response)}})},this.saveLoadouts=function(includeMessage){var _includeMessage=_.isUndefined(includeMessage)?!0:includeMessage;if(self.activeUser()&&self.activeUser().user&&self.activeUser().user.membershipId){var loadoutKeys=["name","ids","generics","characterId"],params={action:"save",membershipId:parseFloat(self.activeUser().user.membershipId),loadouts:ko.toJSON(_.map(self.loadouts(),function(loadout){return _.reduce(loadout,function(memo,value,key){return loadoutKeys.indexOf(key)>-1&&(memo[key]=ko.unwrap(value)),memo},{})}))};self.apiRequest(params,function(results){_includeMessage===!0&&(results.success?$.toaster({priority:"success",title:"Saved",message:"Loadouts saved to the cloud",settings:{timeout:tgd.defaults.toastTimeout}}):BootstrapDialog.alert("Error has occurred saving loadouts"))})}else BootstrapDialog.alert("Error reading your membershipId, could not save loadouts")},this.loadLoadouts=function(){if(0===self.loadouts().length){var _loadouts=window.localStorage.getItem("loadouts");_loadouts=_.isEmpty(_loadouts)?[]:_.map(JSON.parse(_loadouts),function(loadout){return new tgd.Loadout(loadout)});var maxCSP="";try{maxCSP=_.map(_.groupBy(_.sortBy(_.filter(_.flatten(_.map(self.characters(),function(character){return character.items()})),function(item){return item.armorIndex>-1}),"bucketType"),"bucketType"),function(items,bucketType){return String.fromCharCode(_.max(_.map(items,function(item){return item.getValue("All")})))}).join("")}catch(e){}self.apiRequest({action:"load",membershipId:parseFloat(self.activeUser().user.membershipId),maxCSP:maxCSP},function(results){var _results=[];results&&results.loadouts&&(_results=_.isArray(results.loadouts)?results.loadouts:[results.loadouts],_results=_.sortBy(_.map(_results,function(loadout){return loadout.ids=_.isArray(loadout.ids)?loadout.ids:[loadout.ids],loadout.generics=_.isArray(loadout.generics)?loadout.generics:[loadout.generics],loadout.equipIds=_.isEmpty(loadout.equipIds)?[]:loadout.equipIds,loadout.equipIds=_.isArray(loadout.equipIds)?loadout.equipIds:[loadout.equipIds],new tgd.Loadout(loadout)}),function(l){return l.characterId()})),_loadouts.length>0&&(_results=_loadouts.concat(_results),window.localStorage.setItem("loadouts","")),self.loadouts(_results),_loadouts.length>0&&self.saveLoadouts(!1);var destinyMaxCSP=tgd.sum(tgd.DestinyMaxCSP),destinyMaxBonusPoints=tgd.sum(_.map(tgd.DestinyMaxCSP,function(value,bucket){return tgd.bonusStatPoints(tgd.DestinyArmorPieces.indexOf(bucket),tgd.DestinyLightCap)}));tgd.maxTierPossible=Math.floor(destinyMaxCSP/tgd.DestinySkillTier),tgd.maxTierPointsPossible=tgd.maxTierPossible*tgd.DestinySkillTier;var minAvgPercentNeeded=(tgd.maxTierPointsPossible-destinyMaxBonusPoints)/(destinyMaxCSP-destinyMaxBonusPoints)*100;app.minAvgPercentNeeded(Math.round(100*minAvgPercentNeeded)/100)})}},this.showWhatsNew=function(callback){var container=$("<div></div>");container.attr("style","overflow-y: scroll; height: 480px"),container.html(tgd.whatsNewTemplate()),(new tgd.dialog).title(self.activeText().whats_new_title).content(container).show(!1,function(){_.isFunction(callback)&&callback()})},this.whatsNew=function(){if("true"==$("#showwhatsnew").text()){var version=tgd.version.replace(/\./g,"");4==version.length&&(version+="0");var cookie=window.localStorage.getItem("whatsnew");cookie&&cookie.length&&4==cookie.length&&(cookie+="0"),(_.isEmpty(cookie)||parseInt(cookie)<parseInt(version))&&self.showWhatsNew(function(){window.localStorage.setItem("whatsnew",version)})}},this.normalizeSingle=function(description,characters,usingbatchMode,callback){var itemTotal=0,characterStatus=_.map(characters,function(c){var characterTotal=_.reduce(_.filter(c.items(),{description:description}),function(memo,i){return memo+i.primaryStat()},0);return itemTotal+=characterTotal,{character:c,current:characterTotal,needed:0}});if(itemTotal<characterStatus.length)return usingbatchMode===!1&&$.toaster({priority:"danger",title:"Warning",message:"Cannot distribute "+itemTotal+" "+description+" between "+characterStatus.length+" characters.",settings:{timeout:tgd.defaults.toastTimeout}}),void(void 0!==callback&&callback());var itemSplit=itemTotal/characterStatus.length|0;_.each(characterStatus,function(c){c.needed=itemSplit-c.current});var getNextSurplusCharacter=function(){return function(){return _.filter(characterStatus,function(c){return c.needed<0})[0]}}(),getNextShortageCharacter=function(){return function(){return _.filter(characterStatus,function(c){return c.needed>0})[0]}}();if("undefined"==typeof getNextSurplusCharacter()||"undefined"==typeof getNextShortageCharacter())return usingbatchMode===!1&&$.toaster({priority:"success",title:"Result",message:description+" already normalized as best as possible.",settings:{timeout:tgd.defaults.toastTimeout}}),void("undefined"!=typeof callback&&callback());var adjustStateAfterTransfer=function(surplusCharacter,shortageCharacter,amountTransferred){surplusCharacter.current=surplusCharacter.current-amountTransferred,surplusCharacter.needed=surplusCharacter.needed+amountTransferred,shortageCharacter.needed=shortageCharacter.needed-amountTransferred,shortageCharacter.current=shortageCharacter.current+amountTransferred},nextTransfer=function(callback){var surplusCharacter=getNextSurplusCharacter(),shortageCharacter=getNextShortageCharacter();if("undefined"==typeof surplusCharacter||"undefined"==typeof shortageCharacter)return usingbatchMode===!1&&$.toaster({priority:"success",title:"Result",message:"All items normalized as best as possible",settings:{timeout:tgd.defaults.toastTimeout}}),void(void 0!==callback&&callback());if(surplusCharacter.character.id==shortageCharacter.character.id)return void(void 0!==callback&&callback());var surplusItems=_.filter(surplusCharacter.character.items(),{description:description}),surplusItem=surplusItems[0],maxWeCanWorkWith=Math.min(surplusItem.primaryStat(),-1*surplusCharacter.needed),amountToTransfer=Math.min(maxWeCanWorkWith,shortageCharacter.needed);"Vault"==surplusCharacter.character.id?surplusItem.transfer("Vault",shortageCharacter.character.id,amountToTransfer,function(){adjustStateAfterTransfer(surplusCharacter,shortageCharacter,amountToTransfer),nextTransfer(callback)}):"Vault"==shortageCharacter.character.id?surplusItem.transfer(surplusCharacter.character.id,"Vault",amountToTransfer,function(){adjustStateAfterTransfer(surplusCharacter,shortageCharacter,amountToTransfer),nextTransfer(callback)}):surplusItem.transfer(surplusCharacter.character.id,"Vault",amountToTransfer,function(){surplusItem.transfer("Vault",shortageCharacter.character.id,amountToTransfer,function(){adjustStateAfterTransfer(surplusCharacter,shortageCharacter,amountToTransfer),nextTransfer(callback)})})},messageStr="<div><div>Normalize "+description+"</div><ul>";for(i=0;i<characterStatus.length;i++)messageStr=messageStr.concat("<li>"+characterStatus[i].character.classType()+": "+(characterStatus[i].needed>0?"+":"")+characterStatus[i].needed+"</li>");if(messageStr=messageStr.concat("</ul></div>"),usingbatchMode===!1){var defaultAction=function(dialogItself){nextTransfer(callback),dialogItself.close()};new tgd.koDialog({templateName:"",viewModel:{},onFinish:defaultAction,message:messageStr,buttons:[{label:self.activeText().normalize,cssClass:"btn-primary",action:defaultAction},{label:self.activeText().close_msg,action:function(dialogItself){dialogItself.close()}}]}).title(self.activeText().normalize_title).show(!0)}else nextTransfer(callback)},this.normalizeAll=function(bucketType){var done=function(onlyCharacters){var descriptions=_.uniq(_.flatten(_.map(onlyCharacters,function(character){return _.pluck(_.filter(character.items(),function(item){return item.bucketType==bucketType&&item.transferStatus<2}),"description")}))),getNextDescription=function(){var i=0;return function(){return i<descriptions.length?descriptions[i++]:void 0}}(),nextNormalize=function(){var description=getNextDescription();return"undefined"==typeof description?void $.toaster({priority:"success",title:"Result",message:"All items normalized as best as possible",settings:{timeout:tgd.defaults.toastTimeout}}):void self.normalizeSingle(description,onlyCharacters,!0,nextNormalize)};nextNormalize()};this.selectMultiCharacters("Normalize All "+bucketType,"Normalize: equally distribute all "+bucketType+" across the selected characters",done)},this.selectMultiCharacters=function(title,description,callback){var smc=new tgd.selectMultiCharacters(description,self.orderedCharacters),defaultAction=function(dialogItself){var characters=smc.selectedCharacters();characters.length<=1?BootstrapDialog.alert("Need to select two or more characters."):callback(characters),dialogItself.close()};new tgd.koDialog({templateName:"selectMultiCharactersTemplate",viewModel:smc,buttons:[{label:self.activeText().ok_msg,cssClass:"btn-primary",action:defaultAction},{label:self.activeText().close_msg,action:function(dialogItself){dialogItself.close()}}]}).title(title).show(!0)},this.setVaultTo=function(){var pos=this.toString(),vault=_.findWhere(self.characters(),{id:"Vault"});return vault?(self.vaultPos(pos),void vault.order(pos)):!1},this.isVaultAt=function(pos){return ko.pureComputed(function(){var vault=_.findWhere(self.characters(),{id:"Vault"});return vault?result=vault.order()==pos:result=!1,result}).extend({rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}})},this._columnMode=function(){var characterColumns,character=this,totalCharacters=3,xsColumn=self.xsColumn(),smColumn=self.smColumn(),mdColumn=self.mdColumn(),lgColumn=self.lgColumn(),vaultColumns=lgColumn,totalColumns=tgd.bootstrapGridColumns,layoutMode=self.layoutMode();return"uneven"==layoutMode?(vaultColumns=self.vaultWidth(),characterColumns=Math.floor((totalColumns-vaultColumns)/totalCharacters)):(vaultColumns=lgColumn,characterColumns=lgColumn),"Vault"==character.id?"even"!=layoutMode||4!=self.vaultPos()||8!=lgColumn&&8!=mdColumn&&8!=smColumn?lgColumn=vaultColumns:(8==lgColumn&&(lgColumn=24),8==mdColumn&&(mdColumn=24),8==smColumn&&(smColumn=24)):lgColumn=characterColumns,"col-xs-"+xsColumn+" col-sm-"+smColumn+" col-md-"+mdColumn+" col-lg-"+lgColumn},this.columnMode=function(character){return ko.pureComputed(self._columnMode,character)},this.setColumns=function(input,ctx,evt){var type=this.toString();self[type+"Column"](tgd.bootstrapGridColumns/input.value),self.redraw()},this._btnActive=function(){var input=this;return tgd.bootstrapGridColumns/input.value==self[input.kind+"Column"]()?"btn-primary":""},this.btnActive=function(type,input){return input.kind=type,ko.pureComputed(self._btnActive,input)},this.generateStatic=function(){var profileKeys=["race","order","gender","classType","id","level","imgIcon","icon","background","stats"],itemKeys=["id","_id","characterId","damageType","damageTypeName","isEquipped","isGridComplete","locked","description","itemDescription","bucketType","type","typeName","tierType","tierTypeName","icon","primaryStat","progression","weaponIndex","armorIndex","perks","stats","isUnique","href"],profiles=_.map(self.characters(),function(profile){var newProfile={};return _.each(profileKeys,function(key){newProfile[key]=ko.unwrap(profile[key])}),newProfile.items=_.map(profile.items(),function(item){var newItem={};return _.each(itemKeys,function(key){newItem[key]=ko.unwrap(item[key])}),ko.toJS(newItem)}),newProfile});return JSON.stringify(profiles)},this.initLocale=function(callback){navigator&&navigator.globalization&&navigator.globalization.getPreferredLanguage&&navigator.globalization.getPreferredLanguage(function(a){if(a&&a.value&&a.value.indexOf("-")>-1){var value=a.value.split("-")[0];_.pluck(tgd.languages,"code").indexOf(value)>-1&&("pt"==value&&(value="pt-br"),self.locale(value))}})},this.getBucketName=function(bucketType){return"Invisible"==bucketType?"Special Orders":bucketType},this.dndImageGridOptions={start:function(){$ZamTooltips.isEnabled=!1,$ZamTooltips.hide()},stop:function(){self.tooltipsEnabled()===!0&&($ZamTooltips.isEnabled=!0)},over:function(){$(this).addClass("active")},out:function(){$(this).removeClass("active")},sort:function(event,ui){var $target=$(event.target);if(!/html|body/i.test($target.offsetParent()[0].tagName)){var top=event.pageY-$target.offsetParent().offset().top-ui.helper.outerHeight(!0)/2;ui.helper.css({top:top+"px"})}},scroll:!1,revert:!1,placeholder:"item-placeholder",cursorAt:{cursor:"move",top:27,left:27},cursor:"pointer",appendTo:"body"},this.dndBeforeMove=function(arg){arg&&arg.targetParent&&arg.targetParent.length>0&&(arg.cancelDrop=arg.item.bucketType!==arg.targetParent[0].bucketType||arg.item.transferStatus>=2)},this.dndAfterMove=function(arg){var destination=_.filter(arg.targetParent,function(item){return item.character.id!=arg.item.character.id});if(0===destination.length&&(destination=_.filter(arg.targetParent,function(item){return item._id!=arg.item._id})),destination.length>0&&(destination=destination[0],destination.character.id!=arg.item.character.id)){var action=destination.isEquipped()?"equip":"store";$.toaster({priority:"info",title:"Transfer",message:arg.item.description+" will be "+action+"d to "+destination.character.uniqueName(),settings:{timeout:tgd.defaults.toastTimeout}}),arg.item[action](destination.character.id)}},this.loadStatic=function(username){self.staticApiRequest({username:username},function(staticProfiles){return 0===staticProfiles.length?BootstrapDialog.alert("There is no shared data to view for this profile"):void _.each(staticProfiles,function(data,index){var avatar={processed:!0,characterBase:{characterId:data.id,stats:data.stats,level:data.level,race:data.race,gender:data.gender,classType:data.classType,background:data.background,icon:data.icon},items:data.items,index:data.order},profile=new Profile(avatar);self.characters.push(profile),self.redraw()})})},this.setGlobalItems=function(){var armorType=this.toString();self.globalItems.indexOf(armorType)>-1?self.globalItems.remove(armorType):self.globalItems.push(armorType)};var remainingInterval,subscriptions=[];this.transferFarmItems=function(targetCharacterId,items){if(!tgd.transferringFarmItems){var farmItemCounts=self.farmItemCounts(),itemsToTransfer=_.object(_.map(self.farmItems(),function(itemType){var filteredItems=_.sortBy(_.filter(_.filter(items,tgd.farmItemFilters[itemType]),function(item){return item.characterId()!=targetCharacterId}),"tierType"),bucketKey="Vault"==targetCharacterId?"actualBucketType":"bucketType",spaceAvailable=_.countBy(_.findWhere(self.characters(),{id:targetCharacterId}).items(),bucketKey);return[itemType,_.filter(filteredItems,function(item){var slotsAvailable=spaceAvailable[item[bucketKey]],maxSpaceAvailable=0;return maxSpaceAvailable="Vault"==targetCharacterId?_.findWhere(tgd.DestinyLayout,{array:item.actualBucketType}).counts[0]:_.has(tgd.DestinyBucketSizes,item.bucketType)?tgd.DestinyBucketSizes[item.bucketType]:10,maxSpaceAvailable>slotsAvailable?(spaceAvailable[item[bucketKey]]++,!0):!1})]}));if("Vault"==targetCharacterId&&_.each(itemsToTransfer,function(filteredItems,itemType){farmItemCounts[itemType]=(farmItemCounts[itemType]||0)+filteredItems.length}),self.farmItemCounts(farmItemCounts),itemsToTransfer=_.flatten(_.map(itemsToTransfer)),0!==itemsToTransfer.length){var adhoc=new tgd.Loadout(itemsToTransfer,!0),msa=adhoc.transfer(targetCharacterId,!0);msa.length>0&&(tgd.autoTransferStacks=!0,tgd.transferringFarmItems=!0,adhoc.swapItems(msa,targetCharacterId,function(){tgd.autoTransferStacks=!1,tgd.transferringFarmItems=!1}))}}},this.farmItemHandler=function(items){self.transferFarmItems(self.farmTarget(),items)},this.vaultItemHandler=function(items){},this.farmModeHandler=function(isEnabled){isEnabled===!0?(self.doRefresh()===!1&&self.doRefresh(!0),_.has(window,"plugins")&&_.has(window.plugins,"insomnia")&&window.plugins.insomnia.keepAwake(),clearInterval(remainingInterval),remainingInterval=setInterval(function(){var timeRemaining=Math.floor(self.refreshSeconds()-((new Date).getTime()-tgd.autoRefreshTime)/1e3);timeRemaining>60?timeRemaining=Math.floor(timeRemaining/60)+"m"+timeRemaining%60+"s":timeRemaining+="s",$("#timeRemainingForRefresh").html(timeRemaining)},1e3),_.each(self.characters(),function(character){"Vault"==character.id&&"Vault"==self.farmTarget()?subscriptions.push(character.items.subscribe(self.vaultItemHandler)):("Vault"!=character.id&&"Vault"==self.farmTarget()||"Vault"==character.id&&"Vault"!==self.farmTarget())&&(subscriptions.push(character.items.subscribe(self.farmItemHandler)),self.farmItemHandler(character.items()))})):(_.has(window,"plugins")&&_.has(window.plugins,"insomnia")&&window.plugins.insomnia.allowSleepAgain(),tgd.transferringFarmItems=!1,clearInterval(remainingInterval),_.each(subscriptions,function(subscription){subscription.dispose()}))},this.init=function(){_.each(ko.templates,function(content,name){$("<script></script").attr("type","text/html").attr("id",name).html(content).appendTo("head")});var providedTemplates=_.keys(ko.templates);if($("div[data-bind*=template]").map(function(i,e){var template=$(e).attr("data-bind").match(/'(.*)'/)[1];-1==providedTemplates.indexOf(template)&&$(e).remove()}),window.isStaticBrowser?($ZamTooltips.init(),self.bungie=new tgd.bungie("",function(){self.loadStatic(unescape(location.search.replace("?","")))})):($.idleTimer(18e5),$(document).on("idle.idleTimer",function(event,elem,obj){clearInterval(self.refreshInterval)}),$(document).on("active.idleTimer",self.refreshHandler)),("3"==self.lgColumn()||"4"==self.mdColumn())&&(self.lgColumn(tgd.defaults.lgColumn),self.mdColumn(tgd.defaults.mdColumn),self.smColumn(tgd.defaults.smColumn),self.xsColumn(tgd.defaults.xsColumn)),_.each(tgd.DestinyLayout,function(layout){self.allLayouts.push(new tgd.Layout(layout))}),self.initLocale(),_.isUndefined(window._itemDefs)||_.isUndefined(window._perkDefs))return BootstrapDialog.alert(self.activeText().itemDefs_undefined);if(_.each(_.templates,function(content,templateName){"languagesTemplate"==templateName&&self.activeText()&&self.activeText().language_text&&(content=self.activeText().language_text+content),tgd[templateName]=_.template(content)}),!window.isStaticBrowser){self.doRefresh.subscribe(self.refreshHandler),self.refreshSeconds.subscribe(self.refreshHandler),self.loadoutMode.subscribe(self.refreshHandler),tgd.farmItems=new tgd.StoreObj("farmItems");var savedSelections=tgd.farmItems.read();self.farmItems(_.isArray(savedSelections)?savedSelections:savedSelections.split(",")),self.farmItems.subscribe(function(newValues){tgd.farmItems.write(newValues)});var storedObj=new tgd.StoreObj("globalItems");savedSelections=storedObj.read(),self.globalItems(_.isArray(savedSelections)?savedSelections:savedSelections.split(",")),self.globalItems.subscribe(function(newValues){storedObj.write(newValues)})}if(self.farmMode.subscribe(self.farmModeHandler),self.padBucketHeight.subscribe(self.redraw),self.refreshHandler(),!window.isStaticBrowser){self.bungie_cookies="",window.localStorage&&window.localStorage.getItem&&(self.bungie_cookies=window.localStorage.getItem("bungie_cookies"));var isEmptyCookie=-1==(self.bungie_cookies||"").indexOf("bungled");if(isWindowsPhone){var msViewportStyle=document.createElement("style");msViewportStyle.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}")),document.getElementsByTagName("head")[0].appendChild(msViewportStyle)}var dragAndDropEnabled=self.padBucketHeight()===!0&&self.dragAndDrop()===!0;ko.bindingHandlers.sortable.isEnabled=dragAndDropEnabled,ko.bindingHandlers.draggable.isEnabled=dragAndDropEnabled,isMobile&&isEmptyCookie?self.bungie=new tgd.bungie("",function(){self.activeUser({code:99,error:"Please sign-in to continue."})}):self.loadData()}$("html").click(self.globalClickHandler),self.activeView.subscribe(self.redraw),$(window).resize(_.throttle(self.bucketSizeHandler,500)),$(window).resize(_.throttle(self.quickIconHighlighter,500)),$(window).scroll(_.throttle(self.quickIconHighlighter,500)),self.collectionSets=_.sortBy(Object.keys(_collections)),tgd.maxTierPossible=Math.floor(tgd.sum(tgd.DestinyMaxCSP)/tgd.DestinySkillTier),tgd.maxTierPointsPossible=tgd.maxTierPossible*tgd.DestinySkillTier,tgd.DestinyArmorStats=_.filter(_statDefs,function(stat){return tgd.DestinyArmorStats.indexOf(stat.statHash)>-1}),window.isStaticBrowser||$(document).on("click","a[target='_system']",function(){return window.open(this.href,tgd.openTabAs),!1}),ko.applyBindings(self),$("form").bind("submit",!1),window.isStaticBrowser||(isMobile&&(Hammer(document.getElementById("charactersContainer"),{drag_horizontal:!0,drag_vertical:!1}).on("swipeleft",self.shiftViewLeft).on("swiperight",self.shiftViewRight).on("tap",self.globalClickHandler),"undefined"!=typeof StatusBar&&(StatusBar.styleBlackOpaque(),StatusBar.backgroundColorByHexString("#272B30")),"undefined"!=typeof inappbilling&&inappbilling.init(_.noop,_.noop,{showLog:!1},["small","medium","large"]),isWindowsPhone||document.addEventListener("backbutton",function(e){e.preventDefault()},!1)),self.whatsNew()),window.BOOTSTRAP_OK=!0}};window.app=new app,BootstrapDialog.defaultOptions.nl2br=!1,isMobile?(window.addEventListener("statusTap",function(){var target=$("body");target.css({"-webkit-overflow-scrolling":"auto","overflow-y":"hidden"}),target.animate({scrollTop:0},300,"swing",function(){target.css({"-webkit-overflow-scrolling":"touch","overflow-y":"scroll"})})}),document.addEventListener("deviceready",app.init,!1)):$(document).ready(app.init),_ga=new function(){var self=this;this.init=function(){var ga_options={cookieDomain:"none"};isMobile&&(ga_options={storage:"none",clientId:device.uuid}),ga("create","UA-61575166-1",ga_options),ga("set","checkProtocolTask",function(){}),ga("set","appVersion",tgd.version),ga(function(tracker){var originalSendHitTask=tracker.get("sendHitTask");tracker.set("sendHitTask",function(model){originalSendHitTask(model);var xhr=new XMLHttpRequest;xhr.open("POST",tgd.remoteServer+"/ga.cfm",!0),xhr.send(model.get("hitPayload"))})}),ga("send","pageview"),self.loadListeners()},this.loadListeners=function(){window.addEventListener("error",function(e){-1==e.filename.toLowerCase().indexOf("inappbrowser")&&-1==e.filename.toLowerCase().indexOf("cordova")&&-1==e.filename.toLowerCase().indexOf("libraries")&&ga("send","exception",{exDescription:e.message,exFatal:!0,appName:e.filename+":  "+e.lineno,appVersion:tgd.version,hitCallback:function(){}})});var unwantedCodes=[0,503,504,522,523,524,525,526,502,400,403,409,500];$(document).ajaxError(function(evt,request,settings,err){-1==unwantedCodes.indexOf(request.status)&&ga("send","exception",{exDescription:request.status+" ajax error at "+settings.url+" "+settings.data+" "+err,exFatal:!0,appVersion:tgd.version,hitCallback:function(){}})})}},isMobile?document.addEventListener("deviceready",_ga.init,!1):$(document).ready(_ga.init),window.zam_tooltips={addIcons:!1,colorLinks:!1,renameLinks:!1,renderCallback:app.renderCallback,isEnabled:app.tooltipsEnabled()},tgd.Tooltip=function(id){var info=_itemDefs[id];info&&info.tierType&&(this["class"]="destt-q"+info.tierType),this.icon=tgd.tooltipsIconTemplate({item:info}),this.id=id,this.name=unescape(info.itemName),this.site="destinydb",this.tooltip=tgd.tooltipsTemplate({item:info}),this.type="items"},window.$ZamTooltips=function(){this.addIcons=!1,this.renameLinks=!1,this.colorLinks=!1,this.isEnabled=!0,this.enabled=function(){return this.isEnabled},this.renderCallback=function(context,content,element,cb){cb(content)},"object"==typeof zam_tooltips&&(zam_tooltips.addIcons&&(this.addIcons=!0),zam_tooltips.renderCallback&&(this.renderCallback=zam_tooltips.renderCallback),zam_tooltips.renameLinks&&(this.renameLinks=!0),zam_tooltips.colorLinks&&(this.colorLinks=!0),"isEnabled"in zam_tooltips&&(this.isEnabled=zam_tooltips.isEnabled));var reAllSites,reLocalUrl,container,lastEvent,remote="undefined"==typeof FH,sites={d3head:{url:"d3head.com",cdn:"https://d3css.zamimg.com",tt:'<div class="fhtt d3h d3h-custom"><div class="d3htt-cont">@text@</div><div class="d3htt-right"></div><div class="d3htt-bottomright"></div><div class="d3htt-bottom"></div></div>',ttFluid:'<div class="fhtt d3h d3h-fluid"><div class="d3htt-cont">@text@</div><div class="d3htt-right"></div><div class="d3htt-bottomright"></div><div class="d3htt-bottom"></div></div>',types:["achievement","class","crafting","item","lore","npc","quest","recipe","rune","skill","zone","custom"]},esohead:{url:"esohead.com",cdn:"https://esocss.zamimg.com",tt:'<div class="fhtt eh"><div class="ehtt-cont">@text@</div><div class="ehtt-right"></div><div class="ehtt-bottomright"></div><div class="ehtt-bottom"></div></div>',ttFluid:'<div class="fhtt eh eh-fluid"><div class="ehtt-cont">@text@</div><div class="ehtt-right"></div><div class="ehtt-bottomright"></div><div class="ehtt-bottom"></div></div>',types:["abilities","achievements","books","classes","items","itemsets","monsters","races","recipes","skills","tradeskills","zones","custom","poi","skyshards","mundus-stones"]},heroking:{url:"heroking.net",cdn:"https://hkcss.zamimg.com",tt:'<div class="fhtt hk"><div class="hktt-cont">@text@</div><div class="hktt-right"></div><div class="hktt-bottomright"></div><div class="hktt-bottom"></div></div>',ttFluid:'<div class="fhtt hk hk-fluid"><div class="hktt-cont">@text@</div><div class="hktt-right"></div><div class="hktt-bottomright"></div><div class="hktt-bottom"></div></div>',types:["heroes","achievements","abilities","mounts","talents","rewards","bundles"]},destinydb:{url:"destinydb.com",cdn:"https://descss.zamimg.com",tt:'<div class="fhtt des"><div class="destt-cont">@text@</div><div class="destt-right"></div><div class="destt-bottomright"></div><div class="destt-bottom"></div></div>',ttFluid:'<div class="fhtt des des-fluid"><div class="destt-cont">@text@</div><div class="destt-right"></div><div class="destt-bottomright"></div><div class="destt-bottom"></div></div>',types:["talents","talent-child","items","classes","races","activities","vendors","grimoire","destinations","places","medals","players","guardians","events","snapshots"]},overking:{url:"overking.com",cdn:"https://okcss.zamimg.com",tt:'<div class="fhtt des"><div class="destt-cont">@text@</div><div class="destt-right"></div><div class="destt-bottomright"></div><div class="destt-bottom"></div></div>',ttFluid:'<div class="fhtt des des-fluid"><div class="destt-cont">@text@</div><div class="destt-right"></div><div class="destt-bottomright"></div><div class="destt-bottom"></div></div>',types:["heroes","abilities"]}},cache=this.cache={},activeTooltip=!1,attachedTo=!1,addEvent=function(obj,evt,callback){obj.addEventListener?obj.addEventListener(evt,callback,!0):obj.attachEvent("on"+evt,callback)},removeEvent=function(obj,evt,callback){obj.removeEventListener?obj.removeEventListener(evt,callback,!0):obj.detachEvent("on"+evt,callback)},addResource=function(res){document.head?document.head.appendChild(res):document.body.appendChild(res)},getCanonicalName=function(site,type,id){return sites[site]?sites[site].url+"/"+type+"/"+id:!1},getMousePos=function(event){var windowInfo=getWindowInfo();if(!event)return{x:-9999,y:-9999};var x=void 0!==event.pageX?event.pageX:windowInfo.left+event.clientX,y=void 0!==event.pageY?event.pageY:windowInfo.top+event.clientY;return{x:x,y:y}},getElementDimensions=function(t){for(var x=t.offsetLeft,y=t.offsetTop,temp=t;temp.offsetParent&&(x+=temp.offsetParent.offsetLeft,y+=temp.offsetParent.offsetTop,"BODY"!=temp.tagName);)temp=temp.offsetParent;return{x:x,y:y,w:t.offsetWidth,h:t.offsetHeight}},getWindowInfo=function(){var left="undefined"!=typeof window.pageXOffset?window.pageXOffset:document.body.scrollLeft,top="undefined"!=typeof window.pageYOffset?window.pageYOffset:document.body.scrollTop,width=window.innerWidth?window.innerWidth:document.body.clientWidth,height=window.innerHeight?window.innerHeight:document.body.clientHeight;return{left:left,top:top,right:left+width,bottom:top+height}},getServerUrl=function(){return"https://"+location.hostname+(80==location.port?"":":"+location.port)},ready=!1;this.init=function(){if(!ready){var domains=[];for(var s in sites)if(sites.hasOwnProperty(s)){domains.push(sites[s].url),sites[s].typeHash={};for(var numTypes=sites[s].types.length,i=0;numTypes>i;i++)sites[s].typeHash[sites[s].types[i]]=!0;sites[s].re=new RegExp(sites[s].url+"/("+sites[s].types.join("|")+")/([^?&#;-]+)")}reAllSites=new RegExp("^https?://[^/]*\\.?("+domains.join("|")+")/"),reLocalUrl=new RegExp("^(https?://)"+location.host+"(/.+)"),addEvent(document,"mouseover",onMouseover);var div=document.createElement("div");div.id="zam-tooltip",div.setAttribute("style","display:none;position:absolute;left:0;top:0;z-index:9999999999");try{document.body.insertBefore(div,document.body.childNodes[0]),container=div,ready=!0,!remote||this.addIcons||this.colorLinks||this.renameLinks?this.preload():remote&&this.preload(!0)}catch(e){ga("send","exception",{exDescription:"tooltips crashed > "+e.toString(),exFatal:!1,appVersion:tgd.version,hitCallback:function(){}})}}};var parseMatches=function(matches,tags){for(var numTags=tags.length,i=0;numTags>i;i++){var a=tags[i],match=scan(a,!0);match!==!1&&(matches[match.site]||(matches[match.site]={}),matches[match.site][match.type]||(matches[match.site][match.type]=[]),-1==matches[match.site][match.type].indexOf(match.id)&&matches[match.site][match.type].push(match.id))}};this.getContainer=function(){return container},this.preload=function(cssOnly){if(ready){var aTags=document.body.getElementsByTagName("a"),dataTags=document.querySelectorAll("[data-zamtooltip]"),matches={};parseMatches(matches,dataTags),parseMatches(matches,aTags);for(var site in matches)if(matches.hasOwnProperty(site)&&!cssOnly)for(var type in matches[site])if("custom"!=type&&matches[site].hasOwnProperty(type)){for(var id,ids=matches[site][type],finalIDs=[],i=0;id==ids[i];i++)cache[getCanonicalName(site,type,ids[i])]||finalIDs.push(id);for(var ii=0,x=finalIDs.length;x>ii;ii+=50){ids=finalIDs.slice(ii,ii+50);var url="/"+type+"/tooltip/"+ids.join(";");if(remote||FH.DOMAIN!=site){if(!sites[site])continue;url="https://"+sites[site].url+url}else url=getServerUrl()+url;var script=document.createElement("script");script.type="text/javascript",script.src=url,addResource(script);for(var numIds=ids.length,j=0;numIds>j;++j)cache[getCanonicalName(site,type,ids[j])]=!0}}}},this.updateLinks=function(site,type){if(this.addIcons||this.colorLinks||this.renameLinks)for(var tags=document.getElementsByTagName("a"),i=tags.length;i--;){var a=tags[i],opts=a.rel.split(" ");if(!a.zamModified){var match=scan(a,!0,!0);if(match&&match.site==site&&match.type==type&&!a.attributes["data-zamtooltip"]){
var canonical=getCanonicalName(match.site,match.type,match.id);if(cache[canonical]){var info=cache[canonical];if(info!==!0&&(a.zamModified=!0,(this.renameLinks||opts.indexOf("rename"))&&info.name&&-1==opts.indexOf("protect")&&-1==opts.indexOf("!rename")&&(a.innerHTML=info.name),(this.renameLinks||opts.indexOf("color"))&&info["class"]&&-1==opts.indexOf("protect")&&-1==opts.indexOf("!color")&&(a.className+=" "+info["class"]),(this.addIcons||opts.indexOf("icon"))&&info.icon&&-1==opts.indexOf("protect")&&-1==opts.indexOf("!icon"))){var span=document.createElement("span");span.innerHTML=info.icon;var link=span.getElementsByTagName("a")[0];link&&(link.zamModified=!0,link.setAttribute("data-"+match.site,match.type+"="+match.id),a.href&&(link.href=a.href)),a.parentNode.insertBefore(span,a)}}}}}},this.lastElement=null,this.show=function(site,type,id,attach,element){if($("#move-popup").is(":visible"))return!1;element&&(this.lastElement=element);var canonical=getCanonicalName(site,type,id);"custom"==type&&(cache[canonical]=id),cache[canonical]||fetch(site,type,id);var info=cache[canonical];info&&container&&(info===!0?container.innerHTML=sites[site].tt.replace("@text@","Loading..."):"custom"==type?container.innerHTML=sites[site].ttFluid.replace("@text@",info):(container.innerHTML=info.tooltip.replace(/\/\/desimg.zamimg.com/g,"https://desimg.zamimg.com"),this.renderCallback(info,container.innerHTML,this.lastElement,function(newContent){container.innerHTML=newContent})),activeTooltip=canonical,attachedTo=attach,this.update())},this.update=function(){container.style.display="block",container.onclick=function(){$ZamTooltips.hide()};var pos,win=getWindowInfo(),tempcontainer=container.getBoundingClientRect(),w=tempcontainer.width,h=tempcontainer.height;if(attachedTo){var dim=getElementDimensions(attachedTo);pos=reposition(dim,win,w,h)}else{var mousePos=getMousePos(lastEvent);pos=reposition({x:mousePos.x,y:mousePos.y,w:0,h:0},win,w,h)}container.style.left=pos.left+"px",container.style.top=pos.top+"px"},this.scanAtCursor=function(event){var x=event.clientX,y=event.clientY,target=document.elementFromPoint(x,y);target&&onMouseover({target:target})},this.hide=function(){activeTooltip=!1,attachedTo=!1,container&&container.style&&(container.style.display="none",container.innerHTML="")},this.add=function(site,id,tooltip){var canonical=getCanonicalName(site,"custom",id);cache[canonical]=tooltip},this.onTooltip=function(tooltips){if(tooltips.length){for(var site,type,numTooltips=tooltips.length,i=0;numTooltips>i;i++){var info=tooltips[i];if(info.site&&info.type&&info.id&&info.tooltip){var canonical=getCanonicalName(info.site,info.type,info.id);cache[canonical]=info,site=info.site,type=info.type,activeTooltip==canonical&&this.show(info.site,info.type,info.id,attachedTo)}}this.updateLinks(site,type)}};var onMouseover=function(event){if($ZamTooltips.enabled()===!0){var t=event.target?event.target:event.srcElement;lastEvent=event;for(var i=0;t&&5>i&&!scan(t);)t=t.parentNode,i++}},onMousemove=function(event){$ZamTooltips.enabled()===!0&&(lastEvent=event,$ZamTooltips.update())},onMouseout=function(event){if($ZamTooltips.enabled()===!0){lastEvent=event,$ZamTooltips.hide();var t=event.target?event.target:event.srcElement;removeEvent(t,"mousemove",onMousemove),removeEvent(t,"mouseout",onMouseout)}},padding={x:10,y:4},reposition=function(dim,win,w,h){var left=dim.x+dim.w+padding.x,top=dim.y-h-padding.y;return left+w>win.right&&(left=dim.x-w-padding.x,left<win.left&&(left=win.right-w-padding.x)),dim.y+h+padding.y>win.bottom&&top<win.top?top=win.top-padding.y:top<win.top&&(top=dim.y+dim.h+padding.y),{left:left,top:top}},fetchLocal=function(id){var tooltips=[new tgd.Tooltip(id)];$ZamTooltips.onTooltip(tooltips)},fetch=function(site,type,id){var canonical=getCanonicalName(site,type,id);if(cache[canonical]=!0,_.has(_itemDefs,id))fetchLocal(id);else{var url="/"+type+"/tooltip/"+id;if(remote||FH.DOMAIN!=site){if(!sites[site])return!1;url="https://"+sites[site].url+url}else url=getServerUrl()+url;var script=document.createElement("script");script.type="text/javascript",script.src=url;var isLoaded=!1;script.onload=script.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(isLoaded=!0),isLoaded&&_.isObject(cache[canonical])||fetchLocal(id)},addResource(script),setTimeout(function(){_.isObject(cache[canonical])||fetchLocal(id)},3e3)}return!0},scan=function(t,partOfPreload,basicScan){if(!(t.attributes&&t.attributes["data-zamtooltip"]||"A"==t.nodeName&&(0!==t.href.length||0!==t.rel.length)&&-1==t.rel.indexOf("nott")&&-1==t.rel.indexOf("!tt")&&-1==t.href.indexOf(location.href+"#")))return!1;var url=t.href;if(!url){for(var a,as=t.getElementsByTagName("a"),i=0;(a=as[i])&&!(url=a.href);i++);if(!url)return!1}if(remote&&!url.match(reAllSites))return!1;!remote&&sites[FH.DOMAIN]&&(url=url.replace(reLocalUrl,sites[FH.DOMAIN].url+"$2"));var match=testDataAttrib(t);if(match||(match=testUrl(url)),!match)return!1;if(partOfPreload)return!t.preloaded||basicScan?(t.preloaded=!0,match):match;addEvent(t,"mouseout",onMouseout);var attach=!1;return t.parentNode.className.indexOf("fh-icon")>-1?attach=t.parentNode:(t.className.indexOf("fh-icon")>-1||"true"==t.getAttribute("data-fhttattach"))&&(attach=t),addEvent(t,"mousemove",onMousemove),$ZamTooltips.show(match.site,match.type,match.id,attach,t),!0},testUrl=function(url){for(var s in sites)if(sites.hasOwnProperty(s)){var site=sites[s],match=site.re.exec(url);if(match)return{site:s,type:match[1],id:match[2]}}return!1},testDataAttrib=function(t){var attr=t.attributes["data-zamtooltip"];if(attr){var split=attr.value.split("=");return 2==split.length&&sites[split[0]]?{site:split[0],type:"custom",id:split[1]}:!1}return!1}},window.$ZamTooltips=new $ZamTooltips;
//# sourceMappingURL=3.tower_ghost.js.map